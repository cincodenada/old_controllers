/*1365802804,178142511*/

if (self.CavalryLogger) { CavalryLogger.start_js(["masB4"]); }

__d("OauthLogin",["Cookie","Dialog","PopupWindow","URI","WindowComm","XD","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dialog'),i=b('PopupWindow'),j=b('URI'),k=b('WindowComm'),l=b('XD').XD,m=b('tx');function n(o,p){this.provider=o;this.endpoint=p;return this;}n.prototype.login=function(o,p,q){var r=k.makeHandler(function(u){this._closePopup();var v=this.provider+'..'+u.oauth_token+'..'+u.oauth_token_secret;g.set('tpa',v,0,'/');if(q)n._refreshLoginStatus();o&&o();}.bind(this)),s=k.makeHandler(function(u){this._closePopup();new h().setTitle("Ruh roh!").setBody(m._("We're having trouble talking to {provider}.\u003Cbr \/>Either login to Facebook directly or try again later.",{provider:this.provider})).setHandler(function(){p&&p();}).setButtons(h.OK).show();}.bind(this)),t=new j(this.endpoint);t.setQueryData({provider:this.provider,next:r,channel_url:s,cancel_url:s,display:'popup'});this._popup=i.open(t.toString(),416,468);};n.prototype._closePopup=function(){if(this._popup){this._popup.close();this._popup=null;}};n._refreshLoginStatus=function(){try{l.send({type:'refreshThirdPartyAuthStatus'});}catch(o){window.location.reload();}};e.exports=n;});
__d("OpenIDLogin",["Cookie","Dialog","OpenIDRequest","XD","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dialog'),i=b('OpenIDRequest'),j=b('XD').XD,k=b('tx'),l={login:function(m,n,o,p,q){i.context='tpa';new i().setThirdPartyLogin(true).setSuccessHandler(function(r){var s='OpenID'+'..'+r.oid+'..'+r.secret;g.set('tpa',s,0,'/');if(!!p)l._refreshLoginStatus();n&&n();}).setErrorHandler(function(r){new h().setTitle("Ruh roh!").setBody(k._("We're having trouble talking to {provider}.\u003Cbr \/>Either login to Facebook directly or try again later.",{provider:m})).setButtons(h.OK).setHandler(function(){o&&o();}).show();}).setProviderCache(q).setOpenIDUrl(m).send();},_refreshLoginStatus:function(){try{j.send({type:'refreshThirdPartyAuthStatus'});}catch(m){window.location.reload();}}};e.exports=l;});
__d("MultiLoginPopup",["Arbiter","CommentAdminPanelController","CSS","Dialog","DOM","Env","Event","HTML","OauthLogin","OpenIDLogin","PopupWindow","SelectorDeprecated","URI","WidgetArbiter","WindowComm","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CommentAdminPanelController'),i=b('CSS'),j=b('Dialog'),k=b('DOM'),l=b('Env'),m=b('Event'),n=b('HTML'),o=b('OauthLogin'),p=b('OpenIDLogin'),q=b('PopupWindow'),r=b('SelectorDeprecated'),s=b('URI'),t=b('WidgetArbiter'),u=b('WindowComm'),v=b('$'),w=b('copyProperties'),x={provider:'facebook',providerCache:{},formSubmissionInterceptors:[],init:function(){g.subscribe('platform/socialplugins/login',function(y){x.loggedIn=!!y.user;});r.subscribe('close',function(y,z){r.setSelected(z.selector,r.getValue(z.selector),false);});},setProvider:function(y){x.provider=y;return this;},setProviderCache:function(y){x.providerCache=y;return this;},interceptFormSubmission:function(y,z,aa,ba){var ca=function(da){if(da){x.detachExistingSubmissionInterceptors();if(da.fbDtsg){l.fb_dtsg=da.fbDtsg;l.user=da.user;}if(da.isThirdParty==="0"){k.scry(document.documentElement,'.postToProfile').forEach(function(ea){i.show(ea);});k.scry(document.documentElement,'.postToProfileCheckbox').forEach(function(ea){if(da.postToProfileChecked==="0"){ea.removeAttribute('checked');}else ea.setAttribute('checked','checked');});k.scry(document.documentElement,'.viewerProfileHref').forEach(function(ea){ea.href=da.profileUrl;ea.onclick='';});k.scry(document.documentElement,'.commentas').forEach(function(ea){var fa=ea.id;k.replace(ea,n(da.commentAsMarkup));var ga=v(da.commentAsMarkupID);ga.id=fa;var ha=k.scry(ga,'a.commentaschange');if(ha.length==1){var ia=ha[0],ja=new s(ia.getAttribute('ajaxify'));ja.addQueryData({uniqid:fa});ia.setAttribute('ajaxify',ja.toString());}});}else k.scry(document.documentElement,'.commentas').forEach(function(ea){var fa=ea.id;k.replace(ea,n(da.commentAsMarkup));var ga=v(da.commentAsMarkupID);ga.id=fa;});k.scry(document.documentElement,'.viewerProfilePic').forEach(function(ea){ea.src=da.profilePic;});k.scry(document.documentElement,'.fbCommentAfterLoginButton').forEach(i.hide);k.scry(document.documentElement,'.fbCommentButton').forEach(i.show);k.scry(document.documentElement,'.fbReplyAfterLoginButton').forEach(i.hide);k.scry(document.documentElement,'.fbReplyButton').forEach(i.show);k.scry(document.documentElement,'.fbUpDownVoteAfterLogin').forEach(i.hide);k.scry(document.documentElement,'.fbUpDownVoteOption').forEach(i.show);k.scry(document.documentElement,'.closeButtonAfterLogin').forEach(i.hide);k.scry(document.documentElement,'.closeButton').forEach(i.show);h.setLoggedIn(parseInt(da.user,10));g.inform('platform/socialplugins/login',{user:da.user},g.BEHAVIOR_STATE);t.inform('platform/socialplugins/login',{user:da.user},g.BEHAVIOR_STATE);}};x.login(ba,y,z,aa,ca);return false;},attachAllFormsToLogin:function(y,z){x.formSubmissionInterceptors=[];x.popupTitle=y;x.params=z;x.reattachLoginInterceptors();},reattachLoginInterceptors:function(){x.detachExistingSubmissionInterceptors();var y=['composer','fbUpDownVoteAfterLogin','closeButtonAfterLogin'],z=x.popupTitle,aa=x.params,ba=function(da){var ea=da.getTarget();if(ea.tagName.toLowerCase()==='form'&&y.some(i.hasClass.curry(ea)))return x.interceptFormSubmission(ea,z,aa);},ca=m.listen(document.body,'submit',ba,m.Priority.URGENT);x.formSubmissionInterceptors.push(ca);},detachExistingSubmissionInterceptors:function(){var y=x.formSubmissionInterceptors.length;for(var z=0;z<y;z++)x.formSubmissionInterceptors[z].remove();x.formSubmissionInterceptors=[];},login:function(y,z,aa,ba,ca){if(!x.loggedIn)x._openPopup(ba,ca);},doOpenIDLogin:function(y,z,aa){p.login(y,x.tpaLoginCallback(z),x.tpaLoginCallback(aa),false,x.providerCache);},doOauthWrapLogin:function(y,z,aa){var ba=new o(y,'/connect/oauthwrap_login.php');return ba.login(x.tpaLoginCallback(z),x.tpaLoginCallback(aa),false);},doTwitterLogin:function(y,z){var aa=new o('Twitter','/connect/twitter_login.php');return aa.login();},tpaLoginCallback:function(y){return function(z,aa){var ba=k.create('iframe',{src:z,className:'hidden_elem'});k.appendContent(k.find(aa.documentElement,'body'),ba);}.curry(y,document);},loggedIn:false,_popup:null,_openPopup:function(y,z){var aa=x.provider==='facebook'?'opener':'parent',ba=u.makeHandler(function(ja){x._closePopup();z&&z(ja);},aa),ca=u.makeHandler(function(ja){x._closePopup();},aa),da;da=new s('/plugins/multi_login_popup_loggedin.php');da.setQueryData({original_next:ba,original_cancel:ca,iframe_src:y.iframe_src});ba=da.getQualifiedURI().toString();if(x.provider==='facebook'){da=new s('/login.php');da.setQueryData(w(y,{social_plugin:'multi_login',cancel_url:ca,next:ba,provider:x.provider}));var ea=450,fa=700;this._popup=q.open(da.toString(),ea,fa);}else if(x.provider==='twitter'){x.doTwitterLogin(ba,ca);}else if(x.provider==='microsoft'){x.doOauthWrapLogin(x.provider,ba,ca);}else if(x.provider==='openid'){var ga=new j(),ha=function(ja){var ka=ga.getFormData();x.doOpenIDLogin(ka.openid_url,ba,ca);ga.hide();if(ja.kill)ja.kill();return false;};ga.setContentWidth(350).setTitle('OpenID').setBody(k.create('form',{onsubmit:ha},k.create('input',{type:'text',size:60,name:'openid_url'}))).setHandler(ha).setButtons([j.CONFIRM,j.CANCEL]).show();}else{var ia=x.provider+'.com';x.doOpenIDLogin(ia,ba,ca);}},_closePopup:function(){if(this._popup){this._popup.close();this._popup=null;}}};e.exports=x;});
__d("legacy:multi-login-popup",["MultiLoginPopup"],function(a,b,c,d){a.MultiLoginPopup=b('MultiLoginPopup');},3);