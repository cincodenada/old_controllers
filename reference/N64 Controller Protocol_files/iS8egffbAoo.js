/*1369116243,178142561*/

if (self.CavalryLogger) { CavalryLogger.start_js(["yvypm"]); }

__d("ComposerPublishTrackingStory",["Event","ge","reportData","DOMQuery"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ge'),i=b('reportData'),j=b('DOMQuery');f.init=function(k){g.listen(k,'submit',function(){var l=h('home_stream');if(!l)return;var m=j.scry(l,'.uiStreamStory')[0];if(m&&m.getAttribute('data-ft')){var n=JSON.parse(m.getAttribute('data-ft'));if(!(("mf_story_key" in n)&&("qid" in n)))return;var o={mf_story_key:n.mf_story_key,qid:n.qid};i("compose",{ft:o});}});};});
__d("ComposerXAttachmentBootstrap",["CSS","Form","Parent","URI","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('Form'),i=b('Parent'),j=b('URI'),k=b('cx'),l=[],m={bootstrap:function(n){m.load(i.byTag(n,'form'),n.getAttribute('data-endpoint'));},load:function(n,o,p){var q=j(o).addQueryData({composerurihash:m.getURIHash(o)});g.conditionClass(n,"_fu",p);var r=i.byClass(n,"_2_4");g.removeClass(r,'async_saving');h.setDisabled(n,false);n.action=q.toString();h.bootstrap(n);},getURIHash:function(n){if(n==='initial')return 'initial';var o=l.indexOf(n);if(o!==-1){return o+'';}else{o=l.length;l[o]=n;return o+'';}}};e.exports=m;});
__d("ComposerXStore",["function-extensions","Arbiter","ge"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ge'),i={};function j(l,m){return 'ComposerX/'+l+'/'+m;}var k={set:function(l,m,n){if(!i[l])i[l]={};i[l][m]=n;g.inform(j(l,m),{},g.BEHAVIOR_STATE);},get:function(l,m){if(i[l])return i[l][m];return null;},getAllForComposer:function(l){return i[l]||{};},waitForComponents:function(l,m,n){g.registerCallback(n,m.map(j.curry(l)));}};g.subscribe('page_transition',function(){for(var l in i)if(!h(l))delete i[l];});e.exports=k;});
__d("ComposerX",["Arbiter","ComposerXAttachmentBootstrap","ComposerXStore","CSS","DOM","DOMQuery","copyProperties","csx","cx","getObjectValues"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerXAttachmentBootstrap'),i=b('ComposerXStore'),j=b('CSS'),k=b('DOM'),l=b('DOMQuery'),m=b('copyProperties'),n=b('csx'),o=b('cx'),p=b('getObjectValues'),q='any';function r(s){this._root=s;this._composerID=s.id;this._attachments={};this._attachmentFetchForm=l.find(s,"._2_4");this._resetSubscription=g.subscribe('composer/publish',function(t,u){if(u.composer_id===this._composerID)this.reset();}.bind(this));}m(r.prototype,{_endpointHashToShow:q,_lastFetchEndpoint:'',_initialAttachmentEndpoint:'',getAttachment:function(s,t){var u=h.getURIHash(s);this._endpointHashToShow=u;var v=this._attachments[u];if(v){this._showAttachmentAfterComponentsLoaded(u);}else this.fetchAttachmentData(s,t);},fetchAttachmentData:function(s,t){var u=h.getURIHash(s);if(this._attachments[u])return;if(s!==this._lastFetchEndpoint){h.load(this._attachmentFetchForm,s,t);this._lastFetchEndpoint=s;}},setAttachment:function(s,t,u,v){this._setupAttachment(s,t,u,v);this._showAttachmentAfterComponentsLoaded(s);},setInitialAttachment:function(s,t,u,v){var w=h.getURIHash(s);this._setupAttachment(w,t,u,v);this._initialAttachmentEndpoint=s;if(!this._currentInstance)this._showAttachmentAfterComponentsLoaded(w);},setComponent:function(s,t){if(!i.get(this._composerID,s)){i.set(this._composerID,s,t);k.appendContent(this._attachmentFetchForm,k.create('input',{type:'hidden',name:'loaded_components[]',value:s}));}},reset:function(){if(this._currentInstance){this._currentInstance.cleanup();this._currentInstance=null;}for(var s in this._attachments)this._attachments[s].instance.reset();var t=i.getAllForComposer(this._composerID);p(t).forEach(function(u){if(u.reset)u.reset(u);});this.getAttachment(this._initialAttachmentEndpoint);g.inform('composer/reset');},destroy:function(){if(this._resetSubscription){this._resetSubscription.unsubscribe();this._resetSubscription=null;}},addPlaceholders:function(s,t){var u;for(var v in this._attachments){u=this._attachments[v];if(u.instance===s){t.forEach(function(w){u.placeholders.push(w);u.required_components.push(w.component_name);});break;}}if(this._currentInstance===s)this._fillPlaceholders(t);},_setupAttachment:function(s,t,u,v){t.setComposerID(this._composerID);this._attachments[s]={instance:t,placeholders:u,required_components:v};var w=l.find(this._root,"div._55d0"),x=t.getRoot();if(x.parentNode!==w){j.hide(x);k.appendContent(w,x);}},_showAttachment:function(s,t,u){if(this._currentInstance===s)return;if(this._endpointHashToShow===q){this._endpointHashToShow=null;}else if(this._endpointHashToShow!==t)return;if(this._currentInstance){if(!this._currentInstance.canSwitchAway())return;this._currentInstance.cleanup();}this._currentInstance=s;var v=l.find(this._root,"div._55d0"),w=v.childNodes,x=s.getRoot();for(var y=0;y<w.length;y++)if(w[y]!==x)j.hide(w[y]);j.show(x);this._fillPlaceholders(u);var z=h.getURIHash(this._initialAttachmentEndpoint),aa=t===z;s.initWithComponents(aa);this._setAttachmentSelectedClass(s.attachmentClassName);g.inform('composer/initializedAttachment',{composerRoot:this._root,isInitial:aa});},_showAttachmentAfterComponentsLoaded:function(s){var t=this._attachments[s];i.waitForComponents(this._composerID,t.required_components,this._showAttachment.bind(this,t.instance,s,t.placeholders));},_fillPlaceholders:function(s){s.forEach(function(t){var u=i.get(this._composerID,t.component_name);if(t.element!==u.element.parentNode)k.setContent(t.element,u.element);}.bind(this));},_setAttachmentSelectedClass:function(s){var t=l.scry(this._root,"._519b")[0],u;if(t){j.removeClass(t,"_519b");u=l.scry(t,'*[aria-pressed="true"]')[0];if(u)u.setAttribute('aria-pressed','false');}if(s){var v=l.scry(this._root,'.'+s)[0];if(v){j.addClass(v,"_519b");u=l.scry(v,'*[aria-pressed="false"]')[0];if(u)u.setAttribute('aria-pressed','true');}}}});e.exports=r;});
__d("ComposerXAttachment",["ComposerXStore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ComposerXStore'),h=b('copyProperties'),i=b('emptyFunction');function j(){}h(j.prototype,{getRoot:i,initWithComponents:function(k){},cleanup:i,reset:i,attachmentClassName:'',getComponent:function(k){return g.get(this._composerID,k);},canSwitchAway:i.thatReturnsTrue,setComposerID:function(k){this._composerID=k;},allowOGTagPreview:function(){return false;}});e.exports=j;});
__d("ComposerXController",["Arbiter","ComposerX","ComposerXAttachmentBootstrap","Parent","$","cx","emptyFunction","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerX'),i=b('ComposerXAttachmentBootstrap'),j=b('Parent'),k=b('$'),l=b('cx'),m=b('emptyFunction'),n=b('ge'),o={};function p(r){var s=j.byClass(k(r),"_119"),t=s.id;if(!o[t])o[t]=new h(s);return o[t];}var q={getAttachment:function(r,s,t){var u=p(r);u.getAttachment(s,t);},fetchAttachmentData:function(r,s,t){p(r).fetchAttachmentData(s,t);},setAttachment:function(r,s,t,u,v){var w=p(r);w.setAttachment(s,t,u,v);},setInitialAttachment:function(r,s,t,u,v){var w=p(r);w.setInitialAttachment(s,t,u,v);},setComponent:function(r,s,t){var u=p(r);u.setComponent(s,t);},reset:function(r){var s=p(r);s.reset();},holdTheMarkup:m,getEndpoint:function(r,s,t){var u=p(r);i.load(u._attachmentFetchForm,s,t);},addPlaceholders:function(r,s,t){var u=p(r);u.addPlaceholders(s,t);}};i.bootstrap=function(r){q.getAttachment(r,r.getAttribute('data-endpoint'));};g.subscribe('page_transition',function(){for(var r in o)if(!n(r)){o[r].destroy();delete o[r];}});e.exports=q;});
__d("ComposerXAttachmentUtils",["CSS","DOMQuery","Focus","Input","PageTransitions","Run","StickyPlaceholderInput","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOMQuery'),i=b('Focus'),j=b('Input'),k=b('PageTransitions'),l=b('Run'),m=b('StickyPlaceholderInput'),n=b('tx'),o={initMentions:function(p,q){p.instance.setPlaceholder(q);var r=h.find(p.element,'textarea.input');i.set(r);},setStickyPlaceholderForMentions:function(p,q){if(h.contains(p.element,document.activeElement)&&g.hasClass(document.activeElement,'DOMControl_placeholder'))document.activeElement.blur();p.instance.setPlaceholder(q);},setStickyPlaceholderForTypeahead:function(p,q){var r=h.find(p,'.textInput');m.setPlaceholderText(r,q);},registerInputForLeaveWarning:function(p){l.onBeforeUnload(function(){var q=k.getNextURI();if(q.getQueryData().hasOwnProperty('theater'))return;if(a.Dialog&&a.Dialog.getCurrent())return;if(p.offsetParent!==null&&!j.isEmpty(p))return "You haven't finished your post yet. Do you want to leave without finishing?";});}};e.exports=o;});
__d("DragDropFileUpload",[],function(a,b,c,d,e,f){f.isSupported=function(){return typeof(FileList)!=="undefined";};});
__d("DocumentDragDrop",["Event","Arbiter","CSS","DOM","DOMQuery","DragDropFileUpload","emptyFunction","getObjectValues"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('CSS'),j=b('DOM'),k=b('DOMQuery'),l=b('DragDropFileUpload'),m=b('emptyFunction'),n=b('getObjectValues'),o={},p=0;function q(){p=0;n(o).forEach(function(t){i.removeClass(t.element,t.className);h.inform('dragleave',{element:t.element});});}function r(){if(!l.isSupported())return;g.listen(document,'dragenter',function(u){if(p===0)n(o).forEach(function(v){i.addClass(v.element,v.className);h.inform('dragenter',{element:v.element,event:u});});p++;});g.listen(document,'dragleave',function(u){p--;if(p===0)q();});g.listen(document,'drop',function(u){var v=u.getTarget();if(k.isNodeOfType(u.getTarget(),'input'))if(v.type==='file')return;u.prevent();});g.listen(document,'dragover',g.prevent);var t=null;document.addEventListener('dragover',function(){t&&clearTimeout(t);t=setTimeout(q,839);},true);r=m;}var s={registerStatusElement:function(t,u){r();o[j.getID(t)]={element:t,className:u};},removeStatusElement:function(t){var u=j.getID(t),v=o[u];i.removeClass(v.element,v.className);delete o[u];}};e.exports=s;});
__d("DragDropTarget",["Event","CSS","DocumentDragDrop","DragDropFileUpload","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DocumentDragDrop'),j=b('DragDropFileUpload'),k=b('copyProperties'),l=b('emptyFunction');function m(n){this._element=n;this._listeners=[];this._statusElem=n;this._dragEnterCount=0;this._enabled=false;}k(m.prototype,{_onFilesDropCallback:l,_onURLDropCallback:l,_fileFilterFn:l.thatReturnsArgument,setOnFilesDropCallback:function(n){this._onFilesDropCallback=n;return this;},setOnURLDropCallback:function(n){this._onURLDropCallback=n;return this;},enable:function(){if(!j.isSupported())return this;i.registerStatusElement(this._statusElem,'fbWantsDragDrop');this._listeners.push(g.listen(this._element,'dragenter',this._onDragEnter.bind(this)));this._listeners.push(g.listen(this._element,'dragleave',this._onDragLeave.bind(this)));this._listeners.push(g.listen(this._element,'dragover',g.kill));this._listeners.push(g.listen(this._element,'drop',function(n){this._dragEnterCount=0;h.removeClass(this._statusElem,'fbDropReady');h.removeClass(this._statusElem,'fbDropReadyPhoto');h.removeClass(this._statusElem,'fbDropReadyPhotos');h.removeClass(this._statusElem,'fbDropReadyLink');var o=this._fileFilterFn(n.dataTransfer.files);if(o.length)this._onFilesDropCallback(o);var p=n.dataTransfer.getData('url')||n.dataTransfer.getData('text/uri-list');if(p)this._onURLDropCallback(p);n.kill();}.bind(this)));this._enabled=true;return this;},disable:function(){if(!this._enabled)return this;i.removeStatusElement(this._statusElem,'fbWantsDragDrop');h.removeClass(this._statusElem,'fbDropReady');h.removeClass(this._statusElem,'fbDropReadyPhoto');h.removeClass(this._statusElem,'fbDropReadyPhotos');h.removeClass(this._statusElem,'fbDropReadyLink');while(this._listeners.length)this._listeners.pop().remove();this._enabled=false;return this;},setFileFilter:function(n){this._fileFilterFn=n;return this;},setStatusElement:function(n){this._statusElem=n;return this;},_onDragEnter:function(n){if(this._dragEnterCount===0){var o=n.dataTransfer.items,p=false;for(var q=0;q<o.length;q++)if(!o[q].type.match('image/*')){p=true;break;}h.addClass(this._statusElem,'fbDropReady');if(p){h.addClass(this._statusElem,'fbDropReadyLink');}else if(o.length>1){h.addClass(this._statusElem,'fbDropReadyPhotos');}else h.addClass(this._statusElem,'fbDropReadyPhoto');}this._dragEnterCount++;},_onDragLeave:function(){this._dragEnterCount=Math.max(this._dragEnterCount-1,0);if(this._dragEnterCount===0){h.removeClass(this._statusElem,'fbDropReady');h.removeClass(this._statusElem,'fbDropReadyPhoto');h.removeClass(this._statusElem,'fbDropReadyPhotos');h.removeClass(this._statusElem,'fbDropReadyLink');}}});e.exports=m;});
__d("ComposerXDragDrop",["Arbiter","ComposerXController","CSS","DragDropTarget","DOMQuery","Parent","URI","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ComposerXController'),i=b('CSS'),j=b('DragDropTarget'),k=b('DOMQuery'),l=b('Parent'),m=b('URI'),n=b('copyProperties'),o=b('csx'),p=b('cx'),q='/ajax/composerx/attachment/media/upload/',r='/ajax/composerx/attachment/link/scraper/',s=function(u){u();};function t(u,v,w,x){this._root=u;this._composerID=v;this._targetID=w;x=x||s;this._dragdrop=new j(u).setOnFilesDropCallback(function(y){x(this._uploadFiles.bind(this,y));}.bind(this)).setFileFilter(t.filterImages).enable();t.handleDragEnterAndLeave(u);g.subscribe('composer/deactivateDragdrop',function(){this.deactivate();}.bind(this));}n(t,{handleDragEnterAndLeave:function(u){var v=k.scry(l.byClass(u,"_119"),"._2wr");g.subscribe('dragenter',function(w,x){if(u==x.element)v.forEach(i.hide);});g.subscribe('dragleave',function(w,x){if(u==x.element)v.forEach(i.show);});},filterImages:function(u){var v=[];for(var w=0;w<u.length;w++)if(u[w].type.match('image/*'))v.push(u[w]);return v;}});n(t.prototype,{enableURLDropping:function(){this._dragdrop.setOnURLDropCallback(this._onURLDrop.bind(this));},deactivate:function(){this._dragdrop.disable();},_uploadFiles:function(u){h.getAttachment(this._root,q);g.inform('ComposerXFilesStore/filesDropped/'+this._composerID+'/mediaupload',{files:u},g.BEHAVIOR_PERSISTENT);},_onURLDrop:function(u){var v=new m(r);v.addQueryData({scrape_url:encodeURIComponent(u)});h.getAttachment(this._root,v.toString());}});e.exports=t;});
__d("ComposerXBootloadStatusAttachment",["Event","function-extensions","Arbiter","AsyncRequest","Bootloader","Class","ComposerXAttachment","ComposerXController","ComposerXDragDrop","ComposerXStore","CSS","DOM","DOMQuery","Focus","Parent","PlaceholderListener","PrivacyConst","URI","SelectorDeprecated","copyProperties","csx","cx"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('Arbiter'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('Class'),l=b('ComposerXAttachment'),m=b('ComposerXController'),n=b('ComposerXDragDrop'),o=b('ComposerXStore'),p=b('CSS'),q=b('DOM'),r=b('DOMQuery'),s=b('Focus'),t=b('Parent'),u=b('PlaceholderListener'),v=b('PrivacyConst'),w=b('URI'),x=b('SelectorDeprecated'),y=b('copyProperties'),z=b('csx'),aa=b('cx'),ba={};function ca(da,ea){this.parent.construct(this);this._root=da;this._config=ea;}k.extend(ca,l);y(ca.prototype,{_attachmentIsActive:false,_bootloading:false,_fullVersion:false,_focusListener:null,_privacyWidgetTags:null,_scraper:null,_dragdrop:null,attachmentClassName:"_4j",getRoot:function(){return this._root;},initWithComponents:function(da){ba[this._composerID]=this;this._attachmentIsActive=true;var ea=r.find(this.getComponent('maininput').element,'textarea.input');if(this._fullVersion){this._fullInitWithComponents();}else if(!this._bootloading)if(r.contains(this._root,document.activeElement)){this._onInitialFocus();}else this._focusListener=g.listen(ea,'focus',this._onInitialFocus.bind(this));this._dragEnterHandler=h.subscribe('dragenter',function(fa,ga){if(ga.element==this._root){var ha=ga.event.dataTransfer.items,ia;if(ha)ia=n.filterImages(ha);if(ia&&ia.length>0){s.set(ea);}else{var ja=t.byClass(this._root,'focus_target');u.expandInput(ja);if(!this._bootloading&&!this._fullVersion)this._onInitialFocus();}}}.bind(this));this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);if(!da)s.set(ea);if(this._config.plus_version){this._dragdrop=new n(this._root,this._composerID,this._config.targetID);this._dragdrop.enableURLDropping();}},_fullInitWithComponents:function(){j.loadModules(['ComposerXPrivacyWidgetTags','URLScraper','URI'],function(da,ea,fa){this._tagger.init(this);this._privacyWidgetTags=new da(this);var ga=r.find(this.getComponent('maininput').element,'textarea.input');if(!this._scraper){this._scraper=new ea(ga);this._scraper.subscribe('match',function(ha,ia){var ja=this._getScraperEndpoint();ja.addQueryData({scrape_url:encodeURIComponent(ia.url)});m.getAttachment(this._root,ja.toString());}.bind(this));}this._scraper.enable();this._scraper.check();}.bind(this));this._initPrivacyReminder();},_initPrivacyReminder:function(){if(!this._reminderDialog||this._reminderShown)return;var da=this.getComponent('mainprivacywidget'),ea=x.getSelectedOptions(da.element),fa=x.getOptionValue(ea[0]);if(fa!==String(v.BaseValue.SELF))return;this._reminderDialog.setContext(this.getComponent('mainprivacywidget').element).show();this._reminderShown=true;var ga=function(){new i('/ajax/privacy/reminders/dismiss').setData({type:'only_me'}).send();this._reminderDialog.hide();}.bind(this);this._reminderEvents=[g.listen(this._reminderDialog.getContent(),'click',ga),g.listen(this._reminderDialog.getContext(),'click',ga)];},cleanup:function(){this._attachmentIsActive=false;if(this._focusListener){this._focusListener.remove();this._focusListener=null;}if(this._reminderDialog&&this._reminderShown){this._reminderDialog.hide();this._reminderEvents.forEach(function(da){da.remove();});}if(this._dragdrop){this._dragdrop.deactivate();this._dragdrop=null;}if(this._fullVersion){this._tagger.cleanup();this._privacyWidgetTags.destroy();this._privacyWidgetTags=null;this._scraper.disable();}if(this._dragEnterHandler){this._dragEnterHandler.unsubscribe();this._dragEnterHandler=null;}},reset:function(){var da=t.byClass(this._root,"child_was_focused");if(da)p.removeClass(da,"child_was_focused");if(this._tagger)this._tagger.reset();this.getComponent('maininput').instance.setPlaceholder(this._config.mentionsPlaceholder);},canSwitchAway:function(){return !t.byClass(this._root,'async_saving');},setBootloadedContent:function(da,ea,fa,ga){this._reminderDialog=ga;var ha=fa.map(function(ia){return ia.component_name;});o.waitForComponents(this._composerID,ha,function(){var ia=r.find(this._root,"._3-6"),ja=r.find(this._root,"._3-7");q.setContent(ia,da.tagger_content);q.setContent(ja,da.tagger_icons);m.addPlaceholders(this._root,this,fa);this._tagger=ea;this._fullVersion=true;if(this._attachmentIsActive){if(this._focusListener){this._focusListener.remove();this._focusListener=null;}this._fullInitWithComponents();}}.bind(this));},_getScraperEndpoint:function(){return w('/ajax/composerx/attachment/link/scraper/');},_onInitialFocus:function(){m.getEndpoint(this._root,'/ajax/composerx/attachment/status/bootload/',true);this._bootloading=true;},allowOGTagPreview:function(){return true;}});ca.setBootloadedContent=function(da,ea,fa,ga,ha){var ia=ba[da];if(ia)ia.setBootloadedContent(ea,fa,ga,ha);};e.exports=ca;});
__d("ComposerXMentionsInputReset",["DOMQuery","Input"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('Input');function i(j){var k=g.scry(j.element,'textarea.input')[0];j.instance.reset();h.reset(k);}e.exports=i;});
__d("ComposerXOGTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_4-jh");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("ComposerXPrivacyWidgetReset",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter');function h(i){g.inform('Composer/changedtags',{withTags:[],mention:{},eventTag:false});}e.exports=h;});
__d("ComposerXTaggerIconReset",["CSS","cx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('cx');function i(j){g.removeClass(j.element,"_1dsa");g.removeClass(j.element,"_1dsb");g.removeClass(j.element,"_509o");}e.exports=i;});
__d("legacy:input-methods",["Input","copyProperties"],function(a,b,c,d){var e=b('Input'),f=b('copyProperties');f(a.Input||(a.Input={}),e);},3);
__d("CustomPrivacyOption",["Event","Arbiter","AsyncDialog","AsyncRequest","DOM","Form","Parent","PrivacyConst","SelectorDeprecated","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('AsyncDialog'),j=b('AsyncRequest'),k=b('DOM'),l=b('Form'),m=b('Parent'),n=b('PrivacyConst'),o=b('SelectorDeprecated'),p=b('copyProperties');function q(r,s,t,u,v,w,x,y){if(!r)return;(function(){this.initCustomState(r,s,t);g.listen(r,'click',function(event){this.openCustomDialog(event,s,u,w,x,y);}.bind(this));this._initSelector(r,v);}).bind(this).defer();}p(q,{_instances:{},update:function(r,s,t,u){var v=q._instances[r];v._update(s,t)._updateOption(t,u);h.inform('Form/change',{node:v._container});},getData:function(r){return q._instances[r]._privacyData;},setPrivacyData:function(r,s,t){q._instances[r]._update(s,t);}});p(q.prototype,{_initSelector:function(r,s){this._selector=m.byClass(r,'uiSelector');o.listen(this._selector,'select',function(t){if(t.option._id!=this._id)this.clearCustomState();}.bind(this));if(s)o.setButtonTooltip(this._selector,s);},_updateOption:function(r,s){var t=o.getOption(this._selector,r)||o.getOption(this._selector,n.BaseValue.CUSTOM+'');h.inform('CustomPrivacyOption/update',{selector:this._selector,option:t,tooltip:s});return this;},_update:function(r,s){var t=s==n.BaseValue.CUSTOM||!o.getOption(this._selector,s),u=this._selector.getAttribute('data-name');this.updateCustomState(r,t,u);return this;},initCustomState:function(r,s,t){q._instances[s]=this;this._container=k.find(r,'.customPrivacyInputs');this._id=t;this._privacyData={};var u=l.serialize(this._container);if(u.audience)this._privacyData=u.audience[t];return r;},openCustomDialog:function(event,r,s,t,u,v){var w=new j('/ajax/privacy/custom_dialog/').setData({option_id:r,id:this._id,privacy_data:this._privacyData,explain_tags:s,autosave:t,limit_to_friends:u,source:v});w.setRelativeTo(event.getTarget());i.send(w);},updateCustomState:function(r,s,t){this.clearCustomState();this._privacyData=p({},r);if(s)if(t){t=t.slice(0,-'[value]'.length);var u={};u[t]=r;l.createHiddenInputs(u,this._container,null,true);}},clearCustomState:function(){this._privacyData={};k.empty(this._container);}});e.exports=q;});
__d("DynamicIconSelector",["Button","CSS","DOM","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('SelectorDeprecated'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("AudienceSelector",["Arbiter","CSS","CustomPrivacyOption","DOM","DynamicIconSelector","PrivacyConst","SelectorDeprecated"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('CustomPrivacyOption'),j=b('DOM'),k=b('DynamicIconSelector'),l=b('PrivacyConst'),m=b('SelectorDeprecated'),n={};m.subscribe('select',function(q,r){if(!h.hasClass(r.selector,'audienceSelector'))return;var s=m.getOptionValue(r.option);r.value=s;g.inform('AudienceSelector/changed',r);if(s==l.BaseValue.CUSTOM&&!h.hasClass(r.option,'noDialog')){m.toggle(r.selector);return false;}if(h.hasClass(r.selector,'dataTooltip')){var t=j.find(r.option,'.itemAnchor').getAttribute('data-tooltip');m.setButtonTooltip(r.selector,t||null);}if(!h.hasClass(r.option,'specialOption'))return;var u=j.find(r.option,'a').getAttribute('data-type');if(h.hasClass(r.option,'moreOption')){h.addClass(r.selector,u);h.addClass(r.selector,'showSecondaryOptions');return false;}else if(h.hasClass(r.option,'returnOption')){h.removeClass(r.selector,'showSecondaryOptions');h.removeClass(r.selector,'friendList');return false;}});var o={},p={hasTags:function(q){return o.hasOwnProperty(q);},keepSynchronized:function(q,r){n[q]||(n[q]={});n[q][r.id]=r;},setHasTags:function(q){if(!q)return;o[q]=true;}};g.subscribe('CustomPrivacyOption/update',function(q,r){if(!h.hasClass(r.selector,'audienceSelector'))return;m.setSelected(r.selector,m.getOptionValue(r.option));k.swapIcon(r.selector);m.setButtonTooltip(r.selector,r.tooltip);g.inform('AudienceSelector/update',r);});g.subscribe(['AudienceSelector/changed','AudienceSelector/update'],function(event,q){var r=m.getOptionValue(q.option),s={};if(r==l.BaseValue.CUSTOM){if(event=='AudienceSelector/changed')return;s=i.getData(q.option.id);}for(var t in n){var u=n[t];if(u[q.selector.id]){g.inform('AudienceSelector/syncNonSelectorIcon',{category:t});for(var v in u){var w=u[v];if(!w||q.selector===w)continue;if(m.getValue(w)!==r){m.setSelected(w,r);k.swapIcon(w);}if(r==l.BaseValue.CUSTOM){var x=m.getOption(w,l.BaseValue.CUSTOM+'');if(x){i.setPrivacyData(x.id,s,r);m.setButtonTooltip(w,q.tooltip);}}}}}});e.exports=p;});
__d("ComposerAudienceSelector",["DynamicIconSelector","CustomPrivacyOption","PrivacyConst","SelectorDeprecated"],function(a,b,c,d,e,f){b('DynamicIconSelector');var g=b('CustomPrivacyOption'),h=b('PrivacyConst'),i=b('SelectorDeprecated'),j={},k={},l={syncSelector:function(m){j[m]&&i.setSelected(m,j[m]);if(j[m]==h.BaseValue.CUSTOM&&k[m]){var n=i.getOption(m,h.BaseValue.CUSTOM+''),o=k[m];(function(){g.update(n.id,o.data,o.audience,o.tooltip);}).defer();}}};e.exports=l;});
__d("ErrorDialog",["Dialog","emptyFunction"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('emptyFunction'),i={showAsyncError:function(j){try{return i.show(j.getErrorSummary(),j.getErrorDescription());}catch(k){alert(j);}},show:function(j,k,l,m){return (new g()).setTitle(j).setBody(k).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(l||h).setButtonsMessage(m||'').show();}};e.exports=i;});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("legacy:ComposerAudienceSelector",["ComposerAudienceSelector"],function(a,b,c,d){a.ComposerAudienceSelector=b('ComposerAudienceSelector');},3);
__d("FriendListPrivacyOptions",["Arbiter","AsyncDialog","AsyncRequest","Dialog","DOMQuery","PageTransitions","Parent","SelectorDeprecated","$","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Dialog'),k=b('DOMQuery'),l=b('PageTransitions'),m=b('Parent'),n=b('SelectorDeprecated'),o=b('$'),p=b('ge'),q=false,r=false,s=null,t={},u=function(w){if(!Object.keys(t).length)l.registerHandler(function(){t={};q=false;r=false;});var x=w.getAttribute('data-name');t[x]=w;n.listen(w,'select',function(y){var z=y.option,aa=k.find(z,'a.itemAnchor'),ba=aa.getAttribute('data-flid');if(!ba)return;var ca=aa.getAttribute('data-dynamic');if(ca&&q){v.showSmartListNux(z,ba);}else if(!ca&&r)v.showDumbListNux([ba]);});},v={listen:function(w,x,y){var z=p(w);if(!z)return;var aa=m.byClass(z,'audienceSelector');if(aa){u(aa);q=x;r=y;}},showSmartListNux:function(w,x){w=o(w);new i('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:w.id,flid:x}).send();q=false;},setContextualDialog:function(w,x){x=o(x);var y=m.byClass(x,'audienceSelector');if(y){w.setContext(y);w.show();var z=g.subscribe('composer/publish',function(){w.hide();});w.subscribe('hide',function(){z.unsubscribe();});}},showDumbListNux:function(w){h.send(new i('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:w}));r=false;},showBothListsNux:function(w,x){s=o(w);v.showDumbListNux(x);},setDialogX:function(w){if(!s)return;w.subscribe('hide',function(){v.showSmartListNux(s);s=null;});},setDialog:function(){if(!s)return;var w=j.getCurrent();if(w)w.setCloseHandler(function(){v.showSmartListNux(s);s=null;});}};e.exports=v;});
__d("OnlyMePrivacyOption",["Arbiter","copyProperties","CSS","DOM","Env","Parent","PrivacyConst","SelectorDeprecated","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('DOM'),k=b('Env'),l=b('Parent'),m=b('PrivacyConst'),n=b('SelectorDeprecated'),o=b('tx');function p(q){this._selector=l.byClass(q,'composerAudienceSelector');this._plusLabel=j.scry(q,'.plusLabel')[0];if(!this._selector)return;this._elem=q;this._taggedIDs=[];this._tags=[];this._hasEvent=false;this._recalculateTooltipAndLabel();this._updateSelector();g.subscribe('Composer/changedtags',function(r,s){var t=this._hasEvent;this._hasEvent=!!s.eventTag;this._tags=s.withTags.map(function(v){return v.getText();});this._taggedIDs=s.withTags.map(function(v){return v.getValue();});for(var u in s.mention)if(s.mention[u].type=='user'&&s.mention[u].uid!=k.user){this._tags.push(s.mention[u].text);this._taggedIDs.push(s.mention[u].uid);}else if(s.mention[u].type=='event')this._hasEvent=true;if(this._hasEvent&&t!=this._hasEvent)this._eventTagChanged();if(this._recalculateTooltipAndLabel()&&n.isOptionSelected(this._elem)){this._updateSelector();g.inform('SelectedPrivacyOption/changed',this._getChangedData());}}.bind(this));n.listen(this._selector,'change',this._updateSelector.bind(this));}h(p.prototype,{_eventTagChanged:function(){},_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:m.FriendsValue.SELF};},_recalculateTooltipAndLabel:function(){var q=this._tooltip,r=this._label;if(this._taggedIDs.length){this._tooltip="Anyone tagged";this._label="Only Me"+' (+)';}else{this._tooltip="Only you";this._label="Only Me";}i.conditionShow(this._plusLabel,this._taggedIDs.length);return (q!=this._tooltip)||(r!=this._label);},_updateSelector:function(){if(n.isOptionSelected(this._elem)){n.setButtonLabel(this._selector,this._label);n.setButtonTooltip(this._selector,this._tooltip);return false;}return true;}});e.exports=p;});
__d("FriendsMinusAcquaintancesPrivacyOption",["Class","OnlyMePrivacyOption","PrivacyConst","CSS","tx","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('OnlyMePrivacyOption'),i=b('PrivacyConst'),j=i.FriendsValue,k=b('CSS'),l=b('tx'),m=b('copyProperties');function n(o,p){this._hasRestricted=p;this.parent.construct(this,o);}g.extend(n,h);m(n.prototype,{_getChangedData:function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:j.FRIENDS_MINUS_ACQUAINTANCES};},_recalculateTooltipAndLabel:function(){var o=this._hasEvent,p=this._tags.length,q=this._tooltip,r=this._label,s=this._taggedIDs.length||this._hasEvent;if(o){if(p>1){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Acquaintances, Restricted":"Your friends, friends of anyone tagged and event guests; Except: Acquaintances";}else if(p==1){if(this._hasRestricted){this._tooltip=l._("Your friends, {user}'s friends and event guests; Except: Acquaintances, Restricted",{user:this._tags[0]});}else this._tooltip=l._("Your friends, {user}'s friends and event guests; Except: Acquaintances",{user:this._tags[0]});}else this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Acquaintances, Restricted":"Your friends and event guests; Except: Acquaintances";}else this._tooltip=this._hasRestricted?"Friends except Acquaintances, Restricted":"Friends except Acquaintances";k.conditionShow(this._plusLabel,s);this._label=this._elem.getAttribute('data-label');if(s)this._label+=' (+)';return ((q!=this._tooltip)||(r!=this._label));}});e.exports=n;});
__d("FriendsPrivacyOption",["Arbiter","Class","CSS","OnlyMePrivacyOption","PrivacyConst","SelectorDeprecated","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('OnlyMePrivacyOption'),k=b('PrivacyConst'),l=b('SelectorDeprecated'),m=b('tx');function n(o,p){this._hasRestricted=p;this.parent.construct(this,o);}h.extend(n,j);n.prototype._getChangedData=function(){return {hasEvent:this._hasEvent,tags:this._taggedIDs,privacy:k.FriendsValue.ALL_FRIENDS};};n.prototype._eventTagChanged=function(){var o=this._getChangedData();o.privacy=l.getValue(this._selector);g.inform('EventTagged/changed',o);};n.prototype._recalculateTooltipAndLabel=function(){var o=this._hasEvent,p=this._tags.length,q=this._tooltip,r=this._label;if(p>2){if(o){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and event guests; Except: Restricted":"Your friends, friends of anyone tagged and event guests";}else this._tooltip=this._hasRestricted?"Your friends and friends of anyone tagged; Except: Restricted":"Your friends and friends of anyone tagged";}else if(p==2){if(o){if(this._hasRestricted){this._tooltip="Your friends, friends of anyone tagged and event guests; Except: Restricted";}else this._tooltip="Your friends, friends of anyone tagged and event guests";}else if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends; Except: Restricted ",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=m._("Your friends, {user}'s friends and {user2}'s friends",{user:this._tags[0],user2:this._tags[1]});}else if(p==1){if(o){if(this._hasRestricted){this._tooltip=m._("Your friends, {user}'s friends and event guests; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends, {user}'s friends and event guests",{user:this._tags[0]});}else if(this._hasRestricted){this._tooltip=m._("Your friends and {user}'s friends; Except: Restricted",{user:this._tags[0]});}else this._tooltip=m._("Your friends and {user}'s friends",{user:this._tags[0]});}else if(o){this._tooltip=this._hasRestricted?"Your friends and event guests; Except: Restricted":"Your friends and event guests";}else this._tooltip=this._hasRestricted?"Your friends; Except: Restricted":"Your friends";i.conditionShow(this._plusLabel,this._tags.length);this._label=this._elem.getAttribute('data-label');if(this._tags.length||this._hasEvent)this._label+=' (+)';return (q!=this._tooltip)||(r!=this._label);};e.exports=n;});
__d("MetaComposerEdDialog",["Animation","Arbiter","ARIA","AsyncRequest","copyProperties","CSS","DOM","Ease","ge","Parent","SelectorDeprecated","Vector"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('ARIA'),j=b('AsyncRequest'),k=b('copyProperties'),l=b('CSS'),m=b('DOM'),n=b('Ease'),o=b('ge'),p=b('Parent'),q=b('SelectorDeprecated'),r=b('Vector'),s=null;function t(u){this._dialog=u.dialog;this.config=u;this._init();}t.init=function(u){if(s){s.config.show_audience=u.show_audience;u.dialog.destroy();return;}s=new t(u);};k(t.prototype,{_init:function(){h.subscribe('ComposerXStatusAttachment/ready',function(){if(this.config.show_audience){this._sendEducationRequest({},'/ajax/composer/audience/education',this._handlerCustomDuration.bind(this,6000));this.config.show_audience=false;}}.bind(this));if(this.config.show_sticky)h.subscribe('composer/mutate',function(u,v){this._sendEducationRequest({sticky_num:this.config.n_sticky_shown},'/ajax/composer/audience/sticky_education');}.bind(this));if(this.config.show_event_tags)if(this.config.n_event_tag_shown===0){h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({id:"composerTourAudience",privacy:v.privacy,event_tag_num:this.config.n_event_tag_shown},'/ajax/events/tagging/user_education');}.bind(this));h.subscribe(['composer/publish','composer/reset'],function(){var u=o("event_tagging_tag_expansion_NUX");u&&l.hide(u);}.bind(this));}else h.subscribe('EventTagged/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'AtTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));if(this.config.show_tags)h.subscribe('SelectedPrivacyOption/changed',function(u,v){this._sendEducationRequest({ids:v.tags,from:'WithTagger',hasEvent:v.hasEvent,type:v.privacy,tag_num:this.config.n_tag_shown,event_tag_num:this.config.n_event_tag_shown},'/ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));q.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(u,v,w){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new j(v);this._async.setData(u).setHandler(w).send();},_updateDialogContext:function(){var u=m.scry(document.body,'div.composerAudienceWrapper'),v,w;for(var x=0;x<u.length;x++){v=u[x];w=r.getElementPosition(v);if(v&&w.x>0&&w.y>0){this._dialog.setContext(v);return true;}}return false;},_handler:function(u){this._handlerCustomDuration(1500,u);},_handlerCustomDuration:function(u,v){var w=v.payload;if(!w||!this._updateDialogContext())return;var x=this._dialog.getContent().firstChild;m.setContent(x,w);i.announce(m.getText(x));this._dialog.show();var y=p.byClass(x,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=new g(y);}else this._anim=new g(y).from('opacity',0);this._anim.to('opacity',1).ease(n.sineOut).checkpoint().duration(u).checkpoint().to('opacity',0).ease(n.sineOut).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(u,v){if(this._anim){this._dialog.hide();this._anim.stop();this._anim=null;}}});e.exports=t;});
__d("legacy:UIPagelet",["UIPagelet"],function(a,b,c,d){a.UIPagelet=b('UIPagelet');},3);
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n='#\\uFF03',o={trigger:new RegExp('['+g+']$'),hashtagTrigger:new RegExp('['+n+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=o;});
__d("MentionsInput",["function-extensions","Arbiter","ArbiterMixin","Bootloader","CSS","DataStore","DOM","Event","HTML","Input","InputSelection","Keys","MentionsInputMatchers","Parent","Style","TypeaheadUtil","UserAgent","copyProperties","htmlize","removeFromArray","repeatString"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Bootloader'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Event'),n=b('HTML'),o=b('Input'),p=b('InputSelection'),q=b('Keys'),r=b('MentionsInputMatchers'),s=b('Parent'),t=b('Style'),u=b('TypeaheadUtil'),v=b('UserAgent'),w=b('copyProperties'),x=b('htmlize'),y=b('removeFromArray'),z=b('repeatString'),aa='\uFEFF',ba=new RegExp(aa,'g'),ca=function(ga){return ga+aa;};function da(ga,ha){return ga.replace(ha,z(' ',ha.length));}function ea(ga,ha){return ga.substring(0,ha)+ga.substring(ha+1);}function fa(ga,ha,ia,ja,ka,la){k.set(ga,'MentionsInput',this);this._root=ga;this._typeahead=ha;this._input=ia;var ma=null,na=this.init.bind(this,ja,ka,la);try{ma=document.activeElement===this._input;}catch(oa){}if(ma){na.defer();}else var pa=m.listen(this._input,'focus',function(){na.defer();pa.remove();});this._hasHashtags=ja.hashtags;this._hashtags=[];}fa.getInstance=function(ga){var ha=s.byClass(ga,'uiMentionsInput');return ha?k.get(ha,'MentionsInput'):null;};w(fa.prototype,h,{init:function(ga,ha,ia){if(this._initialized)return;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=ga.max||6;this._metrics=ia;if(!this._hiddenInput.name){var ja=this._input.name;this._input.name=ja+'_text';this._hiddenInput.name=ja;}this._initEvents();this._initTypeahead();this.reset(ha);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(ga){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;o.setPlaceholder(this._input,this._placeholder);t.set(this._typeahead.getElement(),'height','auto');var ha=ga&&ga.value||'',ia=ga&&ga.mentions;if(ia&&ia.length){var ja=[];ia.forEach(function(ka){ja.push(ka.offset+ka.length);delete ka.offset;delete ka.length;this._addToken(ka);},this);ja.reverse().forEach(function(ka){ha=ha.substring(0,ka)+aa+ha.substring(ka);});}o.setValue(this._input,ha);this._updateTypeahead();this._updateWidth();this._update();},getValue:function(){return this._getMarkedValue().replace(ba,'');},_getMarkedValue:function(){return o.getValue(this._input);},getRawValue:function(){this._update();return o.getValue(this._hiddenInput);},checkValue:function(){var ga=this._typeahead.getCore().getValue();if(r.trigger.exec(ga)||ga==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var ga=this._update.bind(this);m.listen(this._input,{input:ga,keyup:ga,change:ga,blur:this._handleBlur.bind(this),focus:this._handleFocus.bind(this),keydown:this._handleKeydown.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);m.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(la,ma){var na=ma.selected;this._addToken({uid:na.uid,text:na.text,type:na.type,weakreference:na.weak_reference});this.updateValue();}.bind(this));var ga=this._input,ha=null;function ia(){if(ha===null){ha=o.getSubmitOnEnter(ga);o.setSubmitOnEnter(ga,false);}}function ja(){if(ha!==null){o.setSubmitOnEnter(ga,ha);ha=null;}}this._typeahead.subscribe('reset',ja);this._typeahead.subscribe('render',ia);this._typeahead.subscribe('highlight',function(la,ma){ma.index>=0?ia():ja();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));var ka=this._typeahead.getCore();ka.suffix=aa;this._handleFocus();},_handleBlur:function(){if(this._filterToken){this._filterToken.remove();this._filterToken=null;}},_handleFocus:function(){if(!this._filterToken)this._filterToken=this._typeahead.getData().addFilter(this._filterResults.bind(this));this._updateWidth();},_handleKeydown:function(event){var ga=event.keyCode;if(ga==q.BACKSPACE||ga==q.DELETE)this._handleBackspaceAndDelete(event,ga);if(ga==q.LEFT||ga==q.RIGHT)setTimeout(this._handleLeftAndRight.bind(this,ga),10);},_handleLeftAndRight:function(ga){var ha=this._getMarkedValue(),ia=p.get(this._input),ja=ia.start,ka=ia.end,la=ga==q.LEFT,ma=ga==q.RIGHT;if(ja==ka){var na=la?-1:1;if(ha.charAt(ja)==aa)p.set(this._input,ja+na);}else if(la&&ha.charAt(ja)==aa){p.set(this._input,ja-1,ka);}else if(la&&ha.charAt(ka)==aa){p.set(this._input,ja,ka-1);}else if(ma&&ha.charAt(ka)==aa){p.set(this._input,ja,ka+1);}else if(ma&&ha.charAt(ja)==aa)p.set(this._input,ja+1,ka);},_handleBackspaceAndDelete:function(event,ga){var ha=p.get(this._input),ia=false;if(ha.start!==ha.end)if(this._offsetIsInsideMention(ha.start+1)&&this._offsetIsInsideMention(ha.end)){ia=(ga===q.BACKSPACE);}else return;var ja=ga===q.DELETE?1:-1,ka=ja+(ia?ha.end:ha.start),la=this._getMarkedValue(),ma=la;for(var na=0;na<this._orderedUIDs.length;++na){var oa=this._mentioned[this._orderedUIDs[na]],pa=oa.text,qa=ca(pa),ra=ma.indexOf(qa),sa=ra+qa.length;if(ka<ra||ka>=sa){ma=da(ma,qa);continue;}var ta,ua;if(oa.type!='user'){ta=0;ua=[pa];}else{ta=qa.substring(0,ka-ra).split(' ').length-1;ua=pa.split(' ');}var va=ua.splice(ta,1)[0],wa=ua.join(' '),xa=ta===0?ra:sa-va.length-1;if(wa){oa.text=wa;wa=ca(wa);}else this._removeToken(oa.uid);var ya=la.substring(0,ra)+wa+la.substring(sa);o.setValue(this._input,ya);p.set(this._input,xa);this._update();event.kill();break;}},_offsetIsInsideMention:function(ga){for(var ha=0;ha<this._offsets.length;ha++)if(ga>this._offsets[ha][0]&&ga<=this._offsets[ha][1])return true;return false;},_filterResults:function(ga){if(this._filterData===null){var ha=p.get(this._input).start;if(this._offsetIsInsideMention(ha)){this._filterData={caretIsInsideMention:true};return false;}var ia=this._typeahead.getCore();this._filterData={value:ia.getValue(),rawValue:ia.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(r.mainMatcher.test(this._filterData.rawValue))return true;if(ga.type!='user')return false;if(ga.disable_autosuggest)return false;if(r.userMatcher.test(this._filterData.value))return true;return u.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(ga));},_addToken:function(ga){var ha=ga.uid;if(!this._mentioned.hasOwnProperty(ha)){this._mentioned[ha]=ga;this._orderedUIDs.push(ha);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(ga){if(this._mentioned.hasOwnProperty(ga)){delete this._mentioned[ga];y(this._orderedUIDs,ga);this._numMentioned--;this._updateTypeahead();}},_update:function(){var ga=this._getMarkedValue();if(ga==this._value)return;this._value=ga;this._updateMentions();this._updateDirection();this.updateValue();},_updateMentions:function(){this._offsets=[];var ga=this._getMarkedValue(),ha=ga;for(var ia=0;ia<this._orderedUIDs.length;++ia){var ja=this._orderedUIDs[ia],ka=ca(this._mentioned[ja].text),la=ha.indexOf(ka);if(la==-1)this._removeToken(ja);ha=da(ha,ka);this._offsets.push([la,la+ka.length]);}var ma=ga;while((la=ha.indexOf(aa))>-1){ma=ea(ma,la);ha=ea(ha,la);}if(ga!==ma){var na=p.get(this._input);o.setValue(this._input,ma);p.set(this._input,na.start);this._value=ma;}},_renderHashtags:function(ga){if(!this._hasHashtags)return x(ga);if(!this._hashtagParser){if(r.hashtagTrigger.exec(ga))i.loadModules(['HashtagParser'],function(ka){this._hashtagParser=ka;this._update();}.bind(this));return x(ga);}this._hashtags=this._hashtagParser.parse(ga);var ha=[],ia=0;for(var ja=0;ja<this._hashtags.length;ja++){ha.push(x(ga.substring(ia,this._hashtags[ja].rawOffset)));ha.push('<b>'+ga.charAt(this._hashtags[ja].rawOffset)+this._hashtags[ja].tag+'</b>');ia=this._hashtags[ja].rawOffset+this._hashtags[ja].tag.length+1;}ha.push(x(ga.substring(ia)));return ha.join('');},updateValue:function(){var ga=this._getMarkedValue(),ha=this._orderedUIDs,ia,ja,ka,la,ma,na;for(ia=0;ia<ha.length;++ia){la=ca(this._mentioned[ha[ia]].text);ga=ga.replace(la,'@['+ha[ia]+':]');}na=this._renderHashtags(ga);for(ia=0;ia<ha.length;++ia){ja=ha[ia];ka=this._mentioned[ja].text;la=ca(ka);ma=this._mentioned[ja].weakreference?'<b class="weak">':'<b>';na=na.replace('@['+ja+':]',ma+x(la)+'</b>');ka=ka.replace(/[\\\]:]/g,function(oa){return '\\'+oa;});ga=ga.replace('@['+ja+':]','@['+ja+':'+ka+']');}if(v.ie())na=na.replace(/ /g,'&nbsp;<wbr/>');l.setContent(this._highlighterContent,n(na));this._hiddenInput.value=ga;this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var ga=t.get(this._input,'direction');if(ga==this._dir)return;this._dir=ga;t.set(this._highlighter,'direction',ga);if(ga=='rtl'){t.set(this._highlighter,'text-align','right');}else t.set(this._highlighter,'text-align','left');},_updateWidth:function(){var ga=t.getFloat.curry(this._input),ha=this._input.offsetWidth-ga('paddingLeft')-ga('paddingRight')-ga('borderLeftWidth')-ga('borderRightWidth');if(v.firefox())ha-=2;if(v.ie()<=7){ha-=t.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(ha,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var ga=this._highlighter.offsetHeight,ha=this._typeahead.getElement();if(ga>ha.offsetHeight){t.set(ha,'height',ga+'px');g.inform('reflow');}}},_updateTypeahead:function(){var ga=this._typeahead.getCore(),ha=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)ha=r.autoMatcher;ga.matcher=ha;ga.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setPlaceholder:function(ga){this._placeholder=ga;if(!this.hasAuxContent())o.setPlaceholder(this._input,ga);},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent()||this._hashtags.length);},setAuxContent:function(ga){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,ga);if(ga){o.setPlaceholder(this._input,'');}else o.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var ga=this.getAuxContentRoot();return ga&&ga.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(ga){var ha=this._getMarkedValue();if(ha!=='')ha+=' ';o.setValue(this._input,ha+ca(ga.text)+' ');this._addToken(ga);this._update();},getMentions:function(){return this._mentioned;}});e.exports=fa;});
__d("MentionsTypeaheadAreaView",["Class","ContextualTypeaheadView","Parent","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('ContextualTypeaheadView'),i=b('Parent'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,h);j(k.prototype,{getContext:function(){return i.byClass(this.element,'uiMentionsInput');}});e.exports=k;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("FutureSideNavItem",["Arbiter","CSS","DOM","Parent","$","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('Parent'),k=b('$'),l=b('copyProperties'),m=b('createArrayFrom');function n(o,p){this.id=o.id;this.up=p;this.endpoint=o.endpoint;this.type=o.type;this.node=o.node||k(o.id);this.paths=o.path?m(o.path):[];this.keys=o.key?m(o.key):[];var q=this._findKeys(this.keys);this.numericKey=q.numeric||this.keys[0];this.textKey=q.text||this.keys[0];this._pathPattern=this._buildRegex(this.paths);this._keyPattern=this._buildRegex(this.keys);this.hideLoading();this.hideSelected();}l(n.prototype,{equals:function(o){return o&&o.id===this.id;},getLinkNode:function(){return (i.scry(this.node,'a.item')[0]||i.scry(this.node,'a.subitem')[0]);},matchPath:function(o){return this._matchInput(this._pathPattern,o);},matchKey:function(o){return this._matchInput(this._keyPattern,o);},_matchInput:function(o,p){var q=o&&o.exec(p);return q&&q.slice(1);},getTop:function(){return this.isTop()?this:this.up.getTop();},isTop:function(o){return !this.up;},setCount:function(o,p){return this._updateCount(o,true);},incrementCount:function(o,p){return this._updateCount(o,false);},_updateCount:function(o,p,q){var r=i.scry(this.node,'span.count')[0],s=r&&i.scry(r,'span.countValue')[0];if(s){var t=p?0:parseInt(i.getText(s),10),u=Math.max(0,t+o),v=this.isTop()?'hidden':'hiddenSubitem';i.setContent(s,u);q&&h.conditionClass(this.node,v,!u);h.conditionClass(r,'hidden_elem',!u);if(this.isTop()){var w=i.scry(this.node,'div.linkWrap')[0];if(w){h.conditionClass(w,'noCount',!u);h.conditionClass(w,'hasCount',u);}}}g.inform('NavigationMessage.COUNT_UPDATE_DONE');},showLoading:function(){h.addClass(this.node,'loading');},hideLoading:function(){h.removeClass(this.node,'loading');},showSelected:function(){h.addClass(this.node,'selectedItem');h.hasClass(this.node,'hider')&&h.addClass(this._getExpanderParent(),'expandedMode');},hideSelected:function(){h.removeClass(this.node,'selectedItem');},showChildren:function(){h.addClass(this.node,'open');},hideChildren:function(){h.removeClass(this.node,'open');},_getExpanderParent:function(){return j.byClass(this.node,'expandableSideNav');},_buildRegex:function(o){if(o.length){var p=o.map(function(q){if(typeof q==="string"){return q.replace(/([^a-z0-9_])/ig,'\\$1');}else if(q&&q.regex)return q.regex;});return new RegExp('^(?:'+p.join('|')+')$');}},_findKeys:function(o){var p=/^(app|group|fl)_/,q={};for(var r=0;r<o.length;r++){var s=p.test(o[r]);if(s&&!q.numeric){q.numeric=o[r];}else if(!s&&!q.text)q.text=o[r];if(q.numeric&&q.text)break;}return q;}});e.exports=n;});
__d("FutureSideNavSection",["Bootloader","DOMQuery","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('DOMQuery'),i=b('$'),j=b('copyProperties');function k(l){this.id=l.id;this.node=this.node||i(l.id);this.editEndpoint=l.editEndpoint;}j(k.prototype,{equals:function(l){return l&&l.id===this.id;},getEditorAsync:function(l){g.loadModules(['SortableSideNav'],function(m){var n=new m(h.find(this.node,'ul.uiSideNav'),this.editEndpoint);l(n);}.bind(this));}});e.exports=k;});
__d("FutureSideNav",["event-extensions","Arbiter","Bootloader","ChannelConstants","CSS","DOM","FutureSideNavItem","FutureSideNavSection","NavigationMessage","PageTransitions","Parent","Run","SelectorDeprecated","URI","UserAgent","Vector","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Bootloader'),i=b('ChannelConstants'),j=b('CSS'),k=b('DOM'),l=b('FutureSideNavItem'),m=b('FutureSideNavSection'),n=b('NavigationMessage'),o=b('PageTransitions'),p=b('Parent'),q=b('Run'),r=b('SelectorDeprecated'),s=b('URI'),t=b('UserAgent'),u=b('Vector'),v=b('copyProperties'),w=b('createArrayFrom');function x(){x.instance&&x.instance.uninstall();x.instance=this;}x.instance=null;x.getInstance=function(){return x.instance||new x();};v(x.prototype,{init:function(y,z,aa){this.root=y;this.items={};this.sections={};this.editor=null;this.editing=false;this.selected=null;this.loading=null;this.keyParam='sk';this.defaultKey=z;this.uri=s.getRequestURI();this.ajaxPipe=aa;this.ajaxPipeEndpoints={};this.sidecol=true;this._installed=true;this._handlePageTransitions=true;o.registerHandler(function(ba){return this._handlePageTransitions&&this.handlePageTransition(ba);}.bind(this));this._eventHandlers=[];this._arbiterSubscriptions=[g.subscribe(n.NAVIGATION_COMPLETED,this.navigationComplete.bind(this)),g.subscribe(n.NAVIGATION_FAILED,this.navigationFailed.bind(this)),g.subscribe(n.NAVIGATION_COUNT_UPDATE,this.navigationCountUpdate.bind(this)),g.subscribe(n.NAVIGATION_SELECT,this.navigationSelect.bind(this)),g.subscribe(i.getArbiterType('nav_update_counts'),this.navigationCountUpdateFromPresence.bind(this))];this._explicitHover=[];this._ensureHover('sideNavItem');this._eventHandlers.push(Event.listen(window,'resize',this._handleResize.bind(this)));this._checkNarrow();this._selectorSubscriptions=[];window.Selector&&this._selectorSubscriptions.push(r.subscribe(['open','close'],function(ba,ca){var da=p.byClass(ca.selector,'sideNavItem');da&&j.conditionClass(da,'editMenuOpened',ba==='open');}));q.onLeave(this.uninstall.bind(this));if(this._pendingSections)this._pendingSections.forEach(function(ba){this.initSection.apply(this,ba);}.bind(this));},_handleResize:(function(){var y;return function(){y&&clearTimeout(y);y=this._checkNarrow.bind(this).defer(200);};})(),_checkNarrow:function(){j.conditionClass(this.root,'uiNarrowSideNav',u.getElementPosition(this.root).x<20);},_ensureHover:function(y){if(t.ie()<8)h.loadModules(['ExplicitHover'],function(z){this._explicitHover.push(new z(this.root,y));}.bind(this));},uninstall:function(){if(this._installed){this._installed=false;this._handlePageTransitions=false;this._arbiterSubscriptions.forEach(g.unsubscribe);this._selectorSubscriptions.forEach(function(y){r.unsubscribe(y);});this._eventHandlers.forEach(function(y){y.remove();});this._explicitHover.forEach(function(y){y.uninstall();});}},initSection:function(y,z){if(!this._installed){this._pendingSections=this._pendingSections||[];this._pendingSections.push(arguments);return;}this._initItems(z);this._initSection(y);},addItem:function(y,z){this._initItem(y,z);},_initItems:function(y){var z=function(aa,ba){var ca=this._initItem(aa,ba);if(aa.children)aa.children.forEach(function(da){z(da,ca);});}.bind(this);w(y).forEach(function(aa){z(aa,null);});},_initItem:function(y,z){var aa=this.items[y.id]=this._constructItem(y,z);if(aa.equals(this.selected)||y.selected)this.setSelected(aa);var ba=aa.getLinkNode();ba&&this._eventHandlers.push(Event.listen(ba,'click',function(event){return !this.editing;}.bind(this)));return aa;},_initSection:function(y){var z=this.sections[y.id]=this._constructSection(y);this._eventHandlers.push(Event.listen(z.node,'click',this.handleSectionClick.bind(this,z)));k.scry(z.node,'div.bookmarksMenuButton').forEach(j.show);return z;},_constructItem:function(y,z){return new l(y,z);},_constructSection:function(y){return new m(y);},handleSectionClick:function(y,event){var z=this._getEventTarget(event,'a'),aa=this._getItemForNode(z);if(!z){return;}else if(j.hasClass(z.parentNode,'uiMenuItem')){this._handleMenuClick(y,aa,z.parentNode,event);}else this._handleLinkClick(y,z,event);},_getEventTarget:function(event,y){var z=event.getTarget();if(z.tagName!==y.toUpperCase()){return p.byTag(z,y);}else return z;},_handleMenuClick:function(y,z,aa,event){if(j.hasClass(aa,'rearrange'))this.beginEdit(y);},_handleLinkClick:function(y,z,event){if(j.hasClass(z,'navEditDone')){this.editing?this.endEdit():this.beginEdit(y);event.kill();}},getItem:function(y){if(this._isCurrentPath(y)){return this._getItemForKey(this._getKey(y.getQueryData())||this.defaultKey);}else return this._getItemForPath(y.getPath());},getNodeForKey:function(y){var z=this._getItemForKey(y);if(z)return z.node;},_isCurrentPath:function(y){return y.getDomain()===this.uri.getDomain()&&y.getPath()===this.uri.getPath();},_getKey:function(y){return y[this.keyParam];},_getItemForNode:function(y){y=p.byClass(y,'sideNavItem');return y&&this.items[y.id];},_getItemForKey:function(y){return this._findItem(function(z){return z.matchKey(y);});},_getItemForPath:function(y){return this._findItem(function(z){return z.matchPath(y);});},_findItem:function(y){for(var z in this.items)if(y(this.items[z]))return this.items[z];},removeItem:function(y){if(y&&this.items[y.id]){k.remove(y.node);delete this.items[y.id];}},removeItemByKey:function(y){this.removeItem(this._getItemForKey(y));},moveItem:function(y,z,aa){var ba=k.find(y.node,'ul.uiSideNav');(aa?k.prependContent:k.appendContent)(ba,z.node);},setLoading:function(y){this.loading&&this.loading.hideLoading();this.loading=y;this.loading&&this.loading.showLoading();},setSelected:function(y){this.setLoading(null);if(this.selected){this.selected.hideSelected();this.selected.getTop().hideChildren();}this.selected=y;if(this.selected){this.selected.showSelected();this.selected.getTop().showChildren();}},handlePageTransition:function(y){var z=this.getItem(y),aa=z&&z.endpoint&&this._doPageTransition(z,y);return aa;},_doPageTransition:function(y,z){this.setLoading(y);this._sendPageTransition(y.endpoint,v(this._getTransitionData(y,z),z.getQueryData()));return true;},_sendPageTransition:function(y,z){z.endpoint=y;g.inform(n.NAVIGATION_BEGIN,{useAjaxPipe:this._useAjaxPipe(y),params:z});},_getTransitionData:function(y,z){var aa={};aa.sidecol=this.sidecol;aa.path=z.getPath();aa[this.keyParam]=y.textKey;aa.key=y.textKey;return aa;},_useAjaxPipe:function(y){return this.ajaxPipe||this.ajaxPipeEndpoints[y];},navigationComplete:function(){this.loading&&this.setSelected(this.loading);},navigationFailed:function(){this.setLoading(null);},navigationSelect:function(y,z){var aa=this._getItemForKey(this._getKey(z));if(z.asLoading){this.setLoading(aa);}else this.setSelected(aa);},navigationCountUpdate:function(y,z){var aa=this._getItemForKey(z&&z.key);if(aa)if(typeof z.count!=="undefined"){aa.setCount(z.count,z.hide);}else if(typeof z.increment!=="undefined")aa.incrementCount(z.increment,z.hide);},navigationCountUpdateFromPresence:function(y,z){z=z.obj;if(z)if(!z.class_name||z.class_name&&j.hasClass(this.root,z.class_name))if(z.items)for(var aa=0;aa<z.items.length;aa++)this.navigationCountUpdate(y,z.items[aa]);},beginEdit:function(y){if(!this.editing){this.editing=true;j.addClass(this.root,'editMode');this._updateTrackingData();this._initEditor(y);}},endEdit:function(){if(this.editing){j.removeClass(this.root,'editMode');this.editor&&this.editor.endEdit();this.editor=null;this.editing=false;this._updateTrackingData();}},_updateTrackingData:function(y){var z=this.root.getAttribute('data-gt')||"{}";try{z=JSON.parse(z);if(this.editing){z.editing=true;}else delete z.editing;this.root.setAttribute('data-gt',JSON.stringify(z));}catch(aa){}},_initEditor:function(y){y.getEditorAsync(function(z){if(this.editing){this.editor=z;this.editor.beginEdit();}}.bind(this));}});e.exports=x;});
__d("legacy:ui-side-nav-future-js",["FutureSideNav"],function(a,b,c,d){a.FutureSideNav=b('FutureSideNav');},3);
__d("FreeformTokenizerBehavior",["Input","Keys","Event","function-extensions"],function(a,b,c,d,e,f){var g=b('Input'),h=b('Keys'),i=b('Event');b('function-extensions');function j(k,l){var m=l.tokenize_on_blur!==false,n=l.tokenize_on_paste!==false,o=l.matcher&&new RegExp(l.matcher,'i'),p=l.paste_split&&new RegExp(l.paste_split),q=l.select_on_comma!==false;function r(event){var s=g.getValue(k.getInput()).trim();if(p&&event&&event.type=='paste'){s=s.split(p);}else s=[s];var t=false;for(var u=0;u<s.length;u++){var v=s[u].trim();if(v&&(!o||o.test(v))){var w={uid:v,text:v,freeform:true};k.addToken(k.createToken(w));t=true;}}if(event&&t){k.getTypeahead().getCore().afterSelect();event.kill();}}k.subscribe('keydown',function(s,t){var event=t.event,u=i.getKeyCode(event);if((q&&u==h.COMMA)||u==h.RETURN){var v=k.getTypeahead().getView();if(v.getSelection()){v.select();event.kill();}else r(event);}});k.subscribe('paste',function(s,t){if(n)r.bind(null,t.event).defer(20);});k.subscribe('blur',function(s,t){if(m)r();k.getTypeahead().getCore().reset();});}e.exports=j;});
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties'),k=b('emptyFunction');function l(m){this.parent.construct(this,m);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(l,i);j(l.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:k,select:function(m){this.parent.select(m);var n=this.element.value,o=this.prefix+m.text+this.suffix;this.expandBounds(n,o);var p=n.substring(0,this.start),q=n.substring(this.end);this.element.value=p+o+q;h.set(this.element,p.length+o.length);},expandBounds:function(m,n){m=m.toLowerCase();n=n.toLowerCase();var o,p,q,r,s=/\s/;p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.start;while(o>=0&&q>=0){r=m.charAt(o-1);if(!r||s.test(r))this.start=o;p=r+p;q=n.indexOf(p);o--;}p=m.substring(this.start,this.end);q=n.indexOf(p);o=this.end;while(o<=m.length&&q>=0){r=m.charAt(o);if(!r||s.test(r))this.end=o;p=p+r;q=n.indexOf(p);o++;}},getRawValue:function(){var m=h.get(this.element).start||0;return this.parent.getValue().substring(0,m);},getValue:function(){var m=this.matcher&&this.matcher.exec(this.getRawValue());if(!m)return '';var n=m[0],o=m.index+n.length;n=n.replace(/^\s/,'');var p=n.length;n=n.replace(/\s$/,'');var q=p-n.length;this.start=o-p;this.end=o+q;return m[1]||m[0];}});e.exports=l;});
__d("TypeaheadMetrics",["Event","AsyncRequest","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('emptyFunction');function k(l){this.extraData={};i(this,l);}i(k.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(l){this.init=j;this.core=l.getCore();this.view=l.getView();this.data=l.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.results=null;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(l){var m=l.selected;if(m.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',m.uid);this.recordStat('selected_type',m.type);this.recordStat('selected_position',l.index);this.recordStat('selected_with_mouse',l.clicked?1:0);this.recordStat('selected_query',l.query);this._sessionEnd();},bindSessionStart:function(l,event,m){if(m)for(var n=0;n<this._sessionStartEvents.length;++n){var o=this._sessionStartEvents[n];o.obj.unsubscribe(o.token);}this._sessionStartEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionStart();}.bind(this))});},bindSessionEnd:function(l,event,m){if(m)for(var n=0;n<this._sessionEndEvents.length;++n){var o=this._sessionEndEvents[n];o.obj.unsubscribe(o.token);}this._sessionEndEvents.push({obj:l,token:l.subscribe(event,function(p,q){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(l,m){this.recordSelect(m);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(l,m){this.results=m;}.bind(this));this.data.subscribe('beforeQuery',function(l,m){if(!m.value)return;this.query=m.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(l,m){if(m.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else m.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(l,m){if(m.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var n={};m.response.payload.entries.forEach(function(o){if(!n[o.type]){n[o.type]=1;}else n[o.type]++;});this.recordStat('bootstrap_response_types',n);this.bootstrapped=true;}else{if('filtered_count' in m.response.payload)this.recordStat('filtered_count',m.response.payload.filtered_count);this.recordAvgStat('avg_query_latency',Date.now()-m.fetch_context.queryBegin);}}.bind(this));this.data.subscribe('dirty',function(l,m){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(l,m){this.stats[l]=m;},recordCountStat:function(l){var m=this.stats[l];this.stats[l]=m?m+1:1;},recordAvgStat:function(l,m){if(this.avgStats[l]){this.avgStats[l][0]+=m;++this.avgStats[l][1];}else this.avgStats[l]=[m,1];},submit:function(){if(Object.keys(this.stats).length){i(this.stats,this.extraData);if(this.results){var l=(this.results).map(function(o,p){return o.uid;});this.recordStat('candidate_results',JSON.stringify(l));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var m in this.avgStats){var n=this.avgStats[m];this.stats[m]=n[0]/n[1];}new h().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});k.register=function(l,m,n){if(document.activeElement===l){m.init(n);}else var o=g.listen(l,'focus',function(){m.init(n);o.remove();});};e.exports=k;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[],n=[];for(var o=0;o<k.results.length;++o){var p=k.results[o];if(p.type=='header'){n=n.concat(m,l);n.push(p);m=[];l=[];}else if(p.type=='user'&&p.bootstrapped){m.push(p);}else l.push(p);}k.results=n.concat(m,l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);