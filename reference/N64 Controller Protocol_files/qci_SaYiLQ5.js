/*1369921686,173199415*/

if (self.CavalryLogger) { CavalryLogger.start_js(["Qthjj"]); }

__d("MercuryAPIArgsSource",[],function(a,b,c,d,e,f){e.exports={JEWEL:"jewel",CHAT:"chat",MERCURY:"mercury",WEBMESSENGER:"web_messenger"};});
__d("MercuryActionStatus",[],function(a,b,c,d,e,f){e.exports={UNCONFIRMED:3,UNSENT:0,RESENDING:7,RESENT:6,UNABLE_TO_CONFIRM:5,FAILED_UNKNOWN_REASON:4,SUCCESS:1,ERROR:10};});
__d("MercuryActionTypeConstants",[],function(a,b,c,d,e,f){e.exports={LOG_MESSAGE:"ma-type:log-message",CLEAR_CHAT:"ma-type:clear_chat",UPDATE_ACTION_ID:"ma-type:update-action-id",DELETE_MESSAGES:"ma-type:delete-messages",CHANGE_FOLDER:"ma-type:change-folder",SEND_MESSAGE:"ma-type:send-message",CHANGE_ARCHIVED_STATUS:"ma-type:change-archived-status",DELETE_THREAD:"ma-type:delete-thread",USER_GENERATED_MESSAGE:"ma-type:user-generated-message",CHANGE_READ_STATUS:"ma-type:change_read_status",CHANGE_MUTE_SETTINGS:"ma-type:change-mute-settings"};});
__d("MercuryAttachmentContentType",[],function(a,b,c,d,e,f){e.exports={UNKNOWN:"attach:unknown",PHOTO:"attach:image",VIDEO:"attach:video",MSWORD:"attach:ms:word",VOICE:"attach:voice",MSPPT:"attach:ms:ppt",TEXT:"attach:text",MUSIC:"attach:music",MSXLS:"attach:ms:xls"};});
__d("MercuryAttachmentType",[],function(a,b,c,d,e,f){e.exports={PHOTO:"photo",FILE:"file",SHARE:"share",ERROR:"error"};});
__d("MercuryErrorType",[],function(a,b,c,d,e,f){e.exports={SERVER:1,TRANSPORT:2,TIMEOUT:3};});
__d("MercuryGenericConstants",[],function(a,b,c,d,e,f){e.exports={PENDING_THREAD_ID:"pending:pending"};});
__d("MercuryGlobalActionType",[],function(a,b,c,d,e,f){e.exports={MARK_ALL_READ:"mga-type:mark-all-read"};});
__d("MercuryLogMessageType",[],function(a,b,c,d,e,f){e.exports={SERVER_ERROR:"log:error-msg",UNSUBSCRIBE:"log:unsubscribe",JOINABLE_JOINED:"log:joinable-joined",JOINABLE_CREATED:"log:joinable-created",LIVE_LISTEN:"log:live-listen",PHONE_CALL:"log:phone-call",THREAD_IMAGE:"log:thread-image",THREAD_NAME:"log:thread-name",VIDEO_CALL:"log:video-call",SUBSCRIBE:"log:subscribe"};});
__d("MercuryMessageSourceTags",[],function(a,b,c,d,e,f){e.exports={CHAT:"source:chat",MOBILE:"source:mobile",MESSENGER:"source:messenger",EMAIL:"source:email"};});
__d("MercuryParticipantTypes",[],function(a,b,c,d,e,f){e.exports={FRIEND:"friend",USER:"user",THREAD:"thread",EVENT:"event",PAGE:"page"};});
__d("MercuryParticipantsConstants",[],function(a,b,c,d,e,f){e.exports={EMAIL_IMAGE:"\/images\/messaging\/threadlist\/envelope.png",BIG_IMAGE_SIZE:50,IMAGE_SIZE:32,UNKNOWN_GENDER:0};});
__d("MercuryPayloadSource",[],function(a,b,c,d,e,f){e.exports={SERVER_INITIAL_DATA:"server_initial_data",CLIENT_DELETE_THREAD:"client_delete_thread",SERVER_SAVE_DRAFT:"server_save_draft",SERVER_CHANGE_ARCHIVED_STATUS:"server_change_archived_status",SERVER_SEARCH:"server_search",CLIENT_CHANGE_MUTE_SETTINGS:"client_change_mute_settings",SERVER_UNREAD_THREADS:"server_unread_threads",SERVER_MARK_SEEN:"server_mark_seen",SERVER_THREAD_SYNC:"server_thread_sync",CLIENT_DELETE_MESSAGES:"client_delete_messages",SERVER_FETCH_THREADLIST_INFO:"server_fetch_threadlist_info",CLIENT_CHANNEL_MESSAGE:"client_channel_message",CLIENT_CHANGE_FOLDER:"client_change_folder",CLIENT_CHANGE_READ_STATUS:"client_change_read_status",CLIENT_CLEAR_CHAT:"client_clear_chat",SERVER_FETCH_THREAD_INFO:"server_fetch_thread_info",SERVER_CHANGE_READ_STATUS:"server_change_read_status",SERVER_SEND_MESSAGE:"server_send_message",CLIENT_SAVE_DRAFT:"client_save_draft",UNKNOWN:"unknown",SERVER_MARK_FOLDER_READ:"server_mark_folder_read",SERVER_CONFIRM_MESSAGES:"server_confirm_messages",SERVER_TAB_PRESENCE:"server_tab_presence",CLIENT_CHANGE_ARCHIVED_STATUS:"client_change-archived_status",CLIENT_SEND_MESSAGE:"client_send_message",CLIENT_HANDLE_ERROR:"client_handle_error"};});
__d("MercuryServerRequestsConfig",[],function(a,b,c,d,e,f){e.exports={sendMessageTimeout:45000};});
__d("MercurySourceType",[],function(a,b,c,d,e,f){e.exports={GIGABOXX_BLAST:"source:gigaboxx:blast",TITAN_FACEWEB_BUFFY:"source:titan:faceweb_buffy",TITAN_FACEWEB_UNKNOWN:"source:titan:faceweb_unknown",CHAT_WEB:"source:chat:web",WEBRTC_MOBILE:"source:webrtc:mobile",GIGABOXX_API:"source:gigaboxx:api",TITAN_M_JAPAN:"source:titan:m_japan",BUFFY_SMS:"source:buffy:sms",SEND_PLUGIN:"source:sendplugin",CHAT_MEEBO:"source:chat:meebo",TITAN_FACEWEB_IPAD:"source:titan:faceweb_ipad",TITAN_FACEWEB_IPHONE:"source:titan:faceweb_iphone",TEST:"source:test",WEB:"source:web",SOCIALFOX:"source:socialfox",EMAIL:"source:email",TITAN_API:"source:titan:api",GIGABOXX_WEB:"source:gigaboxx:web",DESKTOP:"source:desktop",TITAN_FACEWEB_ANDROID:"source:titan:faceweb_android",TITAN_M_APP:"source:titan:m_app",CHAT_JABBER:"source:chat:jabber",CHAT_TEST:"source:chat:test",SHARE_DIALOG:"source:share:dialog",GIGABOXX_WAP:"source:gigaboxx:wap",CHAT:"source:chat",TITAN_M_TOUCH:"source:titan:m_touch",TITAN_ORCA:"source:titan:orca",TITAN_WAP:"source:titan:wap",TITAN_EMAIL_REPLY:"source:titan:emailreply",CHAT_IPHONE:"source:chat:iphone",SMS:"source:sms",TITAN_M_BASIC:"source:titan:m_basic",TITAN_M_MINI:"source:titan:m_mini",GIGABOXX_MOBILE:"source:gigaboxx:mobile",UNKNOWN:"source:unknown",TITAN_WEB:"source:titan:web",TITAN_M_ZERO:"source:titan:m_zero",MOBILE:"source:mobile",PAID_PROMOTION:"source:paid_promotion",TITAN_API_MOBILE:"source:titan:api_mobile",HELPCENTER:"source:helpcenter",GIGABOXX_EMAIL_REPLY:"source:gigaboxx:emailreply",CHAT_ORCA:"source:chat:orca",TITAN_M_TALK:"source:titan:m_talk",NEW_SHARE_DIALOG:"source:share:dialog:new"};});
__d("MercuryThreadMode",[],function(a,b,c,d,e,f){e.exports={EMAIL_ORIGINATED:1,OBJECT_ORIGINATED:3,TITAN_ORIGINATED:2};});
__d("MercuryThreadlistConstants",[],function(a,b,c,d,e,f){e.exports={SEARCH_TAB:"searchtab",JEWEL_MORE_COUNT:10,WEBMESSENGER_SEARCH_SNIPPET_COUNT:5,WEBMESSENGER_SEARCH_SNIPPET_MORE:5,RECENT_MESSAGES_LIMIT:10,WEBMESSENGER_SEARCH_SNIPPET_LIMIT:5,WEBMESSENGER_MORE_MESSAGES_COUNT:20,WEBMESSENGER_MORE_COUNT:20,JEWEL_THREAD_COUNT:5,RECENT_THREAD_OFFSET:0,MAX_CHARS_BEFORE_BREAK:280,MESSAGE_TIMESTAMP_THRESHOLD:1209600000,GROUPING_THRESHOLD:300000,MAX_UNSEEN_COUNT:99,MAX_UNREAD_COUNT:99,WEBMESSENGER_THREAD_COUNT:20};});
__d("MercuryTimePassed",[],function(a,b,c,d,e,f){e.exports={TODAY:0,WEEK_AGO:1,CURRENT_YEAR:3,OTHER_YEAR:4,MONTH_AGO:2};});
__d("MessagingConfig",[],function(a,b,c,d,e,f){e.exports={SEND_BATCH_LIMIT:5,IDLE_CUTOFF:30000,SEND_CONNECTION_RETRIES:2};});
__d("MessagingEvent",[],function(a,b,c,d,e,f){e.exports={UNSUBSCRIBE:"unsubscribe",DELIVERY_RECEIPT:"delivery_receipt",REPORT_SPAM_MESSAGES:"report_spam_messages",DELIVER_FAST_PAST:"deliver_fast_path",DELETE_MESSAGES:"delete_messages",READ_RECEIPT:"read_receipt",SENT_PUSH:"sent_push",READ:"read",CHANGE_MUTE_SETTINGS:"change_mute_settings",ERROR:"error",UNMARK_SPAM:"unmark_spam",UNREAD:"unread",DELIVER_LOG:"deliver_log",DELIVER:"deliver",READ_ALL:"read_all",TAG:"tag",MORE_THREADS:"more_threads",DELETE:"delete",REPORT_SPAM:"report_spam",SUBSCRIBE:"subscribe"};});
__d("MessagingTag",[],function(a,b,c,d,e,f){e.exports={MTA_SYSTEM_MESSAGE:"MTA:system_message",SENT:"sent",INBOX:"inbox",SMS_TAG_ROOT:"SMSShortcode:",OTHER:"other",UPDATES:"broadcasts_inbox",FILTERED_CONTENT:"filtered_content",ARCHIVED:"archived",ACTION_ARCHIVED:"action:archived",UNREAD:"unread",BCC:"header:bcc",SMS_MUTE:"sms_mute",DOMAIN_AUTH_PASS:"MTA:dmarc:pass",EVENT:"event",VOICEMAIL:"voicemail",DOMAIN_AUTH_FAIL:"MTA:dmarc:fail",SPAM_SPOOFING:"spam:spoofing",SPOOF_WARNING:"MTA:spoof_warning",SPAM:"spam",EMAIL_MESSAGE:"source:email",EMAIL:"email",APP_ID_ROOT:"app_id:"};});
__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});e.exports=l;});
__d("ChannelSubdomain",["Cookie","JSLogger"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=h.create('channel'),j=7,k=null;function l(o,p){var q=null,r=m(),s;o--;var t=Math.min(32,j*o);t=Math.max(t,1);var u=false;for(var v=0;v<32;v++){s=(v+p)%t;if(!(r&(1<<s))){u=true;break;}}if(u){k=s;q=k%j;g.set('sub',r|(1<<k));}else{k=-1;q=null;i.error('subdomain_overflow',{slot:k,max:o});}return q;}function m(){var o=g.get('sub')||0;o=parseInt(o,10);return isNaN(o)?0:o;}function n(){if(k!==null&&k>=0){var o=m()&~(1<<k);if(o){g.set('sub',o);}else g.clear('sub');}}e.exports={allocate:l,clear:n};});
__d("DocRPC",["ErrorUtils"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h={_apis:{},_dispatch:function(i){var j;try{i=JSON.parse(i);}catch(k){throw new Error('DocRPC unparsable dispatch: "'+i+'"');}if(h._apis.hasOwnProperty(i.api)){var l=h._apis[i.api];if(l[i.method])j=g.applyWithGuard(l[i.method],l,i.args);}if(j===undefined)j=null;return JSON.stringify(j);},publish:function(i,j){h._apis[j]=i;},proxy:function(i,j,k){var l={};k.forEach(function(m){l[m]=function(){var n={api:j,method:m,args:Array.prototype.slice.call(arguments)},o;try{if(i.closed)throw new Error('DocRPC window closed');o=i.DocRPC._dispatch(JSON.stringify(n));}catch(p){g.reportError(p);return;}if(typeof(o)=='string')try{o=JSON.parse(o);}catch(p){throw new Error('DocRPC '+j+'.'+m+' unparsable return: "'+o+'"');}return o;};});return l;}};e.exports=a.DocRPC=h;});
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('AjaxRequest'),j=b('URI'),k=b('JSLogger'),l=b('DocRPC'),m=b('ChannelConstants'),n=k.create('channel');function o(){return (1048576*Math.random()|0).toString(36);}function p(x,y){var z=x.subdomain;z=z===null?'':(z+'-');var aa=new j(y).setDomain(z+x.host+'.facebook.com').setPort(x.port).setSecure(j().isSecure());return aa;}function q(x){var y={partition:x.partition,cb:o()},z=p(x,'/p').setQueryData(y);n.log('start_p',{uri:z.toString()});var aa=new i('GET',z);if(i.supportsCORS())aa.xhr.withCredentials=true;var ba=function(ca){n.log('finish_p',{xhr:ca.toJSON?ca.toJSON():ca});};aa.timeout=x.P_TIMEOUT;aa.onError=aa.onSuccess=ba;aa.send();}function r(x,y,z){var aa=new Image(),ba=0,ca=function(fa){aa.abort();return fa?y():z();};aa.onload=function(){n.log('ping_ok',{duration:Date.now()-ba});ca(true);};aa.onerror=function(){q(x);ca(false);};var da=setTimeout(aa.onerror,10000,false);aa.abort=function(){if(da){clearTimeout(da);da=null;}aa.onload=aa.onerror=null;};var ea={partition:x.partition,cb:o()};ba=Date.now();aa.src=p(x,'/ping').setQueryData(ea);return aa;}function s(x,y,z,aa){var ba=new Date(),ca=(ba-x.userActive)/1000|0;if(ca<0)n.warn('idle_regression',{idleTime:ca,now:ba.getTime(),userActive:x.userActive});var da={channel:x.user_channel,seq:x.seq,partition:x.partition,clientid:x.sessionID,cb:o(),idle:ca};if(ca<60)da.state='active';if(x.streamingCapable){da.mode='stream';da.format='json';}if(x.profile)da.profile=x.profile;var ea=p(x,'/pull').setQueryData(da),fa=new i('GET',ea);if(i.supportsCORS())fa.xhr.withCredentials=true;fa.timeout=x.streamingCapable?x.STREAMING_TIMEOUT:x.LONGPOLL_TIMEOUT;fa.onJSON=y;fa.onSuccess=z;fa.onError=function(){var ga=(this.status==12002&&this._time>=x.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=x.MIN_504_TIMEOUT),ha=ga?z:aa;return ha&&ha.apply(this,arguments);};fa.send();x.inStreaming=x.streamingCapable;return fa;}function t(x){this.manager=x;(this.init&&this.init());}function u(x){t.apply(this,arguments);}g(u.prototype,{logName:'CORS',enterState:function(x,y){if(this._request){this._request.abort();this._request=null;}if(x=='init')setTimeout(h(this.manager,'exitState',{status:m.OK,stateId:y.stateId}),3000,false);if(!/pull|ping/.test(x))return;var z=this.manager;if(x=='ping'){this._request=r(y,h(z,'exitState',{status:m.OK,stateId:y.stateId}),h(z,'exitState',{status:m.ERROR,stateId:y.stateId}));}else if(x=='pull')this._request=s(y,h(z,'_processTransportData',y.stateId),h(z,'exitState',{status:m.OK,stateId:y.stateId}),h(z,'exitState',{status:m.ERROR,stateId:y.stateId}));}});function v(x){n.log('iframe_init_constructor');t.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(v.prototype,{logName:'iframe',_initIframe:function(x){n.log('iframe_init_start');window.onchanneliframeready=function(){n.log('iframe_resources');return x.resources;};window.onchanneliframeloaded=function(){n.log('iframe_loaded');};if(x){this._iframeURI=p(x,x.path);if(x.bustIframe){var y={partition:x.partition,cb:o()};this._iframeURI.setQueryData(y);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);n.log('iframe_uri_set');}catch(z){n.error('iframe_uri_set_error',z);this.exitState({status:m.ERROR,stateId:x.stateId},z+'');}},enterState:function(x,y){if(x=='init'){this._initIframe(y);}else if(/idle|ping|pull/.test(x)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(x!='idle')this.exitState({status:m.ERROR,stateId:y.stateId},'iframe not yet loaded');}else if(x=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(x){if(this.manager.state=='init'&&x.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function w(){this.init=this.init.bind(this);t.apply(this,arguments);}g(w.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var y=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,y);this.exitState({status:m.OK,stateId:1e+06});}catch(x){n.error('iframe_inner_init_error',x);}},enterState:function(x,y){if(this._request){this._request.abort();this._request=null;}if(x=='ping'){this._request=r(y,h(this,'exitState',{status:m.OK,stateId:y.stateId}),h(this,'exitState',{status:m.ERROR,stateId:y.stateId}));}else if(x=='pull')this._request=s(y,h(this,'_processTransportData',y.stateId),h(this,'exitState',{status:m.OK,stateId:y.stateId}),h(this,'exitState',{status:m.ERROR,stateId:y.stateId}));}});e.exports={getURI:p,Transport:t,CORSTransport:u,IframeTransport:v,IframeInnerTransport:w};});
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("PresenceUtil",["Cookie","Env","randomInt","tx"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Env'),i=b('randomInt'),j=b('tx'),k=i(0,4294967295)+1,l={checkMaintenanceError:function(m){if(m.getError()==1356007)return true;return false;},getErrorDescription:function(m){var n=m.getError(),o=m.getErrorDescription();if(!o)o="An error occurred.";if(n==1357001)o="Your session has timed out. Please log in.";return o;},getSessionID:function(){return k;},hasUserCookie:function(){return h.user===g.get('c_user');}};e.exports=l;});
__d("PresenceCookieManager",["Cookie","Dcode","ErrorUtils","Env","JSLogger","PresenceUtil","URI","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('Dcode'),i=b('ErrorUtils'),j=b('Env'),k=b('JSLogger'),l=b('PresenceUtil'),m=b('URI'),n=b('PresenceInitialData'),o=n.cookieVersion,p=n.dictEncode,q='presence',r={},s=null,t=null,u=k.create('presence_cookie');function v(){try{var z=g.get(q);if(s!==z){s=z;t=null;if(z&&z.charAt(0)=='E')z=h.decode(z.substring(1));if(z)t=JSON.parse(z);}if(t&&(!t.user||t.user===j.user))return t;}catch(y){u.warn('getcookie_error');}return null;}function w(){return parseInt(Date.now()/1000,10);}var x={register:function(y,z){r[y]=z;},store:function(){var y=v();if(y&&y.v&&o<y.v)return;var z={v:o,time:w(),user:j.user};for(var aa in r)z[aa]=i.applyWithGuard(r[aa],r,[y&&y[aa]],function(ea){ea.presence_subcookie=aa;});var ba=JSON.stringify(z);if(p)ba='E'+h.encode(ba);if(l.hasUserCookie()){var ca=ba.length;if(ca>1024)u.warn('big_cookie',ca);var da=m.getRequestURI(false).isSecure()&&!!g.get('csm');g.set(q,ba,null,null,da);}},clear:function(){g.clear(q);},getSubCookie:function(y){var z=v();if(!z)return null;return z[y];}};e.exports=x;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("PresenceState",["Arbiter","ErrorUtils","JSLogger","PresenceCookieManager","copyProperties","debounceAcrossTransitions","setIntervalAcrossTransitions","PresenceInitialData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('JSLogger'),j=b('PresenceCookieManager'),k=b('copyProperties'),l=b('debounceAcrossTransitions'),m=b('setIntervalAcrossTransitions'),n=b('PresenceInitialData'),o=n.cookiePollInterval||2000,p=[],q=[],r=null,s=null,t=0,u=null,v=0,w=['sb2','t2','lm2','uct2','tr','tw','at','wml'],x=i.create('presence_state');function y(){return j.getSubCookie('state');}function z(){t=Date.now();j.store();da(s);}var aa=l(z,0);function ba(ia){if(typeof ia=='undefined'||isNaN(ia)||ia==Number.POSITIVE_INFINITY||ia==Number.NEGATIVE_INFINITY)ia=0;return ia;}function ca(ia){var ja={};if(ia){w.forEach(function(ma){ja[ma]=ia[ma];});if(t<ia.ut)x.error('new_cookie',{cookie_time:ia.ut,local_time:t});}ja.ut=t;for(var ka=0,la=p.length;ka<la;ka++)h.applyWithGuard(p[ka],null,[ja]);s=ja;return s;}function da(ia){v++;t=ba(ia.ut);if(!r)r=m(ga,o);s=ia;if(u===null)u=ia;for(var ja=0,ka=q.length;ja<ka;ja++)h.applyWithGuard(q[ja],null,[ia]);v--;}function ea(ia){if(ia&&ia.ut)if(t<ia.ut){return true;}else if(ia.ut<t)x.error('old_cookie',{cookie_time:ia.ut,local_time:t});return false;}function fa(){var ia=y();if(ea(ia))s=ia;return s;}function ga(){var ia=y();if(ea(ia))da(ia);}j.register('state',ca);g.subscribe(i.DUMP_EVENT,function(ia,ja){ja.presence_state={initial:k({},u),state:k({},s),update_time:t,sync_paused:v,poll_time:o};});(function(){var ia=fa();if(ia){da(ia);}else{x.debug('no_cookie_initial');da(ca());return;}})();var ha={doSync:function(ia){if(v)return;if(ia){z();}else aa();},registerStateStorer:function(ia){p.push(ia);},registerStateLoader:function(ia){q.push(ia);},get:function(){return fa();},getInitial:function(){return u;},verifyNumber:ba};e.exports=ha;});
__d("ChannelManager",["Event","function-extensions","AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelSubdomain","ChannelTransport","Env","FBAjaxRequest","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","copyProperties","createArrayFrom","ChannelInitialData"],function(a,b,c,d,e,f){var g=b('Event');b('function-extensions');var h=b('AjaxRequest'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('ChannelConstants'),l=b('ChannelSubdomain'),m=b('ChannelTransport'),n=b('Env'),o=b('FBAjaxRequest'),p=b('JSLogger'),q=b('MovingStat'),r=b('PresenceCookieManager'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('Run'),v=b('SystemEvents'),w=b('URI'),x=b('UserActivity'),y=b('copyProperties'),z=b('createArrayFrom'),aa=c('ChannelInitialData'),ba,ca=p.create('channel'),da=null;function ea(pa){da=pa;}var fa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'reconnect',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ga={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:30000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1000,PROBE_HEARTBEATS_INTERVAL_HIGH:3000,STREAMING_EXIT_STATE_ON_CONTINUE:false},ha=1,ia={},ja=0;function ka(){return j.lastSuccessTime?Math.round((Date.now()-j.lastSuccessTime)/1000):-1;}function la(){var pa={};if(ba.getConfig('host'))pa[ba.getConfig('user_channel')]=ba.getConfig('seq',0);return pa;}function ma(){var pa=Date.now(),qa=Date.now(),ra={total:0},sa='idle',ta=false;v.subscribe([v.USER,v.ONLINE,v.TIME_TRAVEL],function(wa,xa){oa(true);qa=null;ba.lastPullTime=Date.now();var ya;switch(wa){case v.USER:ya=v.isPageOwner()?k.SYS_OWNER:k.SYS_NONOWNER;break;case v.ONLINE:ya=xa?k.SYS_ONLINE:k.SYS_OFFLINE;break;case v.TIME_TRAVEL:ya=k.SYS_TIMETRAVEL;break;}ba.exitState({status:ya,stateId:ha});});var ua=function(wa,xa){var ya=Date.now(),za;if(xa){pa=ya;za=xa.nextState||xa.state;}else za=sa;v.checkTimeTravel();if(qa){var ab=Math.round((ya-qa)/1000);if(ab>0){ra[sa]=(ra[sa]||0)+ab;ra.total+=ab;}}sa=za;qa=ya;if(!wa){ra.lastSuccessTime=ka();ra.online=v.isOnline();ca.log('rollup',ra);}};i.subscribe(k.ON_ENTER_STATE,ua);setInterval(ua,60000,false);i.subscribe(p.DUMP_EVENT,function(wa,xa){xa.channelRollup=ra;});var va=function(){if(ba.isShutdown()||ba.shouldIdle())return;v.checkTimeTravel();var wa=Date.now()-(ba.lastPullTime||n.start);if(!ta&&wa>ga.STALL_THRESHOLD){var xa=ka();ca.error('stall',{lastSuccessTime:xa,rollupState:sa});ta=true;}var ya=Date.now()-pa;if(ba.state=='pull'&&ya>ga.JUMPSTART_THRESHOLD){pa=null;ca.warn('jumpstart',{state:ba.state,dormant:ya});ba.enterState('init');}};setInterval(va,10000,false);}function na(){var pa=Date.now(),qa=1;function ra(){setTimeout(ra,qa*1000,false);var wa=ba.state;if(wa=='idle'&&ba.shouldIdle())return;ca.bump('conn_t',qa);if(wa=='pull')ca.bump('conn_t_pull',qa);}ra();var sa=[15,30,60,120,240],ta=false,ua=false;function va(wa){setTimeout(function(){ca.rate('pullenter_'+wa,ta);ca.rate('pullexit_'+wa,ua);},wa*1000,false);}while(sa.length)va(sa.shift());i.subscribe(k.ON_ENTER_STATE,function(wa,xa){if(xa.state=='pull')ta=true;pa=Date.now();});i.subscribe(k.ON_EXIT_STATE,function(wa,xa){if(xa.state!='pull'||!pa)return;var ya='other';if(xa.status==k.OK){ua=true;ya='ok';}else if(xa.xhr&&xa.xhr.errorType){ya=/ar:(\w+)/.test(xa.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(xa.status))return;var za=(Date.now()-pa)/1000;if(za<0){return;}else if(za>3600)za=3600;ca.bump('conn_num');ca.bump('conn_exit',za);ca.bump('conn_num_'+ya);ca.bump('conn_exit_'+ya,za);});}function oa(pa){if(pa){ja=0;ia={};}else ja++;}ba={state:'idle',nextState:null,lastPullTime:Date.now(),heartbeats:[],setTestCallback:ea,init:function(pa){this.init=function(){};if(typeof(x)!='undefined'){x.subscribe(function(){ga.userActive=Date.now();}.bind(this));}else ca.error('user_activity_undefined');r.register('ch',la);var qa=this.getConfig('max_conn',2),ra=Math.floor(Math.random()*32);ga.subdomain=l.allocate(qa,ra);if(typeof window.onpageshow!='undefined'){g.listen(window,'pagehide',l.clear);}else u.onUnload(l.clear);this._transportRate=new q(30000);var sa=(h.supportsCORS()&&!ga.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new m[sa](this);if(pa)this.enterState.apply(this,arguments);i.subscribe(p.DUMP_EVENT,function(event,ua){ua.transportRate=this._transportRate.tally();ua.transportType=sa;ua.transportVersion=2;}.bind(this));ma();na();if(ba.getConfig('tryStreaming')&&ba.getConfig('host')&&h.supportsCORS()&&!ga.forceIframe){var ta=ga.MIN_INIT_PROBE_DELAY+Math.random()*ga.INIT_PROBE_DELAY_RANDOMIZE_RANGE;setTimeout(this._probeTest,ta,false);}},configure:function(){var pa=z(arguments);ca.log('configure',pa);pa.forEach(y.bind(null,ga));i.inform(k.ON_CONFIG,this);},getConfig:function(pa,qa){return pa in ga?ga[pa]:qa;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(v.isPageOwner()&&v.isOnline());},_sendIframeError:function(pa){var qa=new j().setURI('/ajax/presence/reconnect.php').setData({reason:pa,fb_dtsg:n.fb_dtsg}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);qa.specifiesWriteRequiredParams()&&qa.send();},_getDelay:function(){var pa=Math.min(ga.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,ja-1)),ga.MAX_RETRY_INTERVAL);return pa*(.75+Math.random()/2)|0;},enterState:function(){if(this._inEnterState)ca.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(pa){this._inEnterState=false;throw pa;}},_enterState:function(pa){var qa=0,ra=z(arguments);if(this.isShutdown())return;if(pa!='idle!'&&this.shouldIdle())return;ha++;ga.stateId=ha;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(pa)){var sa=this._transportRate.tally().timeAverage,ta=ba.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(sa>=ta){if(!this._throttled){this._throttled=true;ca.warn('throttled');}ca.bump('throttle');qa=1000/ta;}}else if(!(/#$/.test(pa)))qa=this._getDelay();pa=pa.replace(/\W*$/,'');if(!fa[pa])throw new Error('invalid state:'+pa);var ua;if(qa<=0){ua={state:pa};this._transportRate.add(1);this.state=pa;var va=this['_enter_'+this.state];if(va){ra.shift();va.apply(this,ra);}if(/init|idle|pull|ping/.test(this.state)){if(ga.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];this.transport.enterState(this.state,ga);if(this.state=='ping'){ua.url=m.getURI(ga).toString();ua.port=ga.port||'undefined';}}}else{this.state='idle';this.nextState=pa;ua={state:this.state,delay:qa,nextState:pa};ra[0]=pa+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,ra);}).bind(this).defer(qa,false);}if(/pull/.test(pa)){ua.client_id=ga.sessionID;ua.streaming=ga.inStreaming;}ca.log('enter_'+this.state,ua);i.inform(k.ON_ENTER_STATE,ua);},exitState:function(pa,qa){var ra=pa.stateId,sa=pa.status;if(this.isShutdown()||ra<ha)return;var ta=z(arguments),ua=this.state;ta[0]=pa.status;var va={state:ua,status:sa};if(/pull/.test(ua)){va.client_id=ga.sessionID;va.streaming=ga.inStreaming;}if(/ping/.test(ua)&&sa!=k.OK)va.url=m.getURI(ga).toString();if(this.nextState)va.nextState=this.nextState;if(qa&&qa.errorType){va.xhr=qa.toJSON?qa.toJSON():qa;delete va.xhr.json;}if(qa&&qa.json){if(qa.json.t)va.t=qa.json.t;if(qa.json.reason)va.reason=qa.json.reason;if(qa.json.seq)va.seq=qa.json.seq;}ca.log('exit_'+ua,va);i.inform(k.ON_EXIT_STATE,va);var wa=this['_exit_'+ua];if(wa)sa=wa.apply(this,ta)||sa;if(sa!=k.OK){oa();ia[ua]=(ia[ua]||0)+1;}var xa=fa[this.nextState||ua][sa]||fa._all[sa],ya=xa&&xa.replace(/!*$/,'');if(!ya){ca.error('terminal_transition',va);this._shutdownHint=k.HINT_INVALID_STATE;xa='shutdown!';}this._lastState=ua;this._lastStatus=sa;this.enterState(xa);},_processTransportData:function(pa,qa){var ra=qa.json,sa=ra.t;if('s' in ra){ra.seq=ra.s;delete ra.s;}var ta=ga.seq;if('seq' in ra){ga.seq=ra.seq;s.doSync();}switch(sa){case 'continue':if(ga.inStreaming&&this.heartbeats.length<1){ga.streamingCapable=false;ca.log('switch_to_longpoll');setTimeout(this._probeTest,ga.PROBE_DELAY,false);}oa(true);if(!ga.inStreaming||ga.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:k.OK,stateId:pa});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(ra.reason||0),stateId:pa},qa);break;case 'fullReload':r.clear();ca.log('invalid_history');i.inform(k.ON_INVALID_HISTORY);this.exitState({status:k.ERROR_MISSING,stateId:pa},qa);break;case 'msg':var ua,va,wa,xa;oa(true);va=ra.ms;wa=ga.seq-va.length;for(ua=0;ua<va.length;ua++,wa++)if(wa>=ta){xa=va[ua];if(xa.type){if(xa.type==='messaging'&&xa.message){var ya=xa.unread_counts&&xa.unread_counts.inbox;ca.debug('message',{type:'messaging',inbox_unread:ya,tid:xa.message.tid,mid:xa.message.mid});}else if(xa.type==='m_messaging'){ca.debug('message',{type:'m_messaging',tid:xa.tid,mid:xa.uuid});}else ca.debug('message',{type:xa.type});i.inform(k.getArbiterType(xa.type),{obj:xa});}}else ca.warn('seq_regression',{seq:wa,last_seq:ta,messages:va.length});break;case 'heartbeat':if(ga.inStreaming){var za=Date.now();if(this.heartbeats.length>0){var ab=za-this.heartbeats[this.heartbeats.length-1];ca.log('heartbeat_interval',{client_id:ga.sessionID,interval:ab});}this.heartbeats.push(za);}break;default:ca.error('unknown_msg_type',{type:sa});break;}},_enter_init:function(){if(ia.init>=ba.getConfig('MAX_INIT_FAILS',2))return this.exitState.bind(this,{status:k.ERROR_MAX,stateId:ha}).defer();this._initTimer=this.exitState.bind(this,{status:k.ERROR,stateId:ha},'timeout').defer(ga.IFRAME_LOAD_TIMEOUT,false);},_enter_reconnect:function(pa){var qa=ha;if(!t.hasUserCookie()){ca.warn('no_user_cookie');(function(){ba._shutdownHint=k.HINT_AUTH;ba.exitState({status:k.ERROR_SHUTDOWN,stateId:qa});}).defer();return;}var ra={reason:pa,fb_dtsg:n.fb_dtsg};if(n.fb_isb)ra.fb_isb=n.fb_isb;if(da)da(ra);var sa=new o('GET','/ajax/presence/reconnect.php',ra);sa.onSuccess=(function(){ba.configure(sa.json);r.store();this.exitState({status:k.OK,stateId:qa});}).bind(this);sa.onError=(function(){var ta=sa.json&&sa.json.error;if(sa.errorType==h.TRANSPORT_ERROR||sa.errorType==h.PROXY_ERROR)this._shutdownHint=k.HINT_CONN;if(ta&&ta==1356007){this._shutdownHint=k.HINT_MAINT;}else if(ta==1357001||ta==1357004||ta==1348009){this._shutdownHint=k.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?k.ERROR_SHUTDOWN:k.ERROR,stateId:qa},sa);}).bind(this);sa.send();},_enter_shutdown:function(){i.inform(k.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(pa){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(pa==k.ERROR_MAX)this._sendIframeError(k.reason_IFrameLoadGiveUp);},_exit_pull:function(pa){if(pa==k.OK)this.lastPullTime=Date.now();},_exit_ping:function(pa){if(pa==k.OK){var qa=Date.now()-(this.lastPullTime||n.start);if(qa>ga.STALL_THRESHOLD)return k.ERROR_STALE;}},_probeTest:function(){ga.streamingCapable=false;var pa=[],qa={mode:'stream',format:'json'},ra=new w('/probe').setDomain(ga.host+'.facebook.com').setPort(ga.port).setSecure(w().isSecure()).setQueryData(qa),sa=new h('GET',ra);sa.onJSON=function(ta,ua){if(ta&&ta.json&&ta.json.t==='heartbeat'){pa.push(Date.now());if(pa.length>=2){var va=pa[1]-pa[0];if(va>=ga.PROBE_HEARTBEATS_INTERVAL_LOW&&va<=ga.PROBE_HEARTBEATS_INTERVAL_HIGH){ga.streamingCapable=true;ca.log('switch_to_streaming');}ca.log('probe_ok',{time:va});}}};sa.onSuccess=function(ta){if(pa.length!=2){ga.streamingCapable=false;ca.error('probe_error',{error:'beats.length = '+pa.length});}};sa.onError=function(ta){ga.streamingCapable=false;ca.error('probe_error',ta);};ca.log('probe_request');sa.send();}};e.exports=ba;if(aa.serverInitialized==null){ba.configure(aa.channelConfig);if(/shutdown/.test(aa.state))ba._shutdownHint=k[aa.reason];ba.init(aa.state,aa.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=n.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ba){v();q=w.defer(ba,false);o.log('mute_warning',{time:ba});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ba,ca){y();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var da=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){r=(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);o.log('reconnecting',{delay:ea});if(u.disconnected())o.log('reconnecting_ui',{delay:ea});s=u.RECONNECTING;(ca.state==='idle')&&t++;if(t>1){u.inform(u.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')z(ba,ca);}).defer(500,false);}else if(ba===l.ON_SHUTDOWN){o.log('shutdown',{reason:ca.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,ca.reason);}}function aa(ba){if(m.state==='ping'||m.isShutdown())return;o.log('reconnect',{now:ba});u.inform(u.RECONNECTING,0);if(!!ba){if(p!==null){clearTimeout(p);p=null;}m.enterState('ping!');}else if(!p)p=setTimeout(function(){m.enterState('ping!');p=null;},i.get('channel_manual_reconnect_defer_msec'),false);}if(m.isShutdown()){z(l.ON_SHUTDOWN,m._shutdownHint);}else z(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],z);k.subscribe(k.TIME_TRAVEL,function(){aa();x(i.get('mute_warning_time_msec'));});j.onBeforeUnload(y,false);h(u,{disconnected:function(){return s===u.SHUTDOWN||(s===u.RECONNECTING&&!q&&t>1);},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:aa,unmuteWarning:w});e.exports=u;});
__d("AvailableListConstants",[],function(a,b,c,d,e,f){var g={ON_AVAILABILITY_CHANGED:'buddylist/availability-changed',ON_UPDATE_ERROR:'buddylist/update-error',ON_UPDATED:'buddylist/updated',ON_CHAT_NOTIFICATION_CHANGED:'chat-notification-changed',OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,LEGACY_OVERLAY_OFFLINE:-1,LEGACY_OVERLAY_ONLINE:0,LEGACY_OVERLAY_IDLE:1,legacyStatusMap:{'0':2,'1':1,'-1':0,'2':3},reverseLegacyStatusMap:{0:-1,1:1,2:0,3:2}};a.AvailableListConstants=e.exports=g;});
__d("ChatContexts",[],function(a,b,c,d,e,f){var g={};function h(k){var l=k?k.subtext:'';return l;}function i(k,l){g[k]=l;}var j={get:function(k){if(k in g){return g[k];}else return null;},update:function(k){for(var l in k)i(l,k[l]);},getShortDisplay:function(k){return h(j.get(k));}};e.exports=j;});
__d("ChatFavoriteList",["AsyncRequest","arrayContains","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('arrayContains'),i=b('emptyFunction'),j=false,k=[],l=[],m=false;function n(){var r=k.join(',');new g('/ajax/chat/favorite_list.php').setData({favorite_list:r}).setHandler(i).setErrorHandler(i).send();}function o(r){return r.toString();}function p(r){if(k.length!=r.length)return true;for(var s=0;s<r.length;s++)if(k[s]!==r[s].toString())return true;return false;}var q={isEditMode:function(){var r=null;d(['ChatSidebar'],function(s){r=s;});return j&&r&&r.isEnabled();},toggleEditMode:function(){j=!j;if(j)l=k.slice();},get:function(){if(j){return l.slice();}else return k.slice();},isFavored:function(r){return h(l,r.toString());},init:function(r){k=r.slice().map(o);l=k.slice();},toggleID:function(r){if(!j)return;r=r.toString();var s=l.indexOf(r);if(s>=0){l.splice(s,1);}else l.push(r);m=true;},hasChanged:function(){if(m){m=false;return true;}return false;},updateList:function(r){if(!j)return;l=r.map(o);},save:function(){if(p(l)){k=l;n();}}};e.exports=q;});
__d("PresencePrivacy",["hasArrayNature","Arbiter","AsyncRequest","ChannelConstants","copyProperties","Env","JSLogger","PresenceUtil","PresencePrivacyInitialData"],function(a,b,c,d,e,f){var g=b('hasArrayNature'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('copyProperties'),l=b('Env'),m=b('JSLogger'),n=b('PresenceUtil'),o=b('PresencePrivacyInitialData'),p='/ajax/chat/privacy/settings.php',q='/ajax/chat/privacy/online_policy.php',r='/ajax/chat/privacy/visibility.php',s='friend_visibility',t='visibility',u='online_policy',v=k({},o.privacyData),w=o.visibility,x=k({},o.privacyData),y=w,z=o.onlinePolicy,aa=z,ba=[],ca=false;function da(){return m.create('blackbird');}var ea=k(new h(),{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1});function fa(ra){var sa;for(sa in ra){var ta=ra[sa];if(sa==l.user){da().error('set_viewer_visibility');throw new Error("Invalid to set current user's visibility");}switch(ta){case ea.WHITELISTED:case ea.BLACKLISTED:case ea.UNLISTED:break;default:da().error('set_invalid_friend_visibility',{id:sa,value:ta});throw new Error("Invalid state: "+ta);}}for(sa in ra)v[sa]=ra[sa];ea.inform('privacy-changed');}function ga(ra,sa){var ta={};ta[ra]=sa;fa(ta);}function ha(ra){switch(ra){case ea.ONLINE:case ea.OFFLINE:break;default:da().error('set_invalid_visibility',{value:ra});throw new Error("Invalid visibility: "+ra);}w=ra;ea.inform('privacy-changed');ea.inform('privacy-user-presence-changed');h.inform('chat/visibility-changed',{sender:this});}function ia(ra){switch(ra){case ea.ONLINE_TO_WHITELIST:case ea.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+ra);}z=ra;ea.inform('privacy-user-presence-changed');ea.inform('privacy-changed');}function ja(ra,sa){ca=true;ra.send();}function ka(ra,sa){ba.push({request:ra,data:sa});if(!ca){var ta=ba.shift();ja(ta.request,ta.data);}}function la(ra,sa){var ta=ra.type;if(ta===s){var ua=sa.payload.user_availabilities;if(!g(ua)){ea.inform('privacy-availability-changed',{user_availabilities:ua});for(var va in ra.settings)x[va]=ra.settings[va];}}else{if(ta===t){y=ra.visibility;}else if(ta===u)aa=ra.online_policy;ea.inform('privacy-user-presence-response');}da().log('set_update_response',{data:ra,response:sa});}function ma(ra,sa){if(w!==y)ha(y);if(z!==aa)ia(aa);k(v,x);ea.inform('privacy-changed');ba=[];da().log('set_error_response',{data:ra,response:sa});}function na(ra){ca=false;if(ba.length>0){var sa=ba.shift();ja(sa.request,sa.data);}}function oa(ra,sa){if(n!=null){var ta=ra.getData();ta.window_id=n.getSessionID();ra.setData(ta);}ra.setHandler(la.bind(this,sa)).setErrorHandler(ma.bind(this,sa)).setTransportErrorHandler(ma.bind(this,sa)).setFinallyHandler(na.bind(this)).setAllowCrossPageTransition(true);return ra;}function pa(ra,sa,ta){return oa(new i(ra).setData(sa),ta);}function qa(ra,sa){var ta=sa.obj;if(ta.viewer_id!=l.user){da().error('invalid_viewer_for_channel_message',{type:ra,data:sa});throw new Error("Viewer got from the channel is not the real viewer");}if(ta.window_id===n.getSessionID())return;var ua=ta.data;if(ta.event=='access_control_entry'){ua.target_ids.forEach(function(wa){ga(wa,ua.setting);x[wa]=ua.setting;});}else{if(ta.event=='visibility_update'){var va=!!ua.visibility?ea.ONLINE:ea.OFFLINE;ha(va);y=va;}else if(ta.event=='online_policy_update'){ia(ua.online_policy);aa=ua.online_policy;}ea.inform('privacy-user-presence-response');}da().log('channel_message_received',{data:sa.obj});}k(ea,{WHITELISTED:1,BLACKLISTED:-1,UNLISTED:0,ONLINE:1,OFFLINE:0,ONLINE_TO_WHITELIST:0,ONLINE_TO_BLACKLIST:1,init:function(ra,sa,ta){},setVisibility:function(ra){y=w;ha(ra);var sa={visibility:ra},ta={type:t,visibility:ra},ua=pa(r,sa,ta);ka(ua,ta);da().log('set_visibility',{data:sa});return ra;},getVisibility:function(){return w;},setOnlinePolicy:function(ra){aa=z;ia(ra);var sa={online_policy:ra},ta={type:u,online_policy:ra},ua=pa(q,sa,ta);ka(ua,ta);da().log('set_online_policy',{data:sa});return ra;},getOnlinePolicy:function(){return z;},getFriendVisibility:function(ra){return v[ra]||ea.UNLISTED;},allows:function(ra){if(this.getVisibility()===ea.OFFLINE)return false;var sa=this.getOnlinePolicy();return sa===ea.ONLINE_TO_WHITELIST?v[ra]==ea.WHITELISTED:v[ra]!=ea.BLACKLISTED;},setFriendsVisibility:function(ra,sa){if(ra.length>0){var ta={};for(var ua=0;ua<ra.length;ua++){var va=ra[ua];x[va]=v[va];ta[va]=sa;}fa(ta);var wa=sa;if(wa==ea.UNLISTED)wa=x[ra[0]];var xa={users:ra,setting:sa,setting_type:wa},ya={type:s,settings:ta},za=pa(p,xa,ya);ka(za,ya);da().log('set_friend_visibility',{data:xa});}return sa;},setFriendVisibilityMap:function(ra,sa){for(var ta in ra)x[ta]=v[ta];fa(ra);var ua={type:s,settings:ra};ka(oa(sa,ua),ua);da().log('set_friend_visibility_from_map',{data:ra});},allow:function(ra){if(this.allows(ra)){da().error('allow_already_allowed');throw new Error("allow() should only be called for users that "+"are not already allowed");}if(this.getVisibility()===ea.OFFLINE){da().error('allow_called_while_offline');throw new Error("allow() should only be called when the user is already online");}var sa=this.getOnlinePolicy()===ea.ONLINE_TO_WHITELIST?ea.WHITELISTED:ea.UNLISTED;return this.setFriendsVisibility([ra],sa);},disallow:function(ra){if(!this.allows(ra)){da().error('disallow_already_disallowed');throw new Error("disallow() should only be called for users that "+"are not already disallowed");}if(this.getVisibility()===ea.OFFLINE){da().error('disallow_called_while_offline');throw new Error("disallow() should only be called when the user is already online");}var sa=this.getOnlinePolicy()===ea.ONLINE_TO_BLACKLIST?ea.BLACKLISTED:ea.UNLISTED;return this.setFriendsVisibility([ra],sa);},getBlacklist:function(){var ra=[];for(var sa in v)if(v[sa]===ea.BLACKLISTED)ra.push(sa);return ra;},getWhitelist:function(){var ra=[];for(var sa in v)if(v[sa]===ea.WHITELISTED)ra.push(sa);return ra;},getMapForTest:function(){return v;},setMapForTest:function(ra){v=ra;}});ea.inform('privacy-changed');ea.inform('privacy-user-presence-changed');da().log('initialized',{visibility:w,policy:z});h.subscribe(j.getArbiterType('privacy_changed'),qa.bind(this));h.subscribe(j.ON_CONFIG,function(ra,sa){var ta=sa.getConfig('visibility',null);if(ta!==null&&typeof(ta)!=='undefined'){var ua=ta?ea.ONLINE:ea.OFFLINE;ha(ua);da().log('config_visibility',{vis:ua});}}.bind(this));a.PresencePrivacy=e.exports=ea;},3);
__d("ChatVisibility",["Arbiter","JSLogger","PresencePrivacy"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('JSLogger'),i=b('PresencePrivacy'),j={isOnline:function(){return i.getVisibility()===i.ONLINE;},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends();},isVisibleToMostFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_BLACKLIST&&i.getBlacklist().length>0;},isVisibleToSomeFriends:function(){return i.getOnlinePolicy()===i.ONLINE_TO_WHITELIST&&i.getWhitelist().length>0;},goOnline:function(k){if(i.getVisibility()===i.OFFLINE){h.create('blackbird').log('chat_go_online');i.setVisibility(i.ONLINE);g.inform('chat-visibility/go-online');}k&&k();},goOffline:function(k){if(i.getVisibility()===i.ONLINE){h.create('blackbird').log('chat_go_offline');i.setVisibility(i.OFFLINE);g.inform('chat-visibility/go-offline');}k&&k();},toggleVisibility:function(){if(j.isOnline()){j.goOffline();}else j.goOnline();}};a.ChatVisibility=e.exports=j;},3);
__d("LastMobileActiveTimes",["tx"],function(a,b,c,d,e,f){var g=b('tx'),h=0,i={};function j(n){if(!h||!n)return '';var o=h-n,p=Math.floor(o/60),q=Math.floor(p/60),r=Math.floor(q/24);if(p<=1){return g._("{count}m",{count:1});}else if(p<60){return g._("{count}m",{count:p});}else if(q<24){return g._("{count}h",{count:q});}else if(r<3){return g._("{count}d",{count:r});}else return '';}function k(n,o){i[n]=o;}function l(n){if(n in i){return i[n];}else return 0;}var m={update:function(n,o){h=o/1000;for(var p in n)k(p,n[p]);},getShortDisplay:function(n){return j(l(n));}};e.exports=m;});
__d("Poller",["ArbiterMixin","AsyncRequest","Cookie","Env","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Cookie'),j=b('Env'),k=b('copyProperties'),l=b('emptyFunction');function m(p){this._config=k({clearOnQuicklingEvents:true,setupRequest:l,interval:null,maxRequests:Infinity,dontStart:false},p);if(!this._config.dontStart)this.start();}m.MIN_INTERVAL=2000;k(m.prototype,g,{start:function(){if(this._polling)return this;this._requests=0;this.request();return this;},stop:function(){this._cancelRequest();return this;},mute:function(){this._muted=true;return this;},resume:function(){if(this._muted){this._muted=false;if(!this._handle&&this._polling)return this.request();}return this;},skip:function(){this._skip=true;return this;},reset:function(){return this.stop().start();},request:function(){this._cancelRequest();this._polling=true;if(!o())return this._done();if(this._muted)return this;if(++this._requests>this._config.maxRequests)return this._done();var p=new h(),q=false;p.setInitialHandler(function(){return !q;});this._cancelRequest=function(){q=true;this._cleanup();}.bind(this);p.setFinallyHandler(n.bind(this));p.setInitialHandler=l;p.setFinallyHandler=l;this._config.setupRequest(p,this);if(this._skip){this._skip=false;n.bind(this).defer();}else p.send();return this;},isPolling:function(){return this._polling;},isMuted:function(){return this._muted;},setInterval:function(p){if(p){this._config.interval=p;this.start();}},getInterval:function(){return this._config.interval;},_cleanup:function(){if(this._handle)clearTimeout(this._handle);this._handle=null;this._cancelRequest=l;this._polling=false;},_done:function(){this._cleanup();this.inform('done',{sender:this});return this;},_config:null,_requests:0,_muted:false,_polling:false,_skip:false,_cancelRequest:l});function n(){if(!this._polling)return;if(this._requests<this._config.maxRequests){var p=this._config.interval;p=typeof p==='function'?p(this._requests):p;this._handle=this.request.bind(this).defer((p>m.MIN_INTERVAL)?p:m.MIN_INTERVAL,this._config.clearOnQuicklingEvents);}else this._done();}function o(){return j.user==i.get('c_user');}e.exports=m;});
__d("ServerTime",["PresenceInitialData"],function(a,b,c,d,e,f){var g=b('PresenceInitialData'),h;function i(k){h=Date.now()-k;}i(g.serverTime);var j={get:function(){return Date.now()-h;},getSkew:function(){return h;},update:function(k){i(k);}};e.exports=j;});
__d("PresenceStatus",["AvailableListConstants","ChatConfig","ChatVisibility","Env","PresencePrivacy","ServerTime","createObjectFrom"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatVisibility'),j=b('Env'),k=b('PresencePrivacy'),l=b('ServerTime'),m=b('createObjectFrom'),n={},o={},p={},q={},r={resetPresenceData:function(){n={};q={};p={};},reset:function(){r.resetPresenceData();o={};},get:function(s){if(s==j.user)return i.isOnline()?g.ACTIVE:g.OFFLINE;var t=g.OFFLINE;if(s in n)t=n[s];if(!k.allows(s))t=g.OFFLINE;if(t==g.OFFLINE)if(o[s])t=g.MOBILE;return t;},getGroup:function(s){if(!h.get('chat_group_presence',0))return g.OFFLINE;return s.some(function(t){if(t==j.user)return false;return (r.get(t)===g.ACTIVE);})?g.ACTIVE:g.OFFLINE;},set:function(s,t,u,v){if(s==j.user)return false;switch(t){case g.OFFLINE:case g.IDLE:case g.ACTIVE:case g.MOBILE:break;default:return false;}var w=r.get(s)!=t;if(u){p[s]=l.get();q[s]=v;}n[s]=t;return w;},setMobileFriends:function(s){o=m(s);},getOnlineIDs:function(){var s,t=[];for(s in n)if(r.get(s)===g.ACTIVE)t.push(s);return t;},getAvailableIDs:function(){var s=r.getOnlineIDs(),t;for(t in o){if(n[t])continue;s.push(t);}return s;},getOnlineCount:function(){return r.getOnlineIDs().length;},getDebugInfo:function(s){return {id:s,presence:n[s],overlaySource:q[s],overlayTime:p[s],mobile:o[s]};}};e.exports=r;});
__d("AvailableList",["function-extensions","Arbiter","ArbiterMixin","AsyncRequest","AvailableListConstants","ChannelConstants","ChatConfig","ChatContexts","ChatFavoriteList","ChatVisibility","Env","JSLogger","LastMobileActiveTimes","Poller","PresencePrivacy","PresenceStatus","PresenceUtil","ServerTime","ShortProfiles","UserActivity","copyProperties","debounceAcrossTransitions","emptyFunction","ChannelImplementation","AvailableListInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AsyncRequest'),j=b('AvailableListConstants'),k=b('ChannelConstants'),l=b('ChatConfig'),m=b('ChatContexts'),n=b('ChatFavoriteList'),o=b('ChatVisibility'),p=b('Env'),q=b('JSLogger'),r=b('LastMobileActiveTimes'),s=b('Poller'),t=b('PresencePrivacy'),u=b('PresenceStatus'),v=b('PresenceUtil'),w=b('ServerTime'),x=b('ShortProfiles'),y=b('UserActivity'),z=b('copyProperties'),aa=b('debounceAcrossTransitions'),ba=b('emptyFunction'),ca=c('ChannelImplementation').instance,da=c('AvailableListInitialData'),ea=5,fa='/ajax/chat/buddy_list.php',ga=5000,ha=1800000,ia=0,ja=0,ka=false,la=da.pollInterval,ma=da.lazyPollInterval,na=da.lazyThreshold,oa=0,pa=Date.now(),qa=0,ra=false,sa=false,ta=null,ua=l.get('buddy_list_double_fetch',0),va=q.create('available_list'),wa=z({},j,h);wa.subscribe([j.ON_AVAILABILITY_CHANGED,j.ON_UPDATE_ERROR,j.ON_UPDATED],function(pb,qb){g.inform(pb,qb);});function xa(pb){var qb=pb||y.isActive(na);return o.isOnline()?(qb?la:ma):null;}function ya(){wa.inform(j.ON_AVAILABILITY_CHANGED);}var za=aa(ya,0);function ab(pb,qb,rb,sb){var tb=u.set(pb,qb,rb,sb);if(tb){ia++;za();}}function bb(pb){qa=Date.now();u.setMobileFriends(pb);ia++;za();}function cb(){if(ra)wa.inform(j.ON_UPDATED,wa);}function db(pb){if(v.checkMaintenanceError(pb))return;ja++;ka=false;if(ja>=ea)wa.inform(j.ON_UPDATE_ERROR);}function eb(pb){var qb=pb.getPayload(),rb=qb.buddy_list;if(!rb){db(pb);return;}w.update(qb.time);oa=w.get();ja=0;ka=false;if(rb.mobile_friends!=null)bb(rb.mobile_friends);var sb=rb.userInfos;if(sb)x.setMulti(sb);kb();sa=rb.userIsIdle;var tb=rb.nowAvailableList;tb&&ib(tb);var ub=rb.last_active_times;ub&&r.update(ub,qb.time);var vb=rb.chatContexts;vb&&m.update(vb);if(rb.chatNotif!==undefined){ta=rb.chatNotif;wa.inform(j.ON_CHAT_NOTIFICATION_CHANGED,ta);}jb();cb();za();}function fb(pb){if(ca.isShutdown()||!o.isOnline()){wa._poller.stop();return;}pa=Date.now();var qb=false;if(Date.now()-qa>ha)qb=true;ka=true;var rb=x.getCachedProfileIDs().join(",");pb.setHandler(eb).setErrorHandler(db).setOption('suppressErrorAlerts',true).setOption('retries',1).setData({user:p.user,cached_user_info_ids:rb,fetch_mobile:qb}).setURI(fa).setAllowCrossPageTransition(true);}function gb(pb){var qb=pb.payload.availability||{};for(var rb in qb)ab(rb,qb[rb],true,'mercury_tabs');}function hb(pb){var qb=wa.getDebugInfo(pb),rb=(qb.presence==j.ACTIVE),sb=new i('/ajax/mercury/tabs_presence.php').setData({target_id:pb,to_online:rb,presence_source:qb.overlaySource,presence_time:qb.overlayTime}).setHandler(gb).setErrorHandler(ba).setAllowCrossPageTransition(true).send();}function ib(pb){for(var qb in pb)ab(qb,pb[qb].a,false,null);ra=true;}function jb(pb){var qb=xa(pb);va.debug('update_poller',qb);var rb=wa._poller;if(rb)if(!ua||(rb.getInterval()!=qb))rb.setInterval(qb);}function kb(){ra=false;u.resetPresenceData();ia++;}function lb(){u.reset();pa=0;qa=0;sa=false;ta=null;ya();}function mb(){jb();if(ca.disconnected()){lb();}else if(!ra)wa.update();}function nb(pb,qb){qb.chat_config=l.getDebugInfo();qb.available_list_debug_info={};wa.getAvailableIDs().forEach(function(rb){qb.available_list_debug_info[rb]=wa.getDebugInfo(rb);});qb.available_list_poll_interval=wa._poller&&wa._poller.getInterval();}z(wa,{get:function(pb){return u.get(pb);},updateForID:function(pb){hb(pb);},getWebChatNotification:function(){return ta;},isUserIdle:function(){return sa;},isReady:function(){return ra;},set:function(pb,qb,rb){ab(pb,qb,true,rb);},update:function(){if(Date.now()-pa<ga){!ka&&cb.defer();return;}var pb=wa._poller;if(pb)if(!ua||!pb.isPolling())pb.request();},getRev:function(){return ia;},isIdle:function(pb){return wa.get(pb)==j.IDLE;},getOnlineIDs:function(){return u.getOnlineIDs();},getAvailableIDs:function(){return u.getAvailableIDs();},getOnlineCount:function(){return u.getOnlineCount();},getDebugInfo:function(pb){var qb=u.getDebugInfo(pb),rb=x.getNow(pb);if(rb)qb.name=rb.name;return qb;}});oa=da.updateTime;ib(da.availableList);if(da.mobileFriends)bb(da.mobileFriends);if(da.lastActiveTimes)r.update(da.lastActiveTimes,oa);if(da.favoriteList)n.init(da.favoriteList);ta=da.chatNotif;var ob=ua?true:false;wa._poller=new s({interval:xa(ob),setupRequest:fb,clearOnQuicklingEvents:false,dontStart:true});wa._poller.start.bind(wa._poller).defer();if(!ua)jb(true);g.subscribe(q.DUMP_EVENT,nb);g.subscribe(k.getArbiterType('favorite_list'),function(pb,qb){var rb=qb.obj,sb=rb.value?rb.value.split(','):[];n.init(sb);za();});y.subscribe(function(pb,qb){if(qb.idleness>la){va.debug('update_activity');wa.update();}});t.subscribe('privacy-changed',ya);t.subscribe('privacy-availability-changed',function(pb,qb){for(var rb in qb.user_availabilities)this.set(rb,qb.user_availabilities[rb]);}.bind(wa));t.subscribe('privacy-user-presence-response',wa.update);ca.subscribe([ca.CONNECTED,ca.RECONNECTING,ca.SHUTDOWN,ca.MUTE_WARNING,ca.UNMUTE_WARNING],mb);g.subscribe(k.getArbiterType('buddylist_overlay'),function(pb,qb){var rb=qb.obj.overlay;for(var sb in rb)wa.set(sb,rb[sb].a,rb[sb].s||'channel');});a.AvailableList=e.exports=wa;});
__d("ChatImpressionLogger",["AvailableList","AsyncSignal","ChatConfig","ChatVisibility","Poller"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('AsyncSignal'),i=b('ChatConfig'),j=b('ChatVisibility'),k=b('Poller'),l=null,m=null,n={init:function(o){l=o;var p=i.get('chat_impression_logging_periodical',0);if(p){var q=i.get('periodical_impression_logging_config.interval');m=new k({interval:q,setupRequest:this.logImps.bind(this),clearOnQuicklingEvents:false});}this.init=function(){};},logImps:function(o){if(!j.isOnline())return;var p={source:'periodical_imps'},q=l.getCachedSortedList(),r=[];for(var s=0;s<q.length;s++)r[s]=g.get(q[s]);p.sorted_list=q.toString();p.list_availability=r.toString();o.setURI('/ajax/chat/imps_logging.php').setData(p);},getOrderedList:function(){return l;},logImpressions:function(o){var p=[],q=[];if(i.get('chat_impression_logging_with_click')){p=l.getCachedSortedList();for(var r=0;r<p.length;r++)q[r]=g.get(p[r]);}o.sorted_list=p.toString();o.list_availability=q.toString();new h('/ajax/chat/ct.php',o).send();}};e.exports=n;});
__d("ChatTypeaheadConstants",[],function(a,b,c,d,e,f){var g={USER_TYPE:'user',THREAD_TYPE:'thread',FRIEND_TYPE:'friend',NON_FRIEND_TYPE:'non_friend',HEADER_TYPE:'header'};e.exports=g;});
__d("Chat",["Arbiter","AvailableList","ChatImpressionLogger","ChatTypeaheadConstants","MercuryParticipantTypes"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('ChatImpressionLogger'),j=b('ChatTypeaheadConstants'),k=b('MercuryParticipantTypes');function l(q,r){var s=r&&r.source;if(s&&s==='ordered_list'||s==='more_online_friends'||s==='online_friends'||s==='recent_threads_in_divebar_new'||s==='recent_threads_in_divebar'||s==='presence'||s==='typeahead'){r.viewport_width=document.body.clientWidth;r.target=q;r.target_presence=h.get(q);i.logImpressions(r);}}var m={buddyListNub:'buddylist-nub/initialized',sidebar:'sidebar/initialized'};function n(q,r){g.subscribe(m[q],function(event,s){r(s);});}function o(){return (Math.random()*2147483648|0).toString(16);}var p={openTab:function(q,r,s){if(window.External&&window.External.Chat&&window.External.Chat.openWindow)window.External.Chat.openWindow(q);l.curry(q,s).defer();d(['MercuryThreads'],function(t){if(!r||r===k.FRIEND||r===j.FRIEND_TYPE||r===j.USER_TYPE){var u=t.get().getCanonicalThreadToUser(q),v=o();g.inform('chat/open-tab',{thread_id:u.thread_id,signature_id:v});return;}if(r===j.THREAD_TYPE)d(['ChatOpenTab'],function(w){if(q){w.openThread(q);}else w.openEmptyTab();});});},openBuddyList:function(){n('buddyListNub',function(q){q.show();n('sidebar',function(r){r.enable();});});},closeBuddyList:function(){n('buddyListNub',function(q){q.hide();});},toggleSidebar:function(){n('sidebar',function(q){q.toggle();});},goOnline:function(q){d(['ChatVisibility'],function(r){r.goOnline(q);});},isOnline:function(){var q=null;d(['ChatVisibility'],function(r){q=r;});return q&&q.isOnline();}};a.Chat=e.exports=p;},3);
__d("MercuryIDs",[],function(a,b,c,d,e,f){function g(i){return typeof i==='string'&&i.indexOf(':')!==-1;}var h={isValid:function(i){if(!i)return false;return g(i);},isValidThreadID:function(i){if(!h.isValid(i))return false;var j=h.tokenize(i);switch(j.type){case 'user':case 'group':case 'thread':case 'root':case 'pending':return true;default:return false;}},tokenize:function(i){if(!this.isValid(i))throw 'bad_id_format';var j=i.indexOf(':');return {type:i.substr(0,j),value:i.substr(j+1)};},getUserIDFromParticipantID:function(i){if(!h.isValid(i))return null;var j=h.tokenize(i);if(j.type!='fbid')return null;return j.value;}};e.exports=h;});
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f){var g=b('MercuryIDs');e.exports={isParticipantID:function(h){if(!g.isValid(h))throw 'bad_participant_id';},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw 'bad_user_id';},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw 'bad_email_id';},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw 'bad_thread_id';}};});
__d("MercurySingletonMixin",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={_getInstances:function(){if(!this._instances)this._instances={};return this._instances;},get:function(){return this.getForFBID(g.user);},getForFBID:function(i){var j=this._getInstances();if(!j[i])j[i]=new this(i);return j[i];}};e.exports=h;});
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('mail.projektitan.com')!==-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;});
__d("ImageSourceType",[],function(a,b,c,d,e,f){var g={PROFILE_PICTURE:'profile_picture',IMAGE:'image'};e.exports=g;});
__d("PhotoResizeModeConst",[],function(a,b,c,d,e,f){var g={COVER:'s',CONTAIN:'p'};e.exports=g;});
__d("ImageSourceRequest",["arrayContains","extendArray","copyProperties","Env","KeyedCallbackManager","ImageSourceType","PhotoResizeModeConst","MercuryServerDispatcher"],function(a,b,c,d,e,f){var g=b('arrayContains'),h=b('extendArray'),i=b('copyProperties'),j=b('Env'),k=b('KeyedCallbackManager'),l=b('ImageSourceType'),m=b('PhotoResizeModeConst'),n=b('MercuryServerDispatcher');function o(){this._request={fbid:null,type:null,width:null,height:null,resize_mode:null};this._callback=null;}i(o.prototype,{setFBID:function(s){this._request.fbid=s;return this;},setType:function(s){if(!g([l.PROFILE_PICTURE,l.IMAGE],s))throw new TypeError('ImageSourceRequest.setType: invalid type '+s);this._request.type=s;return this;},setDimensions:function(s,t){this._request.width=s;this._request.height=t;return this;},setResizeMode:function(s){if(!g([m.COVER,m.CONTAIN],s))throw new TypeError('ImageSourceRequest.setResizeMode: invalid resize mode '+s);this._request.resize_mode=s;return this;},setCallback:function(s){this._callback=s;return this;},send:function(){if(!this._request.fbid||!this._request.width||!this._request.height||!this._request.type||!this._request.resize_mode||!this._callback)throw new Error('ImageSourceRequest: You must set all the fields');var s=q(),t=r(this._request);s.executeOrEnqueue(t,this._callback);if(s.getUnavailableResourcesFromRequest(t).length===1){n.trySend('/ajax/image_source.php',{requests:[this._request]});return true;}return false;}});var p=null;function q(){if(p)return p;var s=new k();p=s;n.registerEndpoints({'/ajax/image_source.php':{request_user_id:j.user,mode:n.BATCH_DEFERRED_MULTI,batch_function:function(t,u){h(t.requests,u.requests);return t;},handler:function(t,u){var v=u.getData().requests;for(var w=0;w<v.length;++w)s.setResource(r(v[w]),t[w]);}}});return s;}function r(s){return [s.fbid,s.type,s.width,s.height,s.resize_mode].join('|');}e.exports=o;});
__d("TimestampConverter",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('timestamp_converter');function i(k){return (typeof(k)=='string')&&k.length>6;}var j={convertActionIDToTimestamp:function(k){if(i(k)){var l=k.slice(0,-6);return parseInt(l,10);}},maxValidActionID:function(k,l){if(!i(k))return l;if(!i(l))return k;return this.isGreaterThan(k,l)?k:l;},isGreaterThan:function(k,l){if(!i(k)||!i(l))return false;return this.convertActionIDToTimestamp(k)>this.convertActionIDToTimestamp(l);}};e.exports=j;});
__d("MessagingReliabilityLogger",["function-extensions","PresenceUtil","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData","isEmpty","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('PresenceUtil'),h=b('MercuryServerDispatcher'),i=b('MessagingReliabilityLoggerInitialData'),j=b('isEmpty'),k=b('setTimeoutAcrossTransitions'),l='/ajax/mercury/client_reliability.php',m=60000;function n(t,u){var v={app:i.app,categories:JSON.stringify(t)};if(!j(u))v.extra=JSON.stringify(u);return v;}function o(t,u,v,w){if(t[u]===undefined)t[u]={};if(t[u][v]===undefined)t[u][v]=0;t[u][v]+=w;}function p(t,u,v,w){if(t[u]===undefined)t[u]={};if(t[u][v]===undefined)t[u][v]=[];for(var x=0;x<w.length;++x)t[u][v].push(w[x]);}function q(t,u){if((t&&!t.categories)||(u&&!u.categories))return;var v=t?JSON.parse(t.categories):{},w=t&&t.extra?JSON.parse(t.extra):{},x=JSON.parse(u.categories),y=u.extra?JSON.parse(u.extra):{};for(var z in x){var aa=x[z],ba=y[z];for(var ca in aa){o(v,z,ca,aa[ca]);if(ba!==undefined){var da=ba[ca];if(da!==undefined)p(w,z,ca,da);}}}return n(v,w);}var r={};r[l]={mode:h.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:q};h.registerEndpoints(r);var s={addEntry:function(t,u,v){if(!i.enabled)return;var w={};o(w,t,u,1);var x={};if(v!==undefined)p(x,t,u,[v]);h.trySend(l,n(w,x));}};(function t(){s.addEntry('page_event','active',g.getSessionID());k(t,m);})();e.exports=s;});
__d("MercuryThreadInformer",["ArbiterMixin","copyProperties","MercuryAssert","MercurySingletonMixin"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('copyProperties'),i=b('MercuryAssert'),j=b('MercurySingletonMixin');function k(m){if(!m._locked){var n=m._threadDeletions,o=m._threadChanges,p=m._threadReadChanges,q=m._threadlistChanged,r=m._unseenStateChanged,s=m._unreadStateChanged,t=m._receivedMessages,u=m._reorderedMessages,v=m._updatedMessages;m._threadDeletions={};m._threadChanges={};m._threadReadChanges={};m._threadlistChanged=false;m._unseenStateChanged=false;m._unreadStateChanged=false;m._receivedMessages={};m._reorderedMessages={};m._updatedMessages={};var w=Object.keys(o);if(w.length||q)m.inform('threadlist-updated',w);if(w.length)m.inform('threads-updated',o);for(var x in p){m.inform('thread-read-changed',p);break;}for(var x in n){m.inform('threads-deleted',n);break;}if(r)m.inform('unseen-updated',null);if(s)m.inform('unread-updated',null);for(x in t){m.inform('messages-received',t);break;}for(x in u){m.inform('messages-reordered',u);break;}for(x in v){m.inform('messages-updated',v);break;}}}function l(m){this._fbid=m;this._threadDeletions={};this._threadChanges={};this._threadReadChanges={};this._threadlistChanged=false;this._unseenStateChanged=false;this._unreadStateChanged=false;this._receivedMessages={};this._reorderedMessages={};this._updatedMessages={};this._locked=0;}h(l.prototype,g,{updatedThread:function(m){this._threadChanges[m]=true;k(this);},deletedThread:function(m){this._threadDeletions[m]=true;k(this);},updatedThreadlist:function(){this._threadlistChanged=true;k(this);},updatedUnseenState:function(){this._unseenStateChanged=true;k(this);},updatedUnreadState:function(){this._unreadStateChanged=true;k(this);},changedThreadReadState:function(m,n,o){if(!this._threadReadChanges[m]||this._threadReadChanges[m].timestamp<o)this._threadReadChanges[m]={mark_as_read:n,timestamp:o};k(this);},receivedMessage:function(m){i.isThreadID(m.thread_id);var n=m.thread_id;if(!this._receivedMessages[n])this._receivedMessages[n]=[];this._receivedMessages[n].push(m);this.updatedThread(n);},reorderedMessages:function(m,n){this._reorderedMessages[m]={source:n};k(this);},updatedMessage:function(m,n,o){if(!this._updatedMessages[m])this._updatedMessages[m]={};this._updatedMessages[m][n]={source:o};this.updatedThread(m);},synchronizeInforms:function(m){this._locked++;try{m();}catch(n){throw n;}finally{this._locked--;k(this);}},listen:function(m,n){return this.subscribe('threads-updated',function(o,p){if(p[m])n(m);});}});h(l,j);e.exports=l;});
__d("MercuryServerRequests",["ArbiterMixin","AsyncResponse","TimestampConverter","Env","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercuryActionStatus","MercuryAPIArgsSource","MercuryAssert","MercuryErrorType","MercuryGenericConstants","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercuryPayloadSource","MercuryServerRequestsConfig","MercurySourceType","MercuryThreadlistConstants","MercuryMessageIDs","MessagingConfig","MessagingReliabilityLogger","MessagingTag","MercurySingletonMixin","MercuryServerDispatcher","MercuryThreadInformer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncResponse'),i=b('TimestampConverter'),j=b('Env'),k=b('JSLogger'),l=b('KeyedCallbackManager'),m=b('MercuryActionTypeConstants'),n=b('MercuryActionStatus'),o=b('MercuryAPIArgsSource'),p=b('MercuryAssert'),q=b('MercuryErrorType'),r=b('MercuryGenericConstants'),s=b('MercuryGlobalActionType'),t=b('MercuryIDs'),u=b('MercuryLogMessageType'),v=b('MercuryPayloadSource'),w=b('MercuryServerRequestsConfig'),x=b('MercurySourceType'),y=b('MercuryThreadlistConstants'),z=b('MercuryMessageIDs'),aa=b('MessagingConfig'),ba=b('MessagingReliabilityLogger'),ca=b('MessagingTag'),da=b('MercurySingletonMixin'),ea=b('MercuryServerDispatcher'),fa=b('MercuryThreadInformer'),ga=b('copyProperties'),ha=b('createObjectFrom'),ia=k.create('mercury_server'),ja=o.MERCURY;function ka(sb,tb){if(tb)sb._lastActionId=i.maxValidActionID(sb._lastActionId,tb);}function la(sb,tb){var ub=tb.thread_id,vb=sb._serverToClientIDs.getResource(ub);if(!vb){if(tb.canonical_fbid){vb='user:'+tb.canonical_fbid;}else if(tb.root_message_threading_id)vb='root:'+tb.root_message_threading_id;vb=vb||'thread:'+ub;ma(sb,ub,vb);}tb.thread_id=vb;}function ma(sb,tb,ub){sb._serverToClientIDs.setResource(tb,ub);sb._clientToServerIDs.setResource(ub,tb);sb._newlyAddedClientIDs[tb]=ub;}function na(sb,tb,ub){var vb=sb._clientToServerIDs.executeOrEnqueue(tb,ub),wb=sb._clientToServerIDs.getUnavailableResources(vb),xb=sb.tokenizeThreadID(tb);if(wb.length&&xb.type!='root')sb.fetchThreadData(wb);}function oa(sb,tb){return sb._clientToServerIDs.getResource(tb);}function pa(sb,tb){return !!sb._serverToClientIDs.getResource(tb);}function qa(sb,tb){var ub=sb._serverToClientIDs.getResource(tb);if(typeof ub=='undefined')ia.warn('no_client_thread_id',{server_id:tb});return ub;}function ra(sb,tb,ub){sb._serverToClientIDs.executeOrEnqueue(tb,ub);sb.ensureThreadIsFetched(tb);}function sa(sb,tb,ub){if(tb.action_type!=m.SEND_MESSAGE)return;var vb=tb.client_thread_id;if(!vb)vb=qa(sb,tb.thread_id);var wb=null;if(vb)wb=t.tokenize(vb).type;ba.addEntry('send_'+wb,ub,tb.thread_id+','+tb.message_id);}function ta(sb){return sb.getError()?'_'+sb.getError():'';}function ua(sb,tb){var ub=null;switch(tb.status){case n.SUCCESS:ub='success';break;case n.FAILED_UNKNOWN_REASON:ub='confirmed_error';break;case n.UNABLE_TO_CONFIRM:ub='confirm_error';break;default:return;}sa(sb,tb,ub);}function va(sb,tb){(tb.message_counts||[]).forEach(function(cc){ka(sb,cc.last_action_id);});(tb.threads||[]).forEach(function(cc){la(sb,cc);delete sb._fetchingThreads[cc.thread_id];var dc=oa(sb,cc.thread_id);delete sb._fetchingThreads[dc];ka(sb,cc.last_action_id);});(tb.ordered_threadlists||[]).forEach(function(cc){cc.thread_ids=cc.thread_ids.map(qa.curry(sb));});tb.actions=tb.actions||[];tb.actions.forEach(function(cc){ua(sb,cc);if(cc.status&&cc.status!=n.SUCCESS&&!cc.thread_id){cc.thread_id=cc.client_thread_id;return;}if(cc.action_type==m.SEND_MESSAGE&&cc.client_thread_id&&cc.client_thread_id!=r.PENDING_THREAD_ID)ma(sb,cc.thread_id,cc.client_thread_id);cc.server_thread_id=cc.thread_id;cc.thread_id=pa(sb,cc.thread_id)?qa(sb,cc.thread_id):null;ka(sb,cc.action_id);});if(tb.end_of_history){var ub=[];for(var vb=0;vb<tb.end_of_history.length;vb++){var wb=tb.end_of_history[vb];if(wb.type=='user'){ub.push('user:'+wb.id);}else if(wb.type=='thread'&&pa(sb,wb.id))ub.push(qa(sb,wb.id));}tb.end_of_history=ub;}if(tb.roger){var xb={};for(var yb in tb.roger){var zb=sb._serverToClientIDs.getResource(yb);if(zb){var ac=tb.roger[yb];xb[zb]={};for(var bc in ac)xb[zb]['fbid:'+bc]=ac[bc];}}tb.roger=xb;}}function wa(sb){if(sb._pendingUpdates&&sb._pendingUpdates.length){var tb=sb._pendingUpdates[0];sb._pendingUpdates=sb._pendingUpdates.slice(1);sb.handleUpdate(tb);}}function xa(sb,tb){var ub=ga({},sb),vb;if(tb.threads){if(!ub.threads)ub.threads={};for(vb in tb.threads)ub.threads[vb]=Object.keys(ha((ub.threads[vb]||[]).concat(tb.threads[vb])));}if(tb.messages){if(!ub.messages)ub.messages={};for(vb in tb.messages){if(!ub.messages[vb])ub.messages[vb]={};for(var wb in tb.messages[vb])if(ub.messages[vb][wb]){ub.messages[vb][wb]=ab(ub.messages[vb][wb],tb.messages[vb][wb]);}else ub.messages[vb][wb]=tb.messages[vb][wb];}}ub.client=sb.client||tb.client;return ub;}function ya(sb,tb){var ub=ga(ha(sb.folders,true),ha(tb.folders,true)),vb=sb.client||tb.client;return {folders:Object.keys(ub),client:vb};}function za(sb,tb){for(var ub in tb)if(sb[ub]&&typeof sb[ub]==='object'){sb[ub]=ab(sb[ub],tb[ub]);}else if(tb[ub]&&typeof tb[ub]==='object'){var vb={};ga(vb,tb[ub]);sb[ub]=vb;}return sb;}function ab(sb,tb){var ub=sb.offset<tb.offset?sb.offset:tb.offset,vb=sb.offset+sb.limit,wb=tb.offset+tb.limit,xb=(vb>wb)?vb:wb,yb=xb-ub;return {offset:ub,limit:yb};}function bb(sb,tb){var ub=sb.client||tb.client,vb={ids:{},client:ub};ga(vb.ids,sb.ids);ga(vb.ids,tb.ids);return vb;}function cb(sb,tb){var ub={},vb,wb=sb.client||tb.client;delete sb.client;delete tb.client;for(vb in sb)ga(ub,ha(sb[vb],vb));for(vb in tb)ga(ub,ha(tb[vb],vb));var xb={client:wb};for(var yb in ub){vb=ub[yb];if(!xb[vb])xb[vb]=[];xb[vb].push(yb);}return xb;}function db(sb,tb){var ub=sb.client||tb.client,vb=ha(sb.ids,true),wb=ha(tb.ids,true),xb=ga(vb,wb);return {ids:Object.keys(xb),client:ub};}function eb(sb){this._fbid=sb;this._lastActionId=0;this._serverToClientIDs=new l();this._clientToServerIDs=new l();this._pendingUpdates=[];this._fetchingThreads={};this._newlyAddedClientIDs={};qb(this);}ga(eb.prototype,g,{tokenizeThreadID:function(sb){p.isThreadID(sb);return t.tokenize(sb);},getServerThreadID:function(sb,tb){p.isThreadID(sb);na(this,sb,tb);},getClientThreadID:function(sb,tb){ra(this,sb,tb);},getClientThreadIDNow:function(sb){return qa(this,sb);},getServerThreadIDNow:function(sb){return oa(this,sb);},convertThreadIDIfAvailable:function(sb){var tb=this._serverToClientIDs.getResource(sb);if(tb===undefined){return sb;}else return tb;},canLinkExternally:function(sb){p.isThreadID(sb);var tb=this.tokenizeThreadID(sb);return (tb.type=='user')||!!oa(this,sb);},fetchThreadlistInfo:function(sb,tb,ub,vb,wb){ub=ub||ca.INBOX;wb=wb||ja;var xb=vb?ea.IMMEDIATE:null,yb={client:wb};yb[ub]={offset:sb,limit:tb,filter:vb};rb(this,'/ajax/mercury/threadlist_info.php',yb,xb);},fetchUnseenThreadIDs:function(sb,tb){tb=tb||ja;this.fetchThreadlistInfo(y.RECENT_THREAD_OFFSET,y.JEWEL_THREAD_COUNT,sb,null,tb);},fetchUnreadThreadIDs:function(sb,tb){tb=tb||ja;rb(this,'/ajax/mercury/unread_threads.php',{folders:[sb],client:tb});},fetchMissedMessages:function(sb,tb){tb=tb||ja;rb(this,'/ajax/mercury/thread_sync.php',{last_action_id:this._lastActionId,folders:sb,client:tb});},fetchThreadData:function(sb,tb){tb=tb||ja;p.allThreadID(sb);var ub={threads:{},client:tb},vb=[],wb=[];sb.forEach(function(yb){if(this._fetchingThreads[yb])return;this._fetchingThreads[yb]=true;var zb=oa(this,yb);if(zb){wb.push(zb);ub.threads.thread_ids=wb;}else{var ac=this.tokenizeThreadID(yb);if(ac.type=='user'){vb.push(ac.value);ub.threads.user_ids=vb;}else if(ac.type=='thread'){wb.push(ac.value);ub.threads.thread_ids=wb;}else if(ac.type!='root'&&ac.type!='pending')throw new Error('Unknown thread type',ac);}}.bind(this));this.inform("fetch-thread-data",ub);for(var xb in ub.threads){rb(this,'/ajax/mercury/thread_info.php',ub);break;}},ensureThreadIsFetched:function(sb,tb){tb=tb||ja;if(!this._serverToClientIDs.getResource(sb)&&!this._fetchingThreads[sb]){this._fetchingThreads[sb]=true;rb(this,'/ajax/mercury/thread_info.php',{threads:{thread_ids:[sb]},client:tb});}},fetchThreadMessages:function(sb,tb,ub,vb,wb){p.isThreadID(sb);wb=wb||ja;var xb,yb,zb=this.tokenizeThreadID(sb),ac=oa(this,sb),bc=false;if(ac&&zb.type!='group'){yb='thread_ids';xb=ac;}else{xb=zb.value;switch(zb.type){case 'user':yb='user_ids';bc=true;break;case 'group':yb='group_ids';break;case 'thread':yb='thread_ids';break;}}var cc={messages:{},threads:{},client:wb};if(yb){cc.messages[yb]={};cc.messages[yb][xb]={offset:tb,limit:ub};if(bc)cc.threads[yb]=[xb];rb(this,'/ajax/mercury/thread_info.php',cc,vb);}else na(this,sb,function(dc){cc.messages.thread_ids={};cc.messages.thread_ids[dc]={offset:tb,limit:ub};rb(this,'/ajax/mercury/thread_info.php',cc,vb);}.bind(this));},handleThreadInfoError:function(sb){var tb=sb.getRequest().getData(),ub=[];if(tb.messages){for(var vb in tb.messages.thread_ids)ub.push(fb(qa(this,vb)));for(var wb in tb.messages.user_ids)ub.push(fb('user:'+wb));for(var xb in tb.messages.group_ids)ub.push(fb('group:'+xb));}if(ub.length)this.handleUpdate({actions:ub,from_client:true,payload_source:v.CLIENT_CHANNEL_MESSAGE});if(tb.threads&&(tb.threads.user_ids||tb.threads.group_ids||tb.threads.thread_ids)&&!tb.is_retry){if(tb.messages)delete tb.messages;ia.log('retry_thread',tb);tb.is_retry=true;rb(this,'/ajax/mercury/thread_info.php',tb);}},markFolderAsRead:function(sb){rb(this,'/ajax/mercury/mark_folder_as_read.php',{folder:sb});var tb=[{action_type:s.MARK_ALL_READ,action_id:null,folder:sb}];this.handleUpdate({global_actions:tb,from_client:true,payload_source:v.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(sb,tb,ub){p.isThreadID(sb);na(this,sb,function(wb){var xb={ids:{}};xb.ids[wb]=tb;rb(this,'/ajax/mercury/change_read_status.php',xb);}.bind(this));var vb=[{action_type:m.CHANGE_READ_STATUS,action_id:null,thread_id:sb,mark_as_read:tb,folder:ub}];this.handleUpdate({actions:vb,from_client:true,payload_source:v.CLIENT_CHANGE_READ_STATUS});},changeThreadArchivedStatus:function(sb,tb){p.isThreadID(sb);na(this,sb,function(wb){var xb={ids:{}};xb.ids[wb]=tb;rb(this,'/ajax/mercury/change_archived_status.php',xb);}.bind(this));var ub={action_type:m.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:sb,archived:tb},vb={actions:[ub],from_client:true,payload_source:v.CLIENT_CHANGE_ARCHIVED_STATUS};this.handleUpdate(vb);},changeThreadFolder:function(sb,tb){p.isThreadID(sb);na(this,sb,function(wb){var xb={};xb[tb]=[wb];rb(this,'/ajax/mercury/move_thread.php',xb);}.bind(this));var ub={action_type:m.CHANGE_FOLDER,action_id:null,thread_id:sb,new_folder:tb},vb={actions:[ub],from_client:true,payload_source:v.CLIENT_CHANGE_FOLDER};this.handleUpdate(vb);},changeMutingOnThread:function(sb,tb){p.isThreadID(sb);na(this,sb,function(wb){rb(this,'/ajax/mercury/change_mute_thread.php',{thread_id:wb,mute_settings:tb,payload_source:ja});}.bind(this));var ub={action_type:m.CHANGE_MUTE_SETTINGS,action_id:null,thread_id:sb,mute_settings:tb},vb={actions:[ub],from_client:true,payload_source:v.CLIENT_CHANGE_MUTE_SETTINGS};this.handleUpdate(vb);},markThreadSpam:function(sb){p.isThreadID(sb);na(this,sb,function(vb){rb(this,'/ajax/mercury/mark_spam.php',{id:vb});}.bind(this));var tb={action_type:m.CHANGE_FOLDER,action_id:null,thread_id:sb,new_folder:ca.SPAM},ub={actions:[tb],from_client:true,payload_source:v.CLIENT_CHANGE_FOLDER};this.handleUpdate(ub);},markMessagesSpam:function(sb,tb){z.getServerIDs(tb||[],function(vb){rb(this,'/ajax/mercury/mark_spam_messages.php',{message_ids:vb});}.bind(this));var ub={action_type:m.DELETE_MESSAGES,action_id:null,thread_id:sb,message_ids:tb};this.handleUpdate({actions:[ub],from_client:true,payload_source:v.CLIENT_DELETE_MESSAGES});},unmarkThreadSpam:function(sb){p.isThreadID(sb);na(this,sb,function(vb){rb(this,'/ajax/mercury/unmark_spam.php',{id:vb});}.bind(this));var tb={action_type:m.CHANGE_FOLDER,action_id:null,thread_id:sb,new_folder:ca.INBOX},ub={actions:[tb],from_client:true,payload_source:v.CLIENT_CHANGE_FOLDER};this.handleUpdate(ub);},deleteThread:function(sb){p.isThreadID(sb);na(this,sb,function(vb){var wb={ids:[vb]};rb(this,'/ajax/mercury/delete_thread.php',wb);}.bind(this));var tb={action_type:m.DELETE_THREAD,action_id:null,thread_id:sb},ub={actions:[tb],from_client:true,payload_source:v.CLIENT_DELETE_THREAD};this.handleUpdate(ub);},deleteMessages:function(sb,tb,ub){z.getServerIDs(tb||[],function(wb){rb(this,'/ajax/mercury/delete_messages.php',{message_ids:wb});}.bind(this));var vb;if(ub){vb={action_type:m.DELETE_THREAD,action_id:null,thread_id:sb};}else vb={action_type:m.DELETE_MESSAGES,action_id:null,thread_id:sb,message_ids:tb};this.handleUpdate({actions:[vb],from_client:true,payload_source:v.CLIENT_DELETE_MESSAGES});},clearChat:function(sb,tb,ub){p.isThreadID(sb);rb(this,'/ajax/chat/settings.php',{clear_history_id:tb});var vb=[{action_type:m.CLEAR_CHAT,action_id:null,thread_id:sb,clear_time:ub}];this.handleUpdate({actions:vb,from_client:true,payload_source:v.CLIENT_CLEAR_CHAT});},sendNewMessage:function(sb,tb){tb=tb||ja;if(!sb.do_not_send_to_server)z.getServerIDs(sb.forward_message_ids||[],function(vb){var wb=sb.thread_id,xb=this.tokenizeThreadID(sb.thread_id),yb=xb.type,zb=ga({},sb);zb.forward_message_ids=vb;if((yb=='root'&&xb.value==zb.message_id)||(yb=='user'&&!oa(this,wb))||(sb.thread_id==r.PENDING_THREAD_ID)){zb.client_thread_id=zb.thread_id;zb.thread_id=null;this._sendNewMessageToServer(zb,tb);}else na(this,zb.thread_id,function(ac){zb.thread_id=ac;this._sendNewMessageToServer(zb);}.bind(this));}.bind(this));if(sb.thread_id!=r.PENDING_THREAD_ID){var ub={actions:[ga({},sb)],from_client:true,payload_source:v.CLIENT_SEND_MESSAGE};this.handleUpdate(ub);}},_sendNewMessageToServer:function(sb,tb){tb=tb||ja;rb(this,'/ajax/mercury/send_messages.php',{message_batch:[sb],client:tb});},requestMessageConfirmation:function(sb,tb){tb=tb||ja;var ub={},vb={};for(var wb in sb){var xb=oa(this,wb);if(xb){ub[xb]=sb[wb];}else{var yb=sb[wb];for(var zb=0;zb<yb.length;zb++)vb[yb[zb]]=wb;}}var ac=Object.keys(ub),bc=Object.keys(vb);if(ac.length||bc.length)rb(this,'/ajax/mercury/confirm_messages.php',{thread_message_map:ub,local_messages:vb,client:tb});},handleMessageConfirmError:function(sb){var tb=sb.getRequest().getData().thread_message_map,ub=sb.getRequest().getData().local_messages;if(!tb&&!ub)return;var vb=[];for(var wb in tb){var xb=tb[wb];xb.forEach(function(ac){vb.push({action_type:m.SEND_MESSAGE,client_message_id:ac,message_id:ac,client_thread_id:null,thread_id:wb,status:n.UNABLE_TO_CONFIRM});});}for(var yb in ub){var zb=ub[yb];vb.push({action_type:m.SEND_MESSAGE,client_message_id:yb,message_id:yb,client_thread_id:zb,thread_id:null,status:n.UNABLE_TO_CONFIRM});}if(vb.length)this.handleUpdate({actions:vb,payload_source:v.CLIENT_HANDLE_ERROR});},markSeen:function(){var sb=i.convertActionIDToTimestamp(this._lastActionId);rb(this,'/ajax/mercury/mark_seen.php',{seen_timestamp:sb});},handleRoger:function(sb){var tb=sb.tid?this._serverToClientIDs.getResource(sb.tid):('user:'+sb.reader);if(tb){var ub={};ub[tb]={};ub[tb]['fbid:'+sb.reader]=sb.time;this.inform('update-roger',ub);}},handleUpdateWaitForThread:function(sb,tb,ub){ub=ub||ja;var vb=this._serverToClientIDs.getResource(tb);if(vb){this.handleUpdate(sb);return;}this._serverToClientIDs.executeOrEnqueue(tb,function(){this._pendingUpdates.push(sb);}.bind(this));if(!this._fetchingThreads[tb]){this._fetchingThreads[tb]=true;rb(this,'/ajax/mercury/thread_info.php',{threads:{thread_ids:[tb]},client:ub});}},handleUpdate:function(sb){ia.debug('handle_update',{payload:sb,from_client:sb.from_client});for(var tb in sb){fa.getForFBID(this._fbid).synchronizeInforms(function(){if(!sb.from_client){va(this,sb);this.inform('payload-preprocessed',sb);}this.inform('update-thread-ids',this._newlyAddedClientIDs);this._newlyAddedClientIDs={};this.inform('update-participants',sb);this.inform('update-threads',sb);this.inform('update-unread',sb);this.inform('update-threadlist',sb);this.inform('update-messages',sb);this.inform('update-unseen',sb);this.inform('update-typing-state',sb);this.inform('update-roger',sb.roger);this.inform('model-update-completed',null);wa(this);}.bind(this));break;}},_handleSendMessageErrorCommon:function(sb,tb,ub,vb){ia.debug('handle_send_message_error_common',{reliability_error_status:ub,request_error_status:tb});var wb=sb.getData(),xb=wb.message_batch,yb=xb.map(function(ac){return {action_type:m.SEND_MESSAGE,client_message_id:ac.message_id,message_id:ac.message_id,client_thread_id:ac.client_thread_id,thread_id:ac.thread_id,status:tb,error_data:vb};});yb.forEach(function(ac){sa(this,ac,ub);}.bind(this));var zb={actions:yb,payload_source:v.CLIENT_HANDLE_ERROR};this.handleUpdate(zb);},handleSendMessageError:function(sb){var tb=sb.getPayload(),ub=null,vb=null;if(tb&&tb.error_payload){ub=n.UNCONFIRMED;vb='send_error';}else{ub=n.ERROR;vb='request_error'+ta(sb);}var wb=sb.error;if(wb===1404102)h.verboseErrorHandler(sb);var xb=/<.*>/.test(sb.getErrorDescription())?sb.getErrorSummary():sb.getErrorDescription();this._handleSendMessageErrorCommon(sb.getRequest(),ub,vb,{type:q.SERVER,code:sb.getError(),description:xb,is_transient:sb.isTransient()});},handleSendMessageTransportError:function(sb){this._handleSendMessageErrorCommon(sb.getRequest(),n.ERROR,'transport_error'+ta(sb),{type:q.TRANSPORT,code:sb.getError(),is_transient:true});},handleSendMessageTimeout:function(sb){this._handleSendMessageErrorCommon(sb,n.ERROR,'transport_timeout',{type:q.TIMEOUT,is_transient:true});},getLastActionID:function(){return this._lastActionId;}});ga(eb,da);function fb(sb){return {action_type:m.LOG_MESSAGE,thread_id:sb,message_id:sb,timestamp:Date.now(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:x.UNKNOWN,log_message_type:u.SERVER_ERROR,log_message_data:{}};}function gb(sb){var tb=sb.getData(),ub=tb.request_user_id?tb.request_user_id:j.user;return eb.getForFBID(ub);}function hb(sb,tb){gb(tb).handleUpdate(sb);}function ib(sb,tb){var ub=sb.client||tb.client;return {client:ub,message_batch:sb.message_batch.concat(tb.message_batch)};}function jb(sb,tb){var ub={};ga(ub,sb.ids);ga(ub,tb.ids);var vb=sb.client||tb.client;return {ids:ub,client:vb};}function kb(sb,tb){return tb;}function lb(sb){var tb=gb(sb.getRequest());tb.handleThreadInfoError(sb);}function mb(sb){var tb=gb(sb.getRequest());tb.handleSendMessageError(sb);}function nb(sb){var tb=gb(sb.getRequest());tb.handleSendMessageTransportError(sb);}function ob(sb){var tb=gb(sb);tb.handleSendMessageTimeout(sb);}function pb(sb){var tb=gb(sb.getRequest());tb.handleMessageConfirmError(sb);}function qb(sb){ea.registerEndpoints({'/ajax/mercury/thread_sync.php':{request_user_id:sb._fbid,mode:ea.IDEMPOTENT,handler:hb},'/ajax/mercury/thread_info.php':{request_user_id:sb._fbid,mode:ea.BATCH_DEFERRED_MULTI,batch_function:xa,handler:hb,error_handler:lb},'/ajax/mercury/mark_folder_as_read.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb},'/ajax/mercury/change_read_status.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE,batch_function:jb,handler:hb},'/ajax/mercury/send_messages.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE,batch_function:ib,batch_size_limit:aa.SEND_BATCH_LIMIT,handler:hb,error_handler:mb,transport_error_handler:nb,timeout:w.sendMessageTimeout,timeout_handler:ob,connection_retries:aa.SEND_CONNECTION_RETRIES},'/ajax/mercury/mark_seen.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE,batch_function:kb,handler:hb},'/ajax/mercury/confirm_messages.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb,error_handler:pb},'/ajax/mercury/threadlist_info.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE_UNIQUE,batch_function:za,handler:hb},'/ajax/mercury/mark_spam.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb},'/ajax/mercury/mark_spam_messages.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb},'/ajax/mercury/unmark_spam.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb},'/ajax/mercury/unread_threads.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE_UNIQUE,batch_function:ya,handler:hb},'/ajax/chat/settings.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE,batch_function:bb,handler:hb},'/ajax/mercury/delete_thread.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE,batch_function:db,handler:hb},'/ajax/mercury/delete_messages.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb},'/ajax/mercury/move_thread.php':{request_user_id:sb._fbid,mode:ea.BATCH_SUCCESSIVE,batch_function:cb,handler:hb},'/ajax/mercury/change_mute_thread.php':{request_user_id:sb._fbid,mode:ea.IMMEDIATE,handler:hb}});}function rb(sb,tb,ub,vb){ea.trySend(tb,ub,vb,sb._fbid);}e.exports=eb;});
__d("MercuryParticipants",["Env","ImageSourceRequest","ImageSourceType","MercuryAssert","MercuryIDs","MercuryParticipantTypes","MercuryParticipantsConstants","PhotoResizeModeConst","MercuryServerRequests","ShortProfiles","copyProperties","getObjectValues","tx"],function(a,b,c,d,e,f){var g=b('Env'),h=b('ImageSourceRequest'),i=b('ImageSourceType'),j=b('MercuryAssert'),k=b('MercuryIDs'),l=b('MercuryParticipantTypes'),m=b('MercuryParticipantsConstants'),n=b('PhotoResizeModeConst'),o=b('MercuryServerRequests').get(),p=b('ShortProfiles'),q=b('copyProperties'),r=b('getObjectValues'),s=b('tx'),t='fbid:'+g.user,u={},v={},w=function(ba){ba=z(ba);if(u[ba.id]){q(u[ba.id],ba);}else u[ba.id]=q({},ba);if(ba.vanity)v[ba.vanity]=ba.id;};function x(ba){j.isEmailParticipantID(ba);var ca=k.tokenize(ba),da=ca.value;return {gender:m.UNKNOWN_GENDER,href:null,id:ba,image_src:m.EMAIL_IMAGE,big_image_src:m.EMAIL_IMAGE,name:da,short_name:da,employee:false,call_promo:false};}function y(ba,ca,da){j.allParticipantIDs(ba);var ea={},fa={};ba.forEach(function(ha){if(u[ha]&&!da){ea[ha]=q({},u[ha]);}else{var ia=k.tokenize(ha);if(ia.type=='fbid'){var ja=ia.value;fa[ha]=ja;}else if(ia.type=='email')ea[ha]=x(ha);}});var ga=r(fa);if(ga.length){p.getMulti(ga,function(ha){for(var ia in fa){var ja=fa[ia],ka=ha[ja];ea[ia]={gender:ka.gender,href:ka.uri,id:ia,image_src:ka.thumbSrc,name:ka.name,short_name:ka.firstName,employee:ka.employee,call_promo:ka.showVideoPromo,type:ka.type,vanity:ka.vanity,is_friend:ka.is_friend,social_snippets:ka.social_snippets};w(ea[ia]);}ca(ea);});}else ca(ea);}function z(ba){var ca=ba.type===l.USER||ba.type===l.FRIEND;if(!ca)return ba;if(!ba.name&&!ba.href&&!ba.vanity){var da="Facebook User";ba.name=da;ba.short_name=da;}return ba;}var aa={user:t,isAuthor:function(ba){return ba===t;},getIDFromVanityOrFBID:function(ba){if(!ba)return;if(v[ba])return v[ba];if(ba.match('^\\d+$'))return aa.getIDForUser(ba);},getNow:function(ba){return u[ba];},get:function(ba,ca){j.isParticipantID(ba);aa.getMulti([ba],function(da){ca(da[ba]);});},getMulti:function(ba,ca,da){return y(ba,ca,false);},getBigImageMulti:function(ba,ca){j.allParticipantIDs(ba);var da=m.BIG_IMAGE_SIZE;aa.getMulti(ba,function(ea){var fa={},ga=0,ha=function(la,ma){ga++;fa[la]=ma;if(ga===ba.length)ca(fa);},ia=function(la,ma){u[la].big_image_src=ma.uri;ha(la,ma.uri);};for(var ja in ea){var ka=ea[ja];if(!ka.big_image_src){new h().setFBID(aa.getUserID(ja)).setType(i.PROFILE_PICTURE).setDimensions(da,da).setResizeMode(n.COVER).setCallback(ia.curry(ja)).send();}else ha(ka.id,ka.big_image_src);}});},getOrderedBigImageMulti:function(ba,ca){aa.getBigImageMulti(ba,function(da){var ea=ba.map(function(fa){return da[fa];});ca(ea);});},getMultiForceDownload:function(ba,ca){return y(ba,ca,true);},getUserID:function(ba){return k.getUserIDFromParticipantID(ba);},getIDForUser:function(ba){return 'fbid:'+ba;},addParticipants:function(ba){ba.forEach(w);}};o.subscribe('update-participants',function(ba,ca){aa.addParticipants(ca.participants||[]);});e.exports=aa;});
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=b('createObjectFrom'),j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._error=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);this._error=null;}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._error=null;this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;var m=this._resources.indexOf(l);if(m!=-1)this._resources.splice(m,1);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._error=null;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},setError:function(k){if(this._error!==k){this._error=k;this._controller.runPossibleCallbacks();}},getError:function(k,l,m){var n=this._filterForStrictResults({strict:m});return k+l>n.length?this._error:null;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(){return this._resources.length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict&&this._skipOnStrictHandler)l=l.filter(this._skipOnStrictHandler);return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&!this._error&&k.start+k.limit>m.length){return false;}else{var n=m.slice(k.start,k.start+k.limit),o=k.start+k.limit>m.length?this._error:null;return [n,o];}},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;});
__d("MercuryFolders",["MessagingTag","arrayContains"],function(a,b,c,d,e,f){var g=b('MessagingTag'),h=b('arrayContains'),i=[g.INBOX,g.OTHER,g.ACTION_ARCHIVED,g.SPAM],j={getSupportedFolders:function(){return i.concat();},isSupportedFolder:function(k){return h(i,k);},getFromMeta:function(k){var l=k.folder;if(k.is_archived)l=g.ACTION_ARCHIVED;return l;}};e.exports=j;});
__d("MercuryAttachment",["MercuryAttachmentContentType","MercuryAttachmentType","startsWith"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentContentType'),h=b('MercuryAttachmentType'),i=b('startsWith'),j={getAttachIconClass:function(k){switch(k){case g.PHOTO:return 'MercuryPhotoIcon';case g.VIDEO:return 'MercuryVideoIcon';case g.MUSIC:return 'MercuryMusicIcon';case g.VOICE:return 'MercuryVoiceIcon';case g.TEXT:return 'MercuryTextIcon';case g.MSWORD:return 'MercuryMSWordIcon';case g.MSXLS:return 'MercuryMSXLSIcon';case g.MSPPT:return 'MercuryMSPPTIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(k){if(i(k,'image')){return 'MercuryPhotoIcon';}else if(i(k,'video')){return 'MercuryVideoIcon';}else if(i(k,'audio')){return 'MercuryMusicIcon';}else if(i(k,'text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(k){if(i(k,'image')){return g.PHOTO;}else if(i(k,'video')){return g.VIDEO;}else if(i(k,'audio')){return g.MUSIC;}else if(i(k,'text/plain')){return g.TEXT;}else return g.UNKNOWN;},convertRaw:function(k){var l=[];for(var m=0;m<k.length;m++){var n=k[m];if(n.attach_type===h.PHOTO){l.push(n);}else if(n.filename){var o=j.getAttachTypeByMime(n.filetype),p={};p.attach_type=h.FILE;p.name=n.filename;p.icon_type=o;p.url='';if(o==g.PHOTO)p.preview_loading=true;l.push(p);}}return l;}};e.exports=j;});
__d("MercuryThreads",["Arbiter","MercuryConfig","TimestampConverter","MercuryFolders","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercuryAssert","MercuryAttachment","MercuryGlobalActionType","MercuryIDs","MercuryLogMessageType","MercurySingletonMixin","MercuryThreadMode","MessagingTag","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","copyProperties","createObjectFrom","removeFromArray"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MercuryConfig'),i=b('TimestampConverter'),j=b('MercuryFolders'),k=b('JSLogger'),l=b('KeyedCallbackManager'),m=b('MercuryActionTypeConstants'),n=b('MercuryAssert'),o=b('MercuryAttachment'),p=b('MercuryGlobalActionType'),q=b('MercuryIDs'),r=b('MercuryLogMessageType'),s=b('MercurySingletonMixin'),t=b('MercuryThreadMode'),u=b('MessagingTag'),v=b('MercuryParticipants'),w=b('MercuryServerRequests'),x=b('MercuryThreadInformer'),y=b('copyProperties'),z=b('createObjectFrom'),aa=b('removeFromArray'),ba=k.create('mercury_threads');function ca(oa,pa,qa){var ra=z(pa.participants,true),sa=v.getIDForUser(oa._fbid);qa.forEach(function(ta){if(ra[ta]!==true){pa.participants.push(ta);if(ta===sa)pa.is_subscribed=true;}});}function da(oa,pa,qa){aa(pa.participants,qa);if(qa===v.getIDForUser(oa._fbid))pa.is_subscribed=false;}function ea(oa,pa){if(oa.participants[0]!=pa){aa(oa.participants,pa);oa.participants.unshift(pa);}}function fa(oa,pa){var qa=pa.body,ra=pa.subject,sa='';if(ra){ra=ra.toLowerCase();if(qa.slice(0,ra.length).toLowerCase()==ra){sa=qa;}else if(qa){sa=ra+' \u00B7 '+qa;}else sa=ra;}else sa=qa;oa.snippet=sa;oa.snippet_has_attachment=pa.has_attachment;if(pa.raw_attachments&&pa.raw_attachments.length>0){var ta=o.convertRaw(pa.raw_attachments);oa.snippet_attachments=ta;}else oa.snippet_attachments=pa.attachments;oa.is_forwarded_snippet=!!pa.forward_count;oa.snippet_sender=pa.author;}function ga(oa,pa,qa){if(!pa)return false;if(!pa.timestamp)return true;var ra=!pa.unread_count;if(qa==ra)return false;pa.unread_count=qa?0:1;oa._threadInformer.updatedThread(pa.thread_id);return true;}function ha(oa,pa){var qa=oa._threads.getAllResources();for(var ra in qa){var sa=qa[ra];if(sa.folder==pa){sa.unread_count=0;oa._threads.setResource(ra,sa);oa._threadInformer.updatedThread(ra);}}}function ia(oa,pa,qa){if(!pa||pa.chat_clear_time===qa)return false;pa.chat_clear_time=qa;oa._threadInformer.reorderedMessages(pa.thread_id);return true;}function ja(oa,pa,qa,ra){var sa=qa.action_type;if(sa==m.USER_GENERATED_MESSAGE||sa==m.LOG_MESSAGE){qa.is_unread&&pa.unread_count++;pa.message_count++;pa.is_archived=false;}switch(sa){case m.USER_GENERATED_MESSAGE:ea(pa,qa.author);break;case m.SEND_MESSAGE:var ta=qa.log_message_type;if(ta==r.THREAD_IMAGE)pa.image_src=qa.log_message_data.image?qa.log_message_data.image.preview_url:null;pa.snippet_attachments=qa.attachments;break;case m.LOG_MESSAGE:var ta=qa.log_message_type;if(ta==r.SUBSCRIBE){ca(oa,pa,qa.log_message_data.added_participants);}else if(ta==r.JOINABLE_JOINED){ca(oa,pa,[qa.log_message_data.joined_participant]);}else if(ta==r.UNSUBSCRIBE){da(oa,pa,qa.author);}else if(ta==r.THREAD_IMAGE){if(!ra)pa.image_src=qa.log_message_data.image?qa.log_message_data.image.preview_url:null;}else if(ta==r.THREAD_NAME)pa.name=qa.log_message_data.name;break;case m.CHANGE_READ_STATUS:if(qa.timestamp)oa._threadInformer.changedThreadReadState(pa.thread_id,qa.mark_as_read,qa.timestamp);ga(oa,pa,qa.mark_as_read);break;case m.CLEAR_CHAT:ia(oa,pa,qa.clear_time);break;case m.CHANGE_ARCHIVED_STATUS:pa.is_archived=qa.archived;break;case m.CHANGE_FOLDER:pa.folder=qa.new_folder;break;case m.DELETE_MESSAGES:if(ra){pa.snippet='...';pa.snippet_has_attachment=false;pa.snippet_attachments=null;pa.snippet_sender=null;pa.is_forwarded_snippet=false;oa._threadInformer.updatedThread(qa.thread_id);}else if(qa.message_ids)pa.message_count=pa.message_count-qa.message_ids.length;break;case m.CHANGE_MUTE_SETTINGS:if(h.MuteThreadsOnDesktopGK&&qa.mute_settings!==undefined){var ua=oa._fbid+'@facebook.com';if(pa.mute_settings){if(qa.mute_settings){pa.mute_settings[ua]=qa.mute_settings;}else delete pa.mute_settings[ua];oa._threadInformer.updatedThread(pa.thread_id);}}break;}if(qa.action_id)pa.last_action_id=i.maxValidActionID(qa.action_id,pa.last_action_id);}function ka(oa,pa){var qa=oa._serverRequests.tokenizeThreadID(pa.thread_id);if(qa.type=='group'){ba.error('invalid_new_thread_message',pa);return undefined;}var ra=ma(oa,pa.specific_to_list),sa={thread_id:pa.thread_id,last_action_id:pa.action_id,participants:pa.specific_to_list,name:null,snippet:pa.body,snippet_has_attachment:false,snippet_attachments:[],snippet_sender:pa.author,unread_count:0,message_count:0,image_src:null,timestamp_absolute:pa.timestamp_absolute,timestamp_relative:pa.timestamp_relative,timestamp:pa.timestamp,canonical_fbid:qa.type==='user'?qa.value:null,is_canonical_user:qa.type==='user',is_canonical:ra,is_subscribed:true,root_message_threading_id:pa.message_id,folder:u.INBOX,is_archived:false,mode:t.TITAN_ORIGINATED};return sa;}function la(oa){this._fbid=oa;this._serverRequests=w.getForFBID(this._fbid);this._threadInformer=x.getForFBID(this._fbid);this._threads=new l();na(this);}y(la.prototype,{getThreadMetaNow:function(oa){n.isThreadID(oa);return this._threads.getResource(oa);},getThreadMeta:function(oa,pa,qa){n.isThreadID(oa);var ra=this._threads.executeOrEnqueue(oa,pa),sa=this._threads.getUnavailableResources(ra);if(sa.length){var ta=this._serverRequests.tokenizeThreadID(oa);if(ta.type=='user'){this.getCanonicalThreadToUser(ta.value);}else this._serverRequests.fetchThreadData(sa,qa);}return ra;},unsubscribe:function(oa){this._threads.unsubscribe(oa);},changeThreadReadStatus:function(oa,pa){n.isThreadID(oa);var qa=this._threads.getResource(oa);if(ga(this,qa,pa))this._serverRequests.changeThreadReadStatus(oa,pa,j.getFromMeta(qa));},changeThreadArchivedStatus:function(oa,pa){n.isThreadID(oa);var qa=this._threads.getResource(oa);if(qa.is_archived!=pa){qa.is_archived=pa;this._threadInformer.updatedThread(qa.thread_id);this._serverRequests.changeThreadArchivedStatus(oa,pa);}},markThreadSpam:function(oa){this._serverRequests.markThreadSpam(oa);},unmarkThreadSpam:function(oa){this._serverRequests.unmarkThreadSpam(oa);},updateThreadMuteSetting:function(oa,pa){this._serverRequests.changeMutingOnThread(oa,pa);},changeFolder:function(oa,pa){n.isThreadID(oa);var qa=this._threads.getResource(oa);if(qa&&qa.folder!=pa){qa.folder=pa;this._threadInformer.updatedThread(qa.thread_id);this._serverRequests.changeThreadFolder(oa,pa);}},deleteThread:function(oa){n.isThreadID(oa);this._serverRequests.deleteThread(oa);},updateThreads:function(oa){if(!oa||!oa.length)return;var pa={};oa.forEach(function(qa){pa[qa.thread_id]=qa;});this._threads.addResourcesAndExecute(pa);},updateMetadataByActions:function(oa,pa){if(!oa||!oa.length)return;var qa={},ra={},sa={};for(var ta=0;ta<oa.length;ta++){var ua=oa[ta];if(ua.is_forward)continue;var va=ua.action_type,wa=ua.thread_id;n.isThreadID(wa);var xa=this.getThreadMetaNow(wa);if(va==m.LOG_MESSAGE&&ua.log_message_type==r.SERVER_ERROR)continue;if(!xa&&!ua.action_id&&va==m.USER_GENERATED_MESSAGE){xa=ka(this,ua);this._threads.setResource(wa,xa);}if(xa){if(va==m.DELETE_THREAD){xa.message_count=0;this._threadInformer.deletedThread(wa);continue;}var ya=!!ua.action_id;if(va==m.LOG_MESSAGE||va==m.USER_GENERATED_MESSAGE)ya=!pa;if(xa.server_timestamp&&ua.timestamp<=xa.server_timestamp&&ya)continue;if(!sa[wa])sa[wa]=y({},xa);ja(this,sa[wa],ua,pa);if(va==m.USER_GENERATED_MESSAGE)qa[wa]=ua;if(va==m.USER_GENERATED_MESSAGE||va==m.LOG_MESSAGE||va==m.SEND_MESSAGE)if(ua&&ua.timestamp&&(!ra[wa]||ua.timestamp>ra[wa].timestamp))ra[wa]=ua;}}for(var za in sa){var ab=sa[za],bb=qa[za];if(bb)fa(ab,bb);var cb=ra[za],db=ab.timestamp;if(cb){if(cb.timestamp>db)ab=y(ab,{timestamp_absolute:cb.timestamp_absolute,timestamp_relative:cb.timestamp_relative,timestamp:cb.timestamp});var eb=ab.server_timestamp;if(!pa&&cb.timestamp>eb)ab.server_timestamp=cb.timestamp;}this._threads.setResource(za,ab);}},getCanonicalThreadToUser:function(oa,pa,qa){return this.getCanonicalThreadToParticipant('fbid:'+oa,pa,qa);},getCanonicalThreadToParticipant:function(oa,pa,qa){var ra=this.getThreadIDForParticipant(oa),sa=this._threads.getResource(ra);if(typeof sa=='undefined'){sa=this.createNewLocalThread(ra,[v.getIDForUser(this._fbid),oa],pa);this._serverRequests.fetchThreadData([ra],qa);}return sa;},getThreadIdForUser:function(oa){return 'user:'+oa;},getThreadIDForParticipant:function(oa){var pa=q.tokenize(oa);return this.getThreadIdForUser(pa.value);},createNewLocalThread:function(oa,pa,qa){var ra=this._threads.getResource(oa);if(!ra){var sa=this._serverRequests.tokenizeThreadID(oa);ra={thread_id:oa,last_action_id:null,participants:pa,name:null,snippet:'',snippet_has_attachment:false,snippet_sender:null,unread_count:qa?qa:0,message_count:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,canonical_fbid:sa.type==='user'?sa.value:null,is_canonical_user:sa.type=='user',is_canonical:ma(this,pa),is_subscribed:true,root_message_threading_id:null,folder:u.INBOX,is_archived:false,mode:t.TITAN_ORIGINATED};this._threads.setResource(oa,ra);}return ra;},addParticipantsToThreadLocally:function(oa,pa){var qa=this._threads.getResource(oa);if(qa){ca(this,qa,pa);this._threadInformer.updatedThread(qa.thread_id);}},getCanonicalUserInThread:function(oa){var pa=this._serverRequests.tokenizeThreadID(oa);return pa.type=='user'?pa.value:null;},getCanonicalGroupInThread:function(oa){var pa=this._serverRequests.tokenizeThreadID(oa);return pa.type=='group'?pa.value:null;},isEmptyLocalThread:function(oa){var pa=this._threads.getResource(oa);if(!pa)return false;var qa=this._serverRequests.tokenizeThreadID(oa);return qa.type=='root'&&!pa.timestamp;},isNewEmptyLocalThread:function(oa){if(!this.isEmptyLocalThread(oa))return false;var pa=this._threads.getResource(oa);return pa.participants&&pa.participants.length===0;},canReply:function(oa){var pa=this._threads.getResource(oa);return pa&&pa.is_subscribed&&pa.mode!=t.OBJECT_ORIGINATED&&(pa.recipients_loadable||pa.recipients_loadable===undefined);}});y(la,s);function ma(oa,pa){var qa=pa.filter(function(ra){return ra!=v.getIDForUser(oa._fbid);});return qa.length<=1;}function na(oa){oa._serverRequests.subscribe('update-threads',function(pa,qa){var ra=(qa.actions||[]).filter(function(va){return va.thread_id;});oa.updateThreads(qa.threads);oa.updateMetadataByActions(ra,qa.from_client);(qa.threads||[]).forEach(function(va){oa._threadInformer.updatedThread(va.thread_id);});var sa=qa.global_actions||[];for(var ta=0;ta<sa.length;ta++){var ua=sa[ta];if(ua.action_type==p.MARK_ALL_READ)ha(oa,ua.folder);}});}g.subscribe(k.DUMP_EVENT,function(oa,pa){pa.messaging=pa.messaging||{};pa.messaging.threads={};var qa=la._getInstances();for(var ra in qa)pa.messaging.threads[ra]=qa[ra]._threads.dumpResources();});e.exports=la;});
__d("formatDate",["tx"],function(a,b,c,d,e,f){var g=b('tx'),h=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],j=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],k=["January","February","March","April","May","June","July","August","September","October","November","December"];function l(n,o){o=o||2;n=''+n;while(n.length<o)n='0'+n;return n;}function m(n,o,p){if(!o)return '';var q=[],r=null,s=null,t=p?'getUTC':'get',u=n[t+'Date'](),v=n[t+'Day'](),w=n[t+'Month'](),x=n[t+'FullYear'](),y=n[t+'Hours'](),z=n[t+'Minutes'](),aa=n[t+'Seconds'](),ba=n[t+'Milliseconds']();for(var ca=0;ca<o.length;ca++){s=o.charAt(ca);if(s=='\\'){ca++;q.push(o.charAt(ca));continue;}switch(s){case 'd':r=l(u);break;case 'D':r=h[v];break;case 'j':r=u;break;case 'l':r=i[v];break;case 'F':r=k[w];break;case 'm':r=l(w+1);break;case 'M':r=j[w];break;case 'n':r=w+1;break;case 'Y':r=x;break;case 'y':r=(''+x).slice(2);break;case 'a':r=y<12?'am':'pm';break;case 'A':r=y<12?'AM':'PM';break;case 'g':r=(y==0||y==12)?12:y%12;break;case 'G':r=y;break;case 'h':r=(y==0||y==12)?12:l(y%12);break;case 'H':r=l(y);break;case 'i':r=l(z);break;case 's':r=l(aa);break;case 'S':r=l(ba,3);break;default:r=s;}q.push(r);}return q.join('');}e.exports=m;});
__d("MercuryMessages",["Arbiter","AsyncRequest","Env","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercuryActionStatus","MercuryAssert","MercuryAttachmentType","MercuryConfig","MercuryGenericConstants","MercuryIDs","MercuryLogMessageType","MercuryMessageSourceTags","MercuryPayloadSource","MercurySingletonMixin","MercurySourceType","MercuryTimePassed","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","debounce","formatDate","randomInt","tx"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('Env'),j=b('JSLogger'),k=b('KeyedCallbackManager'),l=b('MercuryActionTypeConstants'),m=b('MercuryActionStatus'),n=b('MercuryAssert'),o=b('MercuryAttachmentType'),p=b('MercuryConfig'),q=b('MercuryGenericConstants'),r=b('MercuryIDs'),s=b('MercuryLogMessageType'),t=b('MercuryMessageSourceTags'),u=b('MercuryPayloadSource'),v=b('MercurySingletonMixin'),w=b('MercurySourceType'),x=b('MercuryTimePassed'),y=b('MercuryMessageIDs'),z=b('MercuryParticipants'),aa=b('PresenceUtil'),ba=b('RangedCallbackManager'),ca=b('MercuryServerRequests'),da=b('MercuryThreadInformer'),ea=b('MercuryThreads'),fa=b('copyProperties'),ga=b('debounce'),ha=b('formatDate'),ia=b('randomInt'),ja=b('tx');function ka(bb,cb){var db=cb;if(bb._localIdsMap[cb])db=bb._localIdsMap[cb];return bb._messages[db];}var la=new k();function ma(bb,cb){if(cb.status===undefined)cb.status=m.UNSENT;cb.timestamp_absolute="Today";cb.message_id=cb.message_id||bb.generateNewClientMessageID(cb.timestamp);var db=z.getIDForUser(bb._fbid);cb.specific_to_list=cb.specific_to_list||[];if(cb.specific_to_list.length&&cb.specific_to_list.indexOf(db)===-1)cb.specific_to_list.push(db);if(!cb.thread_id){if(cb.specific_to_list.length==1){cb.thread_id='user:'+bb._fbid;}else if(cb.specific_to_list.length==2){var eb=cb.specific_to_list[0]==db?cb.specific_to_list[1]:cb.specific_to_list[0];if(r.tokenize(eb).type=='email'){cb.thread_id=q.PENDING_THREAD_ID;}else cb.thread_id=bb._threads.getThreadIDForParticipant(eb);}cb.thread_id=cb.thread_id||'root:'+cb.message_id;}if(!cb.specific_to_list.length){var fb=bb._serverRequests.tokenizeThreadID(cb.thread_id);if(fb.type=='user')cb.specific_to_list=['fbid:'+fb.value,db];}}function na(bb,cb,db,eb){var fb=xa(db)?[t.CHAT]:[],gb=Date.now(),hb=ha(new Date(gb),p['24h_times']?'H:i':'g:ia'),ib={action_type:cb,thread_id:eb,author:z.getIDForUser(bb._fbid),author_email:null,coordinates:null,timestamp:gb,timestamp_absolute:(new Date(gb)).toLocaleDateString(),timestamp_relative:hb,timestamp_time_passed:x.TODAY,is_unread:false,is_cleared:false,is_forward:false,is_filtered_content:false,spoof_warning:false,source:db,source_tags:fb};return ib;}function oa(bb){switch(bb){case u.UNKNOWN:case u.SERVER_INITIAL_DATA:case u.SERVER_FETCH_THREAD_INFO:case u.SERVER_THREAD_SYNC:return true;}return false;}function pa(bb){return bb&&bb.substr(0,6)==='server';}function qa(bb,cb){if(!bb._threadsToMessages[cb])bb._threadsToMessages[cb]=new ba(function(db){return ka(bb,db).timestamp;},function(db,eb){return eb-db;});return bb._threadsToMessages[cb];}g.subscribe(j.DUMP_EVENT,function(bb,cb){var db={},eb={},fb=sa._getInstances();for(var gb in fb){db[gb]={};for(var hb in fb[gb]._messages){var ib=fb[gb]._messages[hb];if(Object.keys(ib).length===0)continue;var jb=ib.thread_id;db[gb][jb]=db[gb][jb]||{};db[gb][jb][ib.message_id]={action_type:ib.action_type,author:ib.author,is_unread:ib.is_unread,timestamp:ib.timestamp};}eb[gb]=fa({},fb[gb]._localIdsMap);}cb.messaging=cb.messaging||{};cb.messaging.local_message_ids=eb;cb.messaging.messages=db;});function ra(bb,cb,db){cb.forEach(function(eb){var fb=qa(bb,eb);fb.setReachedEndOfArray();bb._threadInformer.reorderedMessages(eb,db);});}function sa(bb){this._fbid=bb;this._serverRequests=ca.getForFBID(this._fbid);this._threadInformer=da.getForFBID(this._fbid);this._threads=ea.getForFBID(this._fbid);this._failedHistoryFetchThreads={};this._threadsToMessages={};this._titanMessagesCount={};this._localTitanMessagesCount={};this._messages={};this._attachmentData={};this._messagesNeedingAttachmentData={};this._localIdsMap={};this._serverRequests.subscribe('update-messages',function(cb,db){var eb=(db.actions||[]).filter(function(gb){var hb=gb.action_type;return (gb.is_forward||gb.thread_id)&&(hb==l.LOG_MESSAGE||hb==l.USER_GENERATED_MESSAGE||hb==l.SEND_MESSAGE||hb==l.CLEAR_CHAT||hb==l.DELETE_THREAD||hb==l.DELETE_MESSAGES);}),fb=oa(db.payload_source);if(pa(db.payload_source))eb.forEach(function(gb){if(!gb.is_forward){var hb=this._threads.getThreadMetaNow(gb.thread_id);if(hb)gb.is_cleared=gb.timestamp<hb.chat_clear_time;}}.bind(this));this.handleUpdates(eb,fb,db.payload_source,db.from_client);if(db.end_of_history)ra(this,db.end_of_history,db.payload_source);}.bind(this));}fa(sa.prototype,{getMessagesFromIDs:function(bb){return (bb||[]).map(ka.curry(this)).filter(function(cb){return cb;});},hasLoadedNMessages:function(bb,cb){var db=qa(this,bb);return db.hasReachedEndOfArray()||db.getCurrentArraySize()>=cb;},hasLoadedExactlyNMessages:function(bb,cb){var db=qa(this,bb);return db.getCurrentArraySize()==cb;},getThreadMessagesRange:function(bb,cb,db,eb,fb,gb){var hb=qa(this,bb),ib=function(ob){eb(ta(this,ob));}.bind(this),jb=hb.executeOrEnqueue(cb,db,ib),kb=hb.getUnavailableResources(jb),lb=this._failedHistoryFetchThreads[bb];if(kb.length&&!lb){var mb=(this._titanMessagesCount[bb]||0)-(this._localTitanMessagesCount[bb]||0),nb=kb.length+(this._localTitanMessagesCount[bb]||0);this._serverRequests.fetchThreadMessages(bb,mb,nb,fb,gb);}else this._failedHistoryFetchThreads[bb]=false;return jb;},getThreadMessagesSinceTimestamp:function(bb,cb){var db=qa(this,bb),eb=db.getElementsUntil(cb);return ta(this,eb);},hasLoadedAllMessages:function(bb){return qa(this,bb).hasReachedEndOfArray();},getCurrentlyLoadedMessages:function(bb){var cb=qa(this,bb).getAllResources();return ta(this,cb);},unsubscribe:function(bb,cb){n.isThreadID(cb);var db=qa(this,cb);db.unsubscribe(bb);},addAttachmentData:function(bb,cb,db){var eb=ka(this,bb);if(eb){var fb=eb.attachments.indexOf(cb);if(fb!=-1){eb.attachments[fb]=db;this._threadInformer.updatedMessage(eb.thread_id,eb.message_id,'attach');}}else{if(!this._attachmentData[bb])this._attachmentData[bb]=[];this._attachmentData[bb].push({attach_key:cb,data:db});}},handleUpdates:function(bb,cb,db,eb){var fb,gb={},hb={};for(var ib=0;ib<bb.length;ib++){var jb=bb[ib];if(jb.is_forward||db==u.SERVER_SEARCH){if(!this._messages[jb.message_id]){this._messages[jb.message_id]=jb;ya(this,jb);}continue;}var kb=jb.action_type;if(kb==l.SEND_MESSAGE){var lb=jb.client_message_id;if(lb&&this._localIdsMap[lb]&&jb.status){if(jb.status==m.UNCONFIRMED){if(!hb[jb.thread_id])hb[jb.thread_id]=[];hb[jb.thread_id].push(jb.client_message_id);}else if(!gb[jb.thread_id])gb[jb.thread_id]=[];var mb=ka(this,jb.client_message_id),nb=mb.status;mb.status=jb.status;if(jb.status===m.SUCCESS||jb.error_data)mb.error_data=jb.error_data;if(jb.status==m.SUCCESS){this.updateLocalMessage(jb,db);if(jb.client_thread_id==q.PENDING_THREAD_ID){mb.thread_id=jb.thread_id;gb[jb.thread_id].push(mb.message_id);la.setResource(mb.message_id,mb.thread_id);}}if(typeof nb!='undefined'||jb.status==m.FAILED_UNKNOWN_REASON||jb.status==m.UNABLE_TO_CONFIRM||jb.status==m.SUCCESS||jb.status==m.ERROR)this._threadInformer.updatedMessage(jb.thread_id,ka(this,jb.client_message_id).message_id,db);}continue;}else if(kb==l.DELETE_THREAD){qa(this,jb.thread_id).removeAllResources();continue;}else if(kb==l.DELETE_MESSAGES){var ob=jb.message_ids.map(function(vb){return ka(this,vb).message_id;}.bind(this));fb=qa(this,jb.thread_id);fb.removeResources(ob);this._threadInformer.reorderedMessages(jb.thread_id,db);continue;}else if(kb==l.LOG_MESSAGE){if(jb.log_message_type==s.SERVER_ERROR)this._failedHistoryFetchThreads[jb.thread_id]=true;}else if(kb==l.CLEAR_CHAT){var pb=qa(this,jb.thread_id).getAllResources();pb.map(ka.curry(this)).forEach(function(vb){vb.is_cleared=true;});continue;}var qb=ka(this,jb.message_id);if((jb.threading_id&&this._localIdsMap[jb.threading_id])||(qb&&!qb.is_forward))continue;if(!gb[jb.thread_id])gb[jb.thread_id]=[];gb[jb.thread_id].push(jb.message_id);this._messages[jb.message_id]=jb;ya(this,jb);if(jb.threading_id&&jb.threading_id!=jb.message_id)y.addServerID(jb.threading_id,jb.message_id);if(!cb)this._threadInformer.receivedMessage(jb);}for(var rb in gb){fb=qa(this,rb);var sb=fb.getAllResources(),tb=sb.filter(function(vb){var wb=this._messages[vb];return wb.action_type==l.LOG_MESSAGE&&wb.log_message_type==s.SERVER_ERROR;}.bind(this));fb.removeResources(tb);ua(this,rb,gb[rb]);if(eb)va(this,rb,gb[rb]);if(cb){fb.addResources(gb[rb]);this._threadInformer.reorderedMessages(rb,db);}else fb.addResourcesWithoutSorting(gb[rb].reverse(),0);this._threadInformer.updatedThread(rb);}var ub=Object.keys(hb);if(ub.length)this._serverRequests.requestMessageConfirmation(hb);},sendMessage:function(bb,cb,db){cb=cb||Function.prototype;ma(this,bb);this._localIdsMap[bb.message_id]=bb.message_id;if(bb.thread_id=='root:'+bb.message_id)qa(this,bb.thread_id).setReachedEndOfArray();this._serverRequests.sendNewMessage(bb,db);if(bb.thread_id==q.PENDING_THREAD_ID){this._messages[bb.message_id]=bb;return la.executeOrEnqueue(bb.message_id,cb);}else cb(bb.thread_id);},isFirstMessage:function(bb){var cb=qa(this,bb.thread_id);if(cb.getCurrentArraySize()===0)return false;var db=cb.getResourceAtIndex(cb.getCurrentArraySize()-1),eb=ka(this,db).message_id,fb=ka(this,bb.message_id).message_id;return cb.hasReachedEndOfArray()&&eb==fb;},unsubscribeSend:function(bb){la.unsubscribe(bb);},resendMessage:function(bb,cb){var db=fa({},bb);db.status=m.RESENDING;db.timestamp=Date.now();db.message_id=bb.message_id;this._messages[bb.message_id]=db;var eb=qa(this,bb.thread_id);eb.resortResources([bb.message_id]);this.sendMessage(db,null,cb);this._threadInformer.reorderedMessages(bb.thread_id,u.CLIENT_SEND_MESSAGE);},deleteMessages:function(bb,cb){if(cb.length){var db=qa(this,bb),eb=db.getCurrentArraySize()==cb.length&&db.hasReachedEndOfArray();this._serverRequests.deleteMessages(bb,cb,eb);}},markMessagesSpam:function(bb,cb){if(cb.length){var db=qa(this,bb),eb=db.getCurrentArraySize()==cb.length&&db.hasReachedEndOfArray();if(eb){this._serverRequests.markThreadSpam(bb);}else this._serverRequests.markMessagesSpam(bb,cb);}},updateLocalMessage:function(bb,cb){var db=bb.message_id,eb=bb.client_message_id;this._localIdsMap[eb]=db;this._messages[db]=this._messages[eb];y.addServerID(eb,db);this._messages[eb]={};var fb=ka(this,eb);if(bb.timestamp)fb.timestamp=bb.timestamp;if(bb.attachments&&bb.attachments.length){fb.raw_attachments=null;fb.attachments=bb.attachments;ya(this,fb,db);}if(bb.log_message_data)fb.log_message_data=bb.log_message_data;if(wa(fb))this._localTitanMessagesCount[fb.thread_id]--;},constructUserGeneratedMessageObject:function(bb,cb,db,eb){var fb=na(this,l.USER_GENERATED_MESSAGE,cb,db);fb.body=bb;fb.has_attachment=false;fb.html_body=false;fb.attachments=[];fb.specific_to_list=eb||[];return fb;},constructLogMessageObject:function(bb,cb,db,eb){var fb=na(this,l.LOG_MESSAGE,bb,cb);fb.log_message_type=db;fb.log_message_data=eb;return fb;},generateNewClientMessageID:function(bb){var cb=bb+':'+(ia(0,4294967295)+1)+'-'+aa.getSessionID();return '<'+cb+'@mail.projektitan.com>';},getNumberLocalMessages:function(bb){return this._localTitanMessagesCount[bb]||0;}});fa(sa,v,{addAttachmentData:function(bb,cb,db,eb){eb=eb||i.user;sa.getForFBID(eb).addAttachmentData(bb,cb,db);}});function ta(bb,cb){var db=cb.map(ka.curry(bb));return db.reverse();}function ua(bb,cb,db){var eb=db.filter(function(fb){return wa(ka(bb,fb));});if(!bb._titanMessagesCount[cb])bb._titanMessagesCount[cb]=0;bb._titanMessagesCount[cb]+=eb.length;}function va(bb,cb,db){var eb=db.filter(function(fb){return wa(ka(bb,fb));});if(!bb._localTitanMessagesCount[cb])bb._localTitanMessagesCount[cb]=0;bb._localTitanMessagesCount[cb]+=eb.length;}function wa(bb){var cb=bb.action_type;if(cb==l.USER_GENERATED_MESSAGE)return true;switch(bb.log_message_type){case s.SUBSCRIBE:case s.UNSUBSCRIBE:case s.SERVER_ERROR:case s.LIVE_LISTEN:return false;default:return true;}}function xa(bb){switch(bb){case w.CHAT_WEB:case w.CHAT_JABBER:case w.CHAT_IPHONE:case w.CHAT_MEEBO:case w.CHAT_ORCA:case w.CHAT_TEST:case w.CHAT:case w.DESKTOP:return true;default:return false;}}function ya(bb,cb,db){db=db||cb.message_id;var eb=bb._attachmentData[db];if(eb){eb.forEach(function(fb){var gb=cb.attachments.indexOf(fb.attach_key);if(gb!==-1)cb.attachments[gb]=fb.data;});delete bb._attachmentData[db];}else if(!cb.is_forward&&za(bb,cb)){bb._messagesNeedingAttachmentData[db]=true;ab(bb);}}function za(bb,cb){if(!cb||!cb.attachments)return false;for(var db=0;db<cb.attachments.length;db++){var eb=cb.attachments[db];if(typeof eb==='string'&&eb.indexOf(o.SHARE)===0)return true;}var fb=cb.forward_message_ids||[];for(db=0;db<fb.length;db++){var gb=ka(bb,fb[db]);if(za(bb,gb))return true;}return false;}var ab=ga(function(bb){var cb={};for(var db in bb._messagesNeedingAttachmentData){var eb=ka(bb,db);if(za(bb,eb))cb[db]=true;}var fb=Object.keys(cb);if(fb.length)new h('/ajax/mercury/attachments/fetch_shares.php').setData({message_ids:fb}).setAllowCrossPageTransition(true).send();bb._messagesNeedingAttachmentData={};},0,this,true);e.exports=sa;});
__d("ChatOpenTab",["Arbiter","Bootloader","Event","MercuryIDs","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Bootloader'),i=b('Event'),j=b('MercuryIDs'),k=b('MercuryMessages').get(),l=b('MercuryServerRequests').get(),m=b('MercuryThreads').get();function n(q){m.getThreadMeta(q,function(){g.inform('chat/open-tab',{thread_id:q});});}function o(q,r,s){i.listen(q,'click',function(t){if(s(r))return;return t.kill();});}var p={openEmptyTab:function(){if(!window.Chat)return true;h.loadModules(['ChatTabModel'],function(q){var r=q.getEmptyTab();if(!r){r='root:'+k.generateNewClientMessageID(Date.now());m.createNewLocalThread(r,[]);}n(r);});},listenOpenEmptyTab:function(q){o(q,null,p.openEmptyTab);},openThread:function(q){if(j.isValid(q)){n(q);}else l.getClientThreadID(q,n);},listenOpenThread:function(q,r){o(q,r,p.openThread);},openUserTab:function(q){var r=m.getCanonicalThreadToUser(q);n(r.thread_id);},listenOpenUserTab:function(q,r){o(q,r,p.openUserTab);}};e.exports=p;});
__d("OrderedFriendsList",["AvailableList","ChatConfig","createArrayFrom","ShortProfiles","AsyncRequest","InitialChatFriendsList"],function(a,b,c,d,e,f){var g=b('AvailableList'),h=b('ChatConfig'),i=b('createArrayFrom'),j=b('ShortProfiles'),k=b('AsyncRequest'),l=[],m={},n=[],o={contains:function(p){return p in m;},compare:function(p,q){var r=o.getRank(p),s=o.getRank(q);if(r!==s)return r-s;var t=j.getNowUnsafe(p),u=j.getNowUnsafe(q),v=((t||{}).name||'~').toLowerCase(),w=((u||{}).name||'~').toLowerCase();if(v!==w)return v<w?-1:1;return 0;},getList:function(){if(h.get('chat_web_ranking_with_presence'))o.reRank();var p=i(l);p=p.filter(function(q){var r=j.getNowUnsafe(q);return !r||r.type=="friend";});return p;},getRank:function(p){return p in m?m[p]:l.length;},reload:function(){new k().setURI('/chat/ranking/web_divebar.php').setHandler(function(p){l=p.list.length?p.list:[];l.forEach(function(q,r){m[q]=r;});}).send();},reRank:function(){var p={},q={};n.forEach(function(s,t){var u=s.substr(0,s.length-2),v=s.substring(s.length-1);if(typeof(q.uid)=='undefined'){if(typeof(p.uid)=='undefined')p[u]=g.get(u);var w=p[u];if(w==v)q[t]=u;}});l=[];for(var r in q)l.push(q[r]);l.forEach(function(s,t){m[s]=t;});}};(function(){var p=b('InitialChatFriendsList');l=p.list.length?p.list:[];if(h.get('chat_web_ranking_with_presence')){n=l.slice();o.reRank();}l.forEach(function(q,r){m[q]=r;});})();e.exports=a.OrderedFriendsList||o;});
__d("ChatSidebarConstants",[],function(a,b,c,d,e,f){var g={LITESTAND_IMAGE_SIZE:24,IMAGE_SIZE:28};e.exports=g;});
__d("ChatTypeaheadBehavior",["Chat","ChatConfig","ChatFavoriteList","CSS","DOM","Rect","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Chat'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('CSS'),k=b('DOM'),l=b('Rect'),m=b('copyProperties'),n=b('tx');function o(p){this._typeahead=p;}m(o.prototype,{_subscriptions:null,enable:function(){var p=this._typeahead;this._subscriptions=[p.subscribe('focus',function(){p.getData().refreshData();}),p.subscribe('blur',function(q){p.getCore().reset();}),p.subscribe('respond',function(q,r){if(r.value&&r.value===p.getCore().getValue()){if(!r.results.length){var s=h.get('divebar_typeahead_group_fof',0);if(s&&!r.isAsync)return;var t=k.create('div',{className:'noResults'},"Friend not found.");k.setContent(p.getView().getElement(),t);}j.addClass(p.getElement(),'hasValue');}}),p.subscribe('reset',function(){j.removeClass(p.getElement(),'hasValue');}),p.subscribe('select',function(q,r){if(i.isEditMode()){i.toggleID(r.selected.uid);i.save();}else{var s=j.hasClass(document.documentElement,'sidebarMode'),t={mode:s?'sidebar':'chatNub',source:'typeahead',type:r.selected.type,typeahead:true};g.openTab(r.selected.uid,r.selected.type,t);}}),p.subscribe('highlight',function(q,r){if(r.index>=0){var s=p.getView().getItems()[r.index];if(s){var t=new l(s),u=s.offsetParent,v=t.boundWithin(new l(u)).getPositionVector();t.getPositionVector().sub(v).scrollElementBy(u);}}})];},disable:function(){this._subscriptions.forEach(function(p){this._typeahead.unsubscribe(p);}.bind(this));this._subscriptions=null;}});e.exports=o;});
__d("TypeaheadCore",["Event","Arbiter","ArbiterMixin","CSS","DOM","Focus","Input","InputSelection","Keys","StickyPlaceholderInput","UserAgent","bind","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('CSS'),k=b('DOM'),l=b('Focus'),m=b('Input'),n=b('InputSelection'),o=b('Keys'),p=b('StickyPlaceholderInput'),q=b('UserAgent'),r=b('bind'),s=b('copyProperties'),t=b('emptyFunction');function u(v){s(this,v);}s(u.prototype,i,{events:['blur','focus','click','unselect','loading'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(v,w,x){this.init=t;this.data=v;this.view=w;this.root=x;this.initInput();this.inputWrap=k.find(x,'div.wrap');this.hiddenInput=k.find(x,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&j.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initInput:function(){this.element=k.find(this.root,'.textInput');var v=k.scry(this.element,'input')[0];if(v)this.element=v;},initView:function(){this.view.subscribe('highlight',l.set.curry(this.element));this.view.subscribe('select',function(v,w){this.select(w.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(v,w){if(w.forceDisplay||w.value==this.getValue()&&!this.element.disabled)this.view.render(w.value,w.results,w.isAsync);}.bind(this));this.data.subscribe('activity',function(v,w){this.fetching=w.activity;if(!this.fetching)this.nextQuery&&this.performQuery();if(this.loading!=this.fetching){this.loading=this.fetching;this.inform('loading',{loading:this.loading});}}.bind(this));},initEvents:function(){g.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var v={blur:r(this,'blur'),focus:r(this,'focus'),click:r(this,'click'),keyup:r(this,'keyup'),keydown:r(this,'keydown')};if(q.firefox())v.text=v.keyup;if(q.firefox()<4){v.keypress=v.keydown;delete v.keydown;}g.listen(this.element,v);g.listen(this.element,'keypress',r(this,'keypress'));},initToggle:function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){var v=n.get(this.element);if(v.start==v.end)this.element.select();this.inform('click');},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(g.getKeyCode(event)){case o.TAB:this.handleTab(event);return;case o.UP:this.view.prev();break;case o.DOWN:this.view.next();break;case o.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&g.getKeyCode(event)==o.RETURN){this.view.select();event.kill();}},handleTab:function(event){if(this.preventFocusChangeOnTab)if(this.view.getSelection()){event.kill();}else event.prevent();this.view.select();},select:function(v){if(v&&this.setValueOnSelect){this.setValue(v.text);this.setHiddenValue(v.uid);this.selectedText=v.text;j.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.keepFocused?l.set(this.element):this.element.blur();this.resetOnSelect?this.reset():this.view.reset();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;j.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(v){var w=v===false;this.element.disabled=w;j.conditionClass(this.root,'uiTypeaheadDisabled',w);},reset:function(){this.unselect();this.setValue();!this.keepFocused&&m.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(v){this._exclusions=v;},getExclusions:function(){return this._exclusions;},setValue:function(v){this.value=this.nextQuery=v||'';m.setValue(this.element,this.value);p.update(this.element);},setHiddenValue:function(v){this.hiddenInput.value=(v||v===0)?v:'';h.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return m.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var v=this.getValue();if(v==this.value)return;if(this.selectedText&&this.selectedText!=v)this.unselect();var w=Date.now(),x=w-this.time;this.time=w;this.value=this.nextQuery=v;this.performQuery(x);},performQuery:function(v){if(this.selectedText)return;v=v||0;if(this.fetching&&v<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions,v);}else{this.data.query(this.nextQuery,false,this._exclusions,v);this.nextQuery=null;}}});e.exports=u;});
__d("ChatTypeaheadCore",["function-extensions","Class","Event","Keys","TypeaheadCore","copyProperties","emptyFunction","shield"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Class'),h=b('Event'),i=b('Keys'),j=b('TypeaheadCore'),k=b('copyProperties'),l=b('emptyFunction'),m=b('shield');function n(o){this.parent.construct(this,o);}g.extend(n,j);k(n.prototype,{init:function(o,p,q){this.parent.init(o,p,q);this.informBeginActive=false;this.informEndActive=false;this.data.subscribe('respond',function(){if(this.informBeginActive){this.informBeginActive=false;this.inform('sidebar/typeahead/active',true);}else if(this.informEndActive){this.informEndActive=false;this.inform('sidebar/typeahead/active',false);}}.bind(this));},handleTab:l,keydown:function(event){var o=h.getKeyCode(event);if(o===i.ESC){m(this.reset,this).defer();return event.kill();}return this.parent.keydown(event);},checkValue:function(){var o=this.getValue(),p=this.value;if(o==p)return;if(p&&!o){this.typeaheadActive=false;this.informEndActive=true;}else if(!p&&o){this.typeaheadActive=true;this.informBeginActive=true;this.inform('sidebar/typeahead/preActive');}this.parent.checkValue();}});e.exports=n;});
__d("ChatTypeaheadDataSource",["Class","DataSource","Env","JSLogger","MercuryParticipantTypes","OrderedFriendsList","Run","ShortProfiles","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DataSource'),i=b('Env'),j=b('JSLogger'),k=b('MercuryParticipantTypes'),l=b('OrderedFriendsList'),m=b('Run'),n=b('ShortProfiles'),o=b('copyProperties');function p(q){q=q||{};q.kanaNormalization=true;this.parent.construct(this,q);this.persistOnRefresh=q.persistOnRefresh!==false;this.showOfflineUsers=!!q.showOfflineUsers;this._jslog=j.create('chat_typeahead');this._jslog.log('created');}g.extend(p,h);o(p.prototype,{init:function(){this._jslog.log('init');this.parent.init();this._update();},bootstrap:function(){this._jslog.log('bootstrap');this.parent.bootstrap();if(this.showOfflineUsers){this._jslog.log('show_offline_users');this._jslog.log('ensured_short_profiles');if(n.hasAll()){this._update();}else{this._jslog.log('fetch_all_short_profiles');n.fetchAll();this.inform('activity',{activity:true});var q=n.subscribe('updated',function(){this.inform('activity',{activity:false});this._update();}.bind(this));if(!this.persistOnRefresh)m.onLeave(function(){n.unsubscribe(q);});}}},_update:function(){d(['AvailableList'],function(q){var r=this.value;this.dirty();var s=n.getCachedProfileIDs(),t=s.filter(function(v){var w=n.getNow(v);return w.type===k.FRIEND;});t.sort(l.compare);var u=[];t.forEach(function(v){if(v==i.user)return;var w=q.get(v);if(!this.showOfflineUsers&&w!==q.ACTIVE)return;var x=n.getNow(v),y=x.additionalName;if(x.hasOwnProperty('searchTokens'))y=y!==null?y+" "+x.searchTokens.join(" "):x.searchTokens.join(" ");u.push({uid:v,text:x.name,tokens:y,localized_text:x.name,additional_text:x.additionalName,photo:x.thumbSrc,type:x.type});}.bind(this));if(u.length)this.addEntries(u);this.value=r;if(r)this.query(r);}.bind(this));},refreshData:function(){d(['AvailableList'],function(q){q.update();}.bind(this));}});e.exports=p;});
__d("ChatSidebarHeader.react",["React","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('cx'),i=g.createClass({displayName:'ReactChatSidebarHeader',render:function(){return (g.DOM.div({className:"_55ob"},g.DOM.div({className:"_55oc"},this.props.name)));}});e.exports=i;});
__d("SplitImage.react",["React","Image.react","cx"],function(a,b,c,d,e,f){var g=b('React'),h=b('Image.react'),i=b('cx'),j=g.createClass({displayName:'SplitImage',render:function(){var k=this.props.size;return this.transferPropsTo(g.DOM.div({className:"_55lt",style:{width:k,height:k}},this.renderImages()));},renderImages:function(){if(!this.props.srcs)return null;if(!(this.props.srcs instanceof Array))return (h({src:this.props.srcs,height:this.props.size,width:this.props.size},null));switch(this.props.srcs.length){case 1:return (h({src:this.props.srcs[0],height:this.props.size,width:this.props.size},null));case 2:return this.renderTwo();default:return this.renderThree();}},renderTwo:function(){var k=Math.floor(this.props.size/2),l=-Math.floor(k/2),m=(("_55lu")+(this.props.border?' '+"_57xo":''));return (g.DOM.div(null,[g.DOM.div({className:"_55lu",style:{width:k}},h({src:this.props.srcs[0],width:this.props.size,height:this.props.size,style:{marginLeft:l}},null)),g.DOM.div({className:m,style:{width:k}},h({src:this.props.srcs[1],width:this.props.size,height:this.props.size,style:{marginLeft:l}},null))]));},renderThree:function(){var k=Math.floor(this.props.size/3*2),l=-Math.floor((this.props.size-k)/2),m=Math.floor(this.props.size/2),n=this.props.size-k,o=-Math.floor((m-n)/2),p=(("_55lu")+(this.props.border?' '+"_57pl":'')),q=(("_55lu")+(this.props.border?' '+"_57pm":''));return (g.DOM.div(null,[g.DOM.div({className:p,style:{width:k}},h({src:this.props.srcs[0],width:this.props.size,height:this.props.size,style:{marginLeft:l}},null)),g.DOM.div({className:q,style:{width:n,height:m}},h({src:this.props.srcs[1],width:m,height:m,style:{marginLeft:o}},null)),g.DOM.div({className:"_55lu",style:{width:n,height:m}},h({src:this.props.srcs[2],width:m,height:m,style:{marginLeft:o}},null))]));}});e.exports=j;});
__d("ChatSidebarItem.react",["AvailableListConstants","ChatConfig","ChatFavoriteList","ChatSidebarConstants","Image.react","Link.react","React","SplitImage.react","cx","ix"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatFavoriteList'),j=b('ChatSidebarConstants'),k=b('Image.react'),l=b('Link.react'),m=b('React'),n=b('SplitImage.react'),o=b('cx'),p=b('ix'),q=m.createClass({displayName:'ChatSidebarItem',render:function(){var r=(("_55ln")+(this.props.context?' '+"_55lo":''));return (l({className:r,href:this.props.href,onClick:this.props.onClick,rel:"ignore"},m.DOM.div({className:"_55lp"},[this.renderFavorite(),m.DOM.div({className:"_56p9"},[this.renderImage(),m.DOM.div({className:"_568w"},null)]),this.renderStatus(),m.DOM.div({className:"_55lr"},this.props.name),m.DOM.div({className:"_55ls"},this.props.context)])));},renderFavorite:function(){if(this.props.isAdded===undefined)return null;var r=null;if(this.props.litestandSidebar){r=this.props.isAdded?p('/images/litestand/bookmarks/sidebar/remove.png'):p('/images/litestand/bookmarks/sidebar/add.png');}else r=this.props.isAdded?p('/images/chat/delete.png'):p('/images/chat/add.png');var s=(("_568x")+(!this.props.showEditButton?' '+"hidden_elem":''));return (m.DOM.div({className:s,onClick:this.props.onEditClick},k({className:"_568y",src:r},null)));},renderImage:function(){var r=this.props.imageSize||j.IMAGE_SIZE;return n({size:r,srcs:this.props.images},null);},renderStatus:function(){var r=this.getStatusSrc();if(!r)return null;var s=h.get('divebar_favorite_list',0)&&i.isEditMode(),t=(("_568z")+(s?' '+"hidden_elem":''));return (m.DOM.div({className:t},[m.DOM.div({className:"_568-"},this.props.statusTime),k({className:"_568_",src:r},null)]));},getStatusSrc:function(){switch(this.props.status){case g.ACTIVE:case g.IDLE:return this.props.litestandSidebar?p('/images/litestand/sidebar/online.png'):p('/images/chat/status/online.png');case g.MOBILE:return this.props.litestandSidebar?p('/images/litestand/sidebar/pushable.png'):p('/images/chat/status/mobile.png');}return null;}});e.exports=q;});
__d("WebMessengerPermalinkConstants",["URI"],function(a,b,c,d,e,f){var g=b('URI'),h={ARCHIVED_PATH:'/messages/archived',BASE_PATH:'/messages',OTHER_PATH:'/messages/other',SPAM_PATH:'/messages/spam',COMPOSE_POSTFIX_PATH:'/new',SEARCH_POSTFIX_PATH:'/search',TID_POSTFIX_PARTIAL_PATH:'/conversation-',overriddenVanities:'(archived|other|spam|new|search|conversation-.*)',getURIPathForThreadID:function(i,j){return (j||h.BASE_PATH)+h.TID_POSTFIX_PARTIAL_PATH+g.encodeComponent(g.encodeComponent(i));},getThreadIDFromURI:function(i){var j=i.getPath().match(h.BASE_PATH+'(/[^/]*)*'+h.TID_POSTFIX_PARTIAL_PATH+'([^/]+)');if(j){var k=g.decodeComponent(g.decodeComponent(j[2]));return k;}},getURIPathForIDOrVanity:function(i,j){if(i.match('^'+h.overriddenVanities+'$'))i='.'+i;return (j||h.BASE_PATH)+'/'+i;},getUserIDOrVanity:function(i){var j=i.match(h.BASE_PATH+'.*/([^/]+)/?$'),k=j&&j[1],l=h.overriddenVanities;if(!k||k.match('^'+l+'$')){return false;}else if(k.match('^\\.'+l+'$')){return k.substr(1);}else return k;}};e.exports=h;});
__d("MercuryErrorInfo",["MercuryErrorType","tx"],function(a,b,c,d,e,f){var g=b('MercuryErrorType'),h=b('tx'),i={getMessage:function(j){var k="This message failed to send.";if(i.isConnectionError(j)){k="Unable to connect to Facebook. This message failed to send. ";}else if(j.description)k=j.description;return k;},isConnectionError:function(j){if(j&&j.type==g.TRANSPORT)return j.code===1001||j.code===1004||j.code===1006;return false;}};e.exports=i;});
__d("MercuryThreadMetadataRawRenderer",["Event","CSS","DOM","MercuryActionStatus","MercuryErrorInfo","MessagingTag","MercuryStatusTemplates","Tooltip","URI","WebMessengerPermalinkConstants","cx","tx"],function(a,b,c,d,e,f){var g=b('Event'),h=b('CSS'),i=b('DOM'),j=b('MercuryActionStatus'),k=b('MercuryErrorInfo'),l=b('MessagingTag'),m=b('MercuryStatusTemplates'),n=b('Tooltip'),o=b('URI'),p=b('WebMessengerPermalinkConstants'),q=b('cx'),r=b('tx'),s={renderParticipantListWithNoThreadName:function(u,v,w,x,y,z){var aa={callback:true,check_length:true,show_unread_count:true};z=z||{};var ba={};for(var ca in z)if(aa[ca]){ba[ca]=z[ca];delete z[ca];}var da=w.map(function(ia){return x[ia];}),ea=this.renderRawParticipantList(u,da,w.length,z);ea=this.renderRawTitleWithUnreadCount(ea,ba.show_unread_count?v.unread_count:0);var fa=z.abbr_mode,ga={};for(var ha in z)ga[ha]=z[ha];ga.abbr_mode=true;y.forEach(function(ia){var ja=y.length>1?this._cloneIfDOMElement(ea):ea;i.setContent(ia,ja);if(ba.check_length&&!fa&&ia.scrollWidth>ia.clientWidth){var ka=this.renderRawParticipantList(u,da,w.length,ga),la=this.renderRawTitleWithUnreadCount(ka,ba.show_unread_count?v.unread_count:0);i.setContent(ia,la);}}.bind(this));ba.callback&&ba.callback(ea);},renderRawParticipantList:function(u,v,w,x){var y={abbr_mode:true,last_separator_uses_and:true,names_renderer:true};x=x||{};var z=null;if(x.names_renderer){z=x.names_renderer(v);}else z=v.map(function(ca){return ca.name;});var aa=null;if(z.length===0){if(!u){aa="New Message";}else aa="No Participants";}else if(z.length==1){aa=z[0];}else if(z.length==2){var ba={participant1:z[0],participant2:z[1]};if(x.last_separator_uses_and){aa=r._("{participant1} and {participant2}",ba);}else aa=r._("{participant1}, {participant2}",ba);}else if(x.last_separator_uses_and){if(x.abbr_mode){aa=r._("{participant1} and {others_link}",{participant1:z[0],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-1})});}else if(z.length==3){aa=r._("{participant1}, {participant2} and {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2} and {others_link}",{participant1:z[0],participant2:z[1],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-2})});}else if(z.length==3){aa=r._("{participant1}, {participant2}, {participant3}",{participant1:z[0],participant2:z[1],participant3:z[2]});}else aa=r._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:z[0],participant2:z[1],participant3:z[2],others_link:this.renderRawParticipantCount(u,{render_subset:true,count:w-3})});if(Array.isArray(aa))aa=i.create('span',{},aa);return aa;},renderRawTitleWithUnreadCount:function(u,v){var w=u;if(v&&v>1)w=i.create('span',{},r._("{conversation_title} ({unread_count})",{conversation_title:u,unread_count:v}));return w;},renderRawParticipantCount:function(u,v){var w=v.render_subset,x;if(!w){x=v.count>1?r._("{num} people",{num:v.count}):"1 person";}else x=v.count>1?r._("{others_count} others",{others_count:v.count}):"1 other";return x;},renderShortNames:function(u){if(u.length==1)return [u[0].name];return u.map(function(v){return v.short_name;});},getUserCanonicalTitanURL:function(u,v,w){var x=new o().setSubdomain('www'),y=u.substr(u.indexOf(':')+1);x.setPath(t(w)+'/'+y);v&&v(x.toString());return x.toString();},getTitanURLWithServerID:function(u,v,w){var x=new o().setSubdomain('www');x.setPath(p.getURIPathForThreadID(u,t(w)));v&&v(x.toString());return x.toString();},renderUserCanonicalTitanLink:function(u,v,w,x){var y=this.getUserCanonicalTitanURL(u,null,x);v.setAttribute('href',y);w&&w();},renderTitanLinkWithServerID:function(u,v,w,x){var y=this.getTitanURLWithServerID(u,null,x);v.setAttribute('href',y);w&&w();},renderStatusIndicator:function(u,v,w){var x;if(u==j.RESENDING){x=this.renderResendIndicator();}else if(u!==undefined&&u!=j.UNSENT&&u!=j.UNCONFIRMED&&u!=j.SUCCESS)x=this.renderErrorIndicator(v,w);return x;},renderResendIndicator:function(){return m[':fb:mercury:resend-indicator'].render();},renderErrorIndicator:function(u,v){if(!u)return null;var w=m[':fb:mercury:error-indicator'].render(),x=u.is_transient,y=k.getMessage(u);if(x)if(k.isConnectionError(u)){y=r._("{message} Check your network connection or click to try again.",{message:y});}else y=r._("{message} Click to send again.",{message:y});n.set(w,y,'above','center');if(v&&x){g.listen(w,'click',v);w.setAttribute('tabindex','0');h.addClass(w,"_55q-");}return w;},_cloneIfDOMElement:function(u){if(u.cloneNode){return u.cloneNode();}else return u;}};function t(u){var v=p.BASE_PATH;if(u&&u!=l.INBOX)v+='/'+u;return v;}e.exports=s;});
__d("ChatSidebarThread.react",["ChatSidebarItem.react","WebMessengerPermalinkConstants","React","MercuryThreadMetadataRawRenderer"],function(a,b,c,d,e,f){var g=b('ChatSidebarItem.react'),h=b('WebMessengerPermalinkConstants'),i=b('React'),j=b('MercuryThreadMetadataRawRenderer'),k=i.createClass({displayName:'ChatSidebarThread',render:function(){var n=this.props.name,o=l(this.props.threadID,this.props.participants),p=n?o:undefined,q=h.getURIPathForThreadID(this.props.threadID),r=m(this.props.image,this.props.participants),s=n?n:o;return (g({context:p,href:{url:q},imageSize:this.props.imageSize,images:r,litestandSidebar:this.props.litestandSidebar,name:s,status:this.props.status},null));}});function l(n,o){return j.renderRawParticipantList(n,o,o.length,{names_renderer:j.renderShortNames});}function m(n,o){if(n)return n;return o.map(function(p){return p.image_src;});}e.exports=k;});
__d("ChatSidebarUser.react",["ChatFavoriteList","WebMessengerPermalinkConstants","ChatConfig","React","ChatSidebarItem.react"],function(a,b,c,d,e,f){var g=b('ChatFavoriteList'),h=b('WebMessengerPermalinkConstants'),i=b('ChatConfig'),j=b('React'),k=b('ChatSidebarItem.react'),l=j.createClass({displayName:'ChatSidebarUser',render:function(){var m=h.getURIPathForIDOrVanity(this.props.userID),n=g.isFavored(this.props.userID),o=function(){g.toggleID(this.props.userID);}.bind(this),p=i.get('divebar_favorite_list',0)?n:undefined;return (k({href:{url:m},imageSize:this.props.imageSize,images:this.props.image,litestandSidebar:this.props.litestandSidebar,isAdded:p,showEditButton:g.isEditMode(),name:this.props.name,onEditClick:o,status:this.props.status,statusTime:this.props.statusTime},null));}});e.exports=l;});
__d("ChatTypeaheadRenderer",["AvailableListConstants","ChatConfig","ChatSidebarConstants","ChatSidebarHeader.react","ChatSidebarThread.react","ChatSidebarUser.react","ChatTypeaheadConstants","DOM","LastMobileActiveTimes","MercuryParticipants","PresenceStatus","React"],function(a,b,c,d,e,f){var g=b('AvailableListConstants'),h=b('ChatConfig'),i=b('ChatSidebarConstants'),j=b('ChatSidebarHeader.react'),k=b('ChatSidebarThread.react'),l=b('ChatSidebarUser.react'),m=b('ChatTypeaheadConstants'),n=b('DOM'),o=b('LastMobileActiveTimes'),p=b('MercuryParticipants'),q=b('PresenceStatus'),r=b('React'),s={};function t(y,z){if(!(y in s))s[y]=n.create('li');r.renderComponent(z,s[y]);return s[y];}function u(y){return t(y.text,j({name:y.text},null));}function v(y){var z=y.mercury_thread.participants.map(function(ba){return p.getUserID(ba);}),aa=h.get('litestand',0)?i.LITESTAND_IMAGE_SIZE:i.IMAGE_SIZE;return t(y.uid,k({image:y.mercury_thread.image_src,imageSize:aa,litestandSidebar:h.get('litestand',0),name:y.mercury_thread.name,participants:y.participants_to_render,status:q.getGroup(z),threadID:y.uid},null));}function w(y){var z=q.get(y.uid),aa=(z===g.MOBILE)?o.getShortDisplay(y.uid):null,ba=h.get('litestand',0)?i.LITESTAND_IMAGE_SIZE:i.IMAGE_SIZE;return t(y.uid,l({image:y.photo,imageSize:ba,litestandSidebar:h.get('litestand',0),name:y.text,status:z,statusTime:aa,userID:y.uid},null));}function x(y,z){if(y.type===m.HEADER_TYPE)return u(y);if(y.type==m.THREAD_TYPE)return v(y);return w(y);}e.exports=x;});
__d("Badge",["DOM","cx"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('cx'),i=function(j){var k;switch(j){case 'xsmall':k="_56_g _58to";break;case 'small':k="_56_g _56_h";break;case 'medium':k="_56_g _56_j";break;case 'large':k="_56_g _56_k";break;case 'xlarge':k="_56_g _57s-";break;}if(k)return g.create('span',{className:k});return null;};e.exports=i;});
__d("BasicTypeaheadRenderer",["Badge","DOM"],function(a,b,c,d,e,f){var g=b('Badge'),h=b('DOM');function i(j,k){var l=[];if(j.icon)l.push(h.create('img',{alt:'',src:j.icon}));if(j.text){var m=[j.text];if(j.verified)m.push(g('xsmall'));l.push(h.create('span',{className:'text'},m));}if(j.subtext)l.push(h.create('span',{className:'subtext'},[j.subtext]));var n=h.create('li',{className:j.type||''},l);if(j.text)n.setAttribute('aria-label',j.text);return n;}i.className='basic';e.exports=i;});
__d("TypeaheadView",["Event","ArbiterMixin","BasicTypeaheadRenderer","CSS","DOM","Parent","$","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('Event'),h=b('ArbiterMixin'),i=b('BasicTypeaheadRenderer'),j=b('CSS'),k=b('DOM'),l=b('Parent'),m=b('$'),n=b('copyProperties'),o=b('emptyFunction');function p(q,r){this.element=this.content=m(q);this.showBadges=r.showBadges;n(this,r);}n(p.prototype,h,{events:['highlight','render','reset','select','beforeRender','next','prev'],renderer:i,autoSelect:false,ignoreMouseover:false,init:function(){this.init=o;this.initializeEvents();this.reset();},initializeEvents:function(){g.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},setTypeahead:function(q){this.typeahead=q;},setAccessibilityControlElement:function(q){this.accessibilityElement=q;},getElement:function(){return this.element;},mouseup:function(event){if(event.button!=2){this.select(true);event.kill();}},mouseover:function(event){if(this.ignoreMouseover){this.ignoreMouseover=false;return;}if(this.visible)this.highlight(this.getIndex(event));},reset:function(q){if(!q)this.disableAutoSelect=false;this.justRendered=false;this.justShown=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(l.byTag(event.getTarget(),'li'));},getSelection:function(){var q=this.results[this.index]||null;return this.visible?q:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){j.show(this.element);if(this.results&&this.results.length)if(this.autoSelect&&this.accessibilityElement&&this.selected)this.accessibilityElement.setAttribute('aria-activedescendant',k.getID(this.selected));this.accessibilityElement&&this.accessibilityElement.setAttribute('aria-expanded','true');this.visible=true;return this;},hide:function(){j.hide(this.element);if(this.accessibilityElement){this.accessibilityElement.setAttribute('aria-expanded','false');this.accessibilityElement.removeAttribute('aria-activedescendant');}this.visible=false;return this;},render:function(q,r,s){this.value=q;if(!r.length){this.accessibilityElement&&this.accessibilityElement.removeAttribute('aria-activedescendant');this.reset(true);return;}this.justRendered=true;if(!this.results.length)this.justShown=true;var t={results:r,value:q};this.inform('beforeRender',t);r=t.results;var u=this.getDefaultIndex(r);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var v=this.results[this.index];for(var w=0,x=r.length;w<x;++w)if(v.uid==r[w].uid){u=w;break;}}this.results=r;k.setContent(this.content,this.buildResults(r));this.items=this.getItems();this.highlight(u,false);this.inform('render',r);},getItems:function(){return k.scry(this.content,'li');},buildResults:function(q){var r,s=null;if(typeof this.renderer=='function'){r=this.renderer;s=this.renderer.className||'';}else{r=a.TypeaheadRenderers[this.renderer];s=this.renderer;}r=r.bind(this);var t=this.showBadges,u=q.map(function(w,x){if(!t)w.verified=null;var y=w.node||r(w,x);y.setAttribute('role','option');return y;}),v=k.create('ul',{className:s,id:'typeahead_list_'+(this.typeahead?k.getID(this.typeahead):k.getID(this.element))},u);v.setAttribute('role','listbox');return v;},getDefaultIndex:function(q){var r=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!r?-1:0;},next:function(){this.highlight(this.index+1);this.inform('next',this.selected);},prev:function(){this.highlight(this.index-1);this.inform('prev',this.selected);},getItemText:function(q){var r='';if(q){r=q.getAttribute('aria-label');if(!r){r=k.getText(q);q.setAttribute('aria-label',r);}}return r;},setIsViewingSelectedItems:function(q){this.viewingSelected=q;return this;},getIsViewingSelectedItems:function(){return this.viewingSelected;},highlight:function(q,r){var s=true;if(this.selected){j.removeClass(this.selected,'selected');this.selected.setAttribute('aria-selected','false');}if(q>this.items.length-1){q=-1;}else if(q<-1)q=this.items.length-1;if(q>=0&&q<this.items.length){if(this.selected&&this.getItemText(this.items[q])===this.getItemText(this.selected))s=false;this.selected=this.items[q];j.addClass(this.selected,'selected');this.selected.setAttribute('aria-selected','true');if(this.accessibilityElement)(function(){this.accessibilityElement.setAttribute('aria-activedescendant',k.getID(this.selected));}).bind(this).defer();}else this.accessibilityElement&&this.accessibilityElement.removeAttribute('aria-activedescendant');this.index=q;this.disableAutoSelect=(q==-1);var t=(q!==-1),u=this.getItemText(this.selected);if(q!==-1&&this.isVisible()&&u&&this.autoSelect)if(this.justShown){this.justRendered=false;this.justShown=false;t=false;}else if(s&&this.justRendered){this.justRendered=false;t=false;}if(r!==false)this.inform('highlight',{index:q,selected:this.results[q],element:this.selected});},select:function(q){var r=this.index,s=this.results[r],t=this.element.getAttribute('id');if(s){this.inform('select',{index:r,clicked:!!q,selected:s,id:t,query:this.value});this.inform('afterSelect');}}});e.exports=p;});
__d("BucketedTypeaheadView",["Class","DOM","tx","TypeaheadView","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DOM'),i=b('tx'),j=b('TypeaheadView'),k=b('copyProperties');function l(m,n){this.parent.construct(this,m,n);}g.extend(l,j);k(l.prototype,{render:function(m,n,o){n=this.buildBuckets(m,n);return this.parent.render(m,n,o);},highlight:function(m,n){if(m==-1&&this.index!==0)m=this.index;while(m>=0&&m<this.items.length&&!this.isHighlightable(this.results[m]))m=m+1;this.parent.highlight(m,n);},buildBuckets:function(m,n){if(!this.typeObjects||!n||!n.length)return n;var o=[],p={};for(var q=0;q<n.length;++q){var r=n[q],s=r.render_type||r.type;if(!p.hasOwnProperty(s)){p[s]=o.length;o.push([this.buildBucketHeader(s)]);}r.classNames=s;r.groupIndex=p[s];r.indexInGroup=o[r.groupIndex].length-1;o[r.groupIndex].push(r);}for(s in this.typeObjects)if(!p.hasOwnProperty(s)&&this.typeObjects[s].show_always){p[s]=o.length;o.push([this.buildBucketHeader(s)]);r=this.buildNoResultsEntry();r.classNames=r.type;r.groupIndex=p[s];r.indexInGroup=o[r.groupIndex].length-1;o[r.groupIndex].push(r);}var t=[];if(this.typeObjectsOrder){for(var u=0;u<this.typeObjectsOrder.length;++u){var v=this.typeObjectsOrder[u];if(p.hasOwnProperty(v))t=t.concat(o[p[v]]);}}else for(var w=0;w<o.length;++w)t=t.concat(o[w]);return t;},buildNoResultsEntry:function(){return {uid:'disabled_result',type:'disabled_result',text:"No Results"};},buildBucketHeader:function(m){var n=this.typeObjects[m];if(n.markup){n.text=n.markup;delete n.markup;}return this.typeObjects[m];},buildResults:function(m){var n=this.parent.buildResults(m);if(this.typeObjects){return h.create('div',{className:'bucketed'},[n]);}else return n;},isHighlightable:function(m){return m.type!='header'&&m.type!='disabled_result';},select:function(m){var n=this.results[this.index];if(n&&this.isHighlightable(n))this.parent.select(m);},normalizeIndex:function(m){var n=this.results.length;if(n===0){return -1;}else if(m<-1){return (m%n)+n+1;}else if(m>=n){return (m%n)-1;}else return m;},getDefaultIndex:function(m){var n=(this.autoSelect&&!this.disableAutoSelect);if(this.index<0&&!n)return -1;if(m.length===0)return -1;var o=0;while(!this.isHighlightable(m)&&o<m.length)o++;return o;},prev:function(){var m=this.results[this.normalizeIndex(this.index-1)];while(m&&!this.isHighlightable(m)){this.index=this.normalizeIndex(this.index-1);m=this.results[this.normalizeIndex(this.index-1)];}return this.parent.prev();},next:function(){var m=this.results[this.normalizeIndex(this.index+1)];while(m&&!this.isHighlightable(m)){this.index=this.normalizeIndex(this.index+1);m=this.results[this.normalizeIndex(this.index+1)];}return this.parent.next();}});e.exports=l;});
__d("ChatTypeaheadView",["BucketedTypeaheadView","ChatConfig","Class","ChatTypeaheadConstants","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('ChatConfig'),i=b('Class'),j=b('ChatTypeaheadConstants'),k=b('copyProperties'),l=b('tx'),m=h.get('divebar_typeahead_group_fof',0);function n(o,p){this.parent.construct(this,o,p);this.typeObjects={};this.typeObjectsOrder=[];this.typeObjects[j.NON_FRIEND_TYPE]={uid:j.NON_FRIEND_TYPE,type:j.HEADER_TYPE,text:"FRIENDS OF FRIENDS"};this.typeObjectsOrder.push(j.NON_FRIEND_TYPE);this.typeObjects[j.THREAD_TYPE]={uid:j.THREAD_TYPE,type:j.HEADER_TYPE,text:"GROUP CONVERSATIONS"};this.typeObjectsOrder.push(j.THREAD_TYPE);this.typeObjects[j.FRIEND_TYPE]={disabled:true,uid:j.FRIEND_TYPE,type:j.HEADER_TYPE,text:"FRIENDS"};this.typeObjectsOrder.push(j.FRIEND_TYPE);}i.extend(n,g);k(n.prototype,{buildBuckets:function(o,p){if(m)p=p.reverse();p=this.parent.buildBuckets(o,p);if(!m)p=p.filter(function(q){return q&&!q.disabled;});return p;},getDefaultIndex:function(o){if(!m)return this.parent.getDefaultIndex(o);if(o.length===0)return -1;var p=o.length-1;while(!this.isHighlightable(o[p])&&p>=0)p--;return p;}});e.exports=n;});
__d("legacy:ChatTypeaheadBehavior",["ChatTypeaheadBehavior"],function(a,b,c,d){var e=b('ChatTypeaheadBehavior');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.chatTypeahead=function(f){f.enableBehavior(e);};},3);
__d("TypeaheadFacepile",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(){}h.render=function(i){var j=[g.create('span',{className:'splitpic leftpic'},[g.create('img',{alt:'',src:i[0]})]),g.create('span',{className:'splitpic'+(i[2]?' toppic':'')},[g.create('img',{alt:'',src:i[1]})])];if(i[2])j.push(g.create('span',{className:'splitpic bottompic'},[g.create('img',{alt:'',src:i[2]})]));return g.create('span',{className:'splitpics clearfix'},j);};e.exports=h;});
__d("ModalMask",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=null,i=0,j={show:function(){i++;if(!h){h=g.create('div',{id:'modalMaskOverlay'});g.appendContent(document.body,h);}},hide:function(){if(i){i--;if(!i&&h){g.remove(h);h=null;}}}};e.exports=j;});
__d("RequiredFormListener",["Event","Input"],function(a,b,c,d,e,f){var g=b('Event'),h=b('Input');g.listen(document.documentElement,'submit',function(i){var j=i.getTarget().getElementsByTagName('*');for(var k=0;k<j.length;k++)if(j[k].getAttribute('required')&&h.isEmpty(j[k])){j[k].focus();return false;}},g.Priority.URGENT);});
__d("MercuryEmoji",["MercuryConfig","Emoji","Emote"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('Emoji'),i=b('Emote'),j={htmlEmojiAndEmote:function(k,l){if(g.MessagingDisplayEmojiGK){return h.htmlEmojiAndEmote(k,l);}else return i.htmlEmote(k,l);}};e.exports=j;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","MercuryConfig","MercuryActionTypeConstants","MercuryGlobalActionType","MercuryPayloadSource","MessagingReliabilityLogger","MessagingEvent","MessagingTag","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryConfig'),j=b('MercuryActionTypeConstants'),k=b('MercuryGlobalActionType'),l=b('MercuryPayloadSource'),m=b('MessagingReliabilityLogger'),n=b('MessagingEvent'),o=b('MessagingTag'),p=b('MercuryParticipants'),q=b('PresenceUtil'),r=b('MercuryServerRequests').get(),s=b('MercuryThreadInformer').get(),t=b('copyProperties');function u(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj||!ka.obj.message){m.addEntry('channel_receive','invalid_data');return;}var la=ka.obj.message,ma={author:la.mercury_author_id,author_email:la.mercury_author_email,body:la.body,subject:la.subject,has_attachment:la.has_attachment,attachments:la.attachments,html_body:la.html_body,thread_id:la.tid,message_id:la.mid,coordinates:la.mercury_coordinates,spoof_warning:la.mercury_spoof_warning,source:la.mercury_source,source_tags:la.mercury_source_tags,threading_id:la.threading_id,timestamp:la.timestamp,timestamp_absolute:la.timestamp_absolute,timestamp_relative:la.timestamp_relative,timestamp_time_passed:la.timestamp_time_passed,action_type:j.USER_GENERATED_MESSAGE,is_unread:la.is_unread,action_id:la.action_id,is_forward:false,forward_count:la.forward_count||la.forward,forward_message_ids:la.forward_msg_ids,location_text:la.location_text,folder:ka.obj.folder},na=[t({},ma)];na=na.concat(la.forward_actions||[]);var oa=l.CLIENT_CHANNEL_MESSAGE;r.handleUpdateWaitForThread({actions:na,payload_source:oa},la.tid);if(!la.is_unread&&la.mercury_author_id===p.user){var pa={};pa[la.tid]=ka.obj.folder;v(h.getArbiterType('messaging'),{obj:{event:n.READ,tids:[la.tid],folder_info:pa,timestamp:la.timestamp}});}m.addEntry('channel_receive','success',[ma.thread_id,ma.message_id,q.getSessionID()]);}function v(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj||!ka.obj.tids)return;var la=[],ma=ka.obj.event==n.READ;ka.obj.tids.forEach(function(na){la.push({action_type:j.CHANGE_READ_STATUS,action_id:null,thread_id:na,mark_as_read:ma,timestamp:ka.obj.timestamp||0,folder:ka.obj.folder_info[na]});});r.handleUpdate({actions:la,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function w(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj||!ka.obj.tids)return;var la=[];ka.obj.tids.forEach(function(ma){la.push({action_type:j.DELETE_THREAD,action_id:null,thread_id:ma});});r.handleUpdate({actions:la,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function x(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj||!ka.obj.tids||!ka.obj.mids)return;var la=ka.obj.tids[0],ma={action_type:j.DELETE_MESSAGES,action_id:null,thread_id:la,message_ids:ka.obj.mids};r.handleUpdate({actions:[ma],threads:[ka.obj.updated_thread],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function y(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj||!ka.obj.folder)return;var la={action_type:k.MARK_ALL_READ,action_id:ka.obj.action_id,folder:ka.obj.folder};r.handleUpdate({global_actions:[la]});}function z(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj.tids)return;var la=l.CLIENT_CHANNEL_MESSAGE;ka.obj.tids.forEach(function(ma){var na={action_type:j.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ma,archived:ka.obj.state};r.handleUpdateWaitForThread({actions:[t({},na)],payload_source:la},ma);});}function aa(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj.tids)return;var la=l.CLIENT_CHANNEL_MESSAGE,ma;ka.obj.tids.forEach(function(na){if(ka.obj.event==n.TAG){ma=ka.obj.tag;}else ma=ka.obj.marked_as_spam?o.SPAM:o.INBOX;var oa={action_type:j.CHANGE_FOLDER,action_id:null,thread_id:na,new_folder:ma};r.handleUpdateWaitForThread({actions:[t({},oa)],payload_source:la},na);});}function ba(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj.tag)return;switch(ka.obj.tag){case o.ACTION_ARCHIVED:z(ja,ka);break;case o.INBOX:case o.OTHER:aa(ja,ka);break;}}function ca(ja,ka){if(ja!=h.getArbiterType('inbox')||!ka.obj||!ka.obj.seen_timestamp)return;r.handleUpdate({message_counts:[{seen_timestamp:ka.obj.seen_timestamp,folder:o.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:o.INBOX}],payload_source:l.CLIENT_CHANNEL_MESSAGE});}function da(ja,ka){if(ja!=h.getArbiterType('mercury')||!ka.obj)return;s.synchronizeInforms(function(){var la=ka.obj,ma=[];(la.actions||[]).forEach(function(na){var oa=j.USER_GENERATED_MESSAGE;if(na.action_type==j.LOG_MESSAGE){var pa=l.CLIENT_CHANNEL_MESSAGE;r.handleUpdateWaitForThread({actions:[t({},na)],payload_source:pa},na.thread_id);}else if(na.action_type!=oa)ma.push(na);});la.actions=ma;la.payload_source=l.CLIENT_CHANNEL_MESSAGE;r.handleUpdate(la);});}function ea(ja,ka){r.handleRoger(ka.obj);}function fa(ja,ka){if(ja!=h.getArbiterType('messaging')||!ka.obj||ka.obj.mute_settings===undefined||!ka.obj.thread_id)return;var la=j.CHANGE_MUTE_SETTINGS,ma=[{action_type:la,action_id:null,thread_id:ka.obj.thread_id,mute_settings:ka.obj.mute_settings}];r.handleUpdate({actions:ma,payload_source:l.CLIENT_CHANNEL_MESSAGE});}function ga(ja,ka){switch(ka.obj.event){case n.DELIVER:u(ja,ka);break;case n.READ:case n.UNREAD:v(ja,ka);break;case n.READ_ALL:y(ja,ka);break;case n.DELETE:w(ja,ka);break;case n.DELETE_MESSAGES:x(ja,ka);break;case n.TAG:ba(ja,ka);break;case n.REPORT_SPAM:aa(ja,ka);break;case n.READ_RECEIPT:ea(ja,ka);break;case n.CHANGE_MUTE_SETTINGS:if(i.MuteThreadsOnDesktopGK)fa(ja,ka);break;}}var ha=[],ia={turnOn:function(){if(!ha.length){var ja={mercury:da,messaging:ga,inbox:ca};for(var ka in ja)ha.push(g.subscribe(h.getArbiterType(ka),ja[ka]));}},turnOff:function(){if(ha.length){ha.forEach(g.unsubscribe);ha=[];}}};ia.turnOn();e.exports=ia;});
__d("MercuryRoger",["ArbiterMixin","MercuryActionStatus","MercuryServerRequests","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryActionStatus'),i=b('MercuryServerRequests').get(),j=b('copyProperties'),k={},l={getSeenBy:function(m,n){if(!m)return [];var o=[],p=k[m.thread_id],q=h.SUCCESS;for(var r in p)if(p[r]>m.timestamp&&(m.status===undefined||m.status===q)&&(!n||r!=m.author))o.push(r);return o;},getSeenTimestamp:function(m,n){var o=k[m];return o?o[n]:null;}};j(l,g);i.subscribe('update-roger',function(m,n){for(var o in n){if(!k[o])k[o]={};for(var p in n[o]){var q=k[o][p],r=n[o][p];if(!q||r>q)k[o][p]=r;}}if(n)l.inform('state-changed',n);});e.exports=l;});
__d("MercuryDelayedRoger",["ArbiterMixin","LiveTimer","MercuryActionStatus","MercuryConfig","MercuryMessages","MercuryRoger","MercuryThreadInformer","MercuryThreads","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('LiveTimer'),i=b('MercuryActionStatus'),j=b('MercuryConfig'),k=b('MercuryMessages').get(),l=b('MercuryRoger'),m=b('MercuryThreadInformer').get(),n=b('MercuryThreads').get(),o=b('copyProperties'),p=b('setTimeoutAcrossTransitions'),q={},r={},s=j['roger.seen_delay'],t=o({getSeenBy:function(x,y){if(r[x])return [];if(!q[x]){var z=n.getThreadMetaNow(x);if(z)q[x]={thread_id:x,author:z.participants[0],timestamp:z.timestamp};}return l.getSeenBy(q[x],y);}},g);function u(x){var y=false;k.getThreadMessagesRange(x,0,1,function(z){var aa=z[0];if(!aa)return;var ba=aa.timestamp;if(aa.action_id||aa.status==i.SUCCESS)ba-=h.getServerTimeOffset();var ca=t.getSeenBy(x);if(r[x]){clearTimeout(r[x]);delete r[x];}var da=ba+s,ea=da-Date.now();if(ea>0)r[x]=p(function(){delete r[x];v(x);},ea);q[x]=aa;var fa=t.getSeenBy(x);if(ca.length||fa.length)y=true;});return y;}function v(x){var y={};y[x]=true;t.inform('state-changed',y);}function w(event,x){var y={};for(var z in x)if(u(z))y[z]=true;for(var aa in y){t.inform('state-changed',y);break;}}l.subscribe('state-changed',function(x,y){for(var z in y)!r[z]&&v(z);});m.subscribe('messages-received',w);m.subscribe('messages-reordered',w);m.subscribe('messages-updated',w);e.exports=t;});
__d("MercuryUnreadState",["Arbiter","MercuryFolders","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercuryGlobalActionType","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","arrayContains","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('MercuryFolders'),i=b('JSLogger'),j=b('KeyedCallbackManager'),k=b('MercuryActionTypeConstants'),l=b('MercuryGlobalActionType'),m=b('MercurySingletonMixin'),n=b('MercuryThreadlistConstants'),o=b('MessagingTag'),p=b('MercuryServerRequests'),q=b('MercuryThreadInformer'),r=b('MercuryThreads'),s=b('arrayContains'),t=b('copyProperties'),u=b('createObjectFrom'),v=(h.getSupportedFolders()||[]).filter(function(ma){return ma!=o.ACTION_ARCHIVED;}),w='unread_thread_hash',x='unseen_thread_list',y=n.MAX_UNREAD_COUNT,z=i.create('mercury_unread_state');function aa(ma){this._fbid=ma;this._serverRequests=p.getForFBID(this._fbid);this._threadInformer=q.getForFBID(this._fbid);this._threads=r.getForFBID(this._fbid);this._allReadTimestamp={};this._threadReadTimestamp={};this._initialUnreadCount={};this._maxCount={};this._unreadResources={};v.forEach(function(na){this._initialUnreadCount[na]=0;this._maxCount[na]=false;this._unreadResources[na]=new j();}.bind(this));this._serverRequests.subscribe('update-unread',function(na,oa){fa(this,oa);var pa=oa.global_actions||[];for(var qa=0;qa<pa.length;qa++){var ra=pa[qa];if(ra.action_type==l.MARK_ALL_READ)ia(this,ra.folder,ra.timestamp);}}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(na,oa){ka(this,oa);}.bind(this));}t(aa.prototype,{getUnreadCount:function(ma){if(this.exceedsMaxCount(ma)){z.error('unguarded_unread_count_fetch',{});return 0;}return ea(this,ma);},exceedsMaxCount:function(ma){return this._maxCount[ma]||(ea(this,ma)>y);},markFolderAsRead:function(ma){if(this._maxCount[ma]||ea(this,ma)>0)this._serverRequests.markFolderAsRead(ma);}});t(aa,m);function ba(ma,na,oa){ma._unreadResources[na].setResource(w,oa);ma._unreadResources[na].setResource(x,Object.keys(oa));}function ca(ma,na,oa){var pa=ma._unreadResources[na].executeOrEnqueue(w,oa),qa=ma._unreadResources[na].getUnavailableResources(pa);if(qa.length)ma._serverRequests.fetchUnreadThreadIDs(na);}function da(ma,na){return ma._unreadResources[na].getResource(w);}function ea(ma,na){var oa=ma._unreadResources[na].getResource(x);if(oa){return oa.length;}else return ma._initialUnreadCount[na];}function fa(ma,na){var oa;(na.unread_thread_ids||[]).forEach(function(pa){oa=pa.folder;if(!la(oa))return;var qa=ja(ma,pa.thread_ids);ba(ma,oa,u(qa,true));if(qa.length>y)ma._maxCount[oa]=true;ma._threadInformer.updatedUnreadState();});(na.message_counts||[]).forEach(function(pa){if(pa.unread_count===undefined)return;oa=pa.folder;if(pa.unread_count>y){ma._maxCount[oa]=true;ba(ma,oa,{});ma._threadInformer.updatedUnreadState();}else{ma._initialUnreadCount[oa]=pa.unread_count;if(ma._initialUnreadCount[oa]===0)ba(ma,oa,{});ma._threadInformer.updatedUnreadState();}});(na.actions||[]).forEach(function(pa){if(pa.is_forward)return;var qa=k,ra=pa.thread_id?pa.thread_id:pa.server_thread_id;if(pa.action_type==qa.DELETE_THREAD){v.forEach(function(ta){ha(ma,ta,ra);});}else if(pa.action_type==qa.CHANGE_ARCHIVED_STATUS||pa.action_type==qa.CHANGE_FOLDER){var sa=ma._threads.getThreadMetaNow(pa.thread_id);oa=h.getFromMeta(sa);if(la(oa)&&sa.unread_count>0)ga(ma,oa,ra);v.forEach(function(ta){if(ta!=oa)ha(ma,ta,ra);});}else{oa=pa.folder;if(!la(oa))return;if(pa.action_type==qa.CHANGE_READ_STATUS){if(pa.mark_as_read){ha(ma,oa,ra,pa.timestamp);}else ga(ma,oa,ra,pa.timestamp);}else if(pa.action_type==qa.USER_GENERATED_MESSAGE||pa.action_type==qa.LOG_MESSAGE)if(pa.is_unread)ga(ma,oa,ra,pa.timestamp);}});}function ga(ma,na,oa,pa){if(ma._maxCount[na])return;ca(ma,na,function(qa){var ra=ma._allReadTimestamp[na]||0,sa=ma._threadReadTimestamp[oa]||0,ta=pa||Number.POSITIVE_INFINITY;if(ta>=ra&&ta>=sa&&!qa[oa]){qa[oa]=pa||0;ba(ma,na,qa);ma._threadInformer.updatedUnreadState();}});}function ha(ma,na,oa,pa){if(ma._maxCount[na])return;ca(ma,na,function(qa){if(pa){var ra=ma._threadReadTimestamp[oa];if(!ra||ra<pa)ma._threadReadTimestamp[oa]=pa;}var sa=qa[oa];if(pa&&typeof sa=='number'&&pa<sa)return;if(oa in qa){delete qa[oa];ba(ma,na,qa);ma._threadInformer.updatedUnreadState();}});}function ia(ma,na,oa){ma._maxCount[na]=false;ba(ma,na,{});ma._allReadTimestamp[na]=Math.max(ma._allReadTimestamp[na]||0,oa||0);ma._threadInformer.updatedUnreadState();}function ja(ma,na){return na.map(ma._serverRequests.convertThreadIDIfAvailable.bind(ma._serverRequests));}function ka(ma,na){v.forEach(function(oa){var pa=da(ma,oa);if(!pa)return;for(var qa in na){var ra=na[qa];if(pa[qa]){pa[ra]=pa[qa];delete pa[qa];}}ba(ma,oa,pa);});}function la(ma){return s(v,ma);}g.subscribe(i.DUMP_EVENT,function(ma,na){na.messaging=na.messaging||{};na.messaging.unread={};na.messaging.unread_max_count={};var oa=aa._getInstances();for(var pa in oa){na.messaging.unread[pa]={};na.messaging.unread_max_count[pa]={};v.forEach(function(qa){na.messaging.unread[pa][qa]=t({},da(oa[pa],qa));na.messaging.unread_max_count[pa][qa]=oa[pa]._maxCount[qa];});}});e.exports=aa;});
__d("MercuryUnseenState",["Arbiter","TimestampConverter","JSLogger","KeyedCallbackManager","MercuryActionTypeConstants","MercurySingletonMixin","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","MercuryThreadInformer","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('TimestampConverter'),i=b('JSLogger'),j=b('KeyedCallbackManager'),k=b('MercuryActionTypeConstants'),l=b('MercurySingletonMixin'),m=b('MercuryThreadlistConstants'),n=b('MessagingTag'),o=b('MercuryServerRequests'),p=b('MercuryThreadInformer'),q=b('copyProperties'),r=b('createObjectFrom'),s=m.MAX_UNSEEN_COUNT,t='unseen_thread_hash',u='unseen_thread_list',v=i.create('mercury_unseen_state');function w(ja){this._fbid=ja;this._serverRequests=o.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=0;this._lastSeenTimestamp=0;this._maxCount=false;this._unseenResources=new j();this._serverRequests.subscribe('update-unseen',function(ka,la){ba(this,la);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(ka,la){ha(this,la);}.bind(this));}q(w.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){v.error('unguarded_unseen_count_fetch',{});return 0;}return aa(this);},exceedsMaxCount:function(){return this._maxCount||(aa(this)>s);},markAsSeen:function(){if(aa(this)>0||this._maxCount){this._serverRequests.markSeen();ca(this,h.convertActionIDToTimestamp(this._serverRequests.getLastActionID()),[]);}},markThreadSeen:function(ja,ka){var la={};la[ja]=null;ea(this,la,ka);}});q(w,l);function x(ja,ka){ja._unseenResources.setResource(t,ka);ja._unseenResources.setResource(u,Object.keys(ka));}function y(ja,ka){var la=ja._unseenResources.executeOrEnqueue(t,ka),ma=ja._unseenResources.getUnavailableResources(la);if(ma.length)ja._serverRequests.fetchUnseenThreadIDs();}function z(ja){return ja._unseenResources.getResource(t);}function aa(ja){var ka=ja._unseenResources.getResource(u);if(ka){return ka.length;}else return ja._initialUnseenCount;}function ba(ja,ka){var la=ia(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=n.INBOX)return;var xa=ga(ja,wa.thread_ids),ya=ja._lastSeenTimestamp;if(la&&la.seen_timestamp)ya=la.seen_timestamp;ca(ja,ya,xa);if(la&&la.unseen_count>s)ja._maxCount=true;});}else if(la&&la.seen_timestamp){ja._lastSeenTimestamp=la.seen_timestamp;if(la.unseen_count>s){ja._maxCount=true;x(ja,{});}else{ja._initialUnseenCount=la.unseen_count;if(ja._initialUnseenCount===0)x(ja,{});}}else{if(ja._maxCount)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==n.INBOX;if(!ua)continue;if(ra==k.USER_GENERATED_MESSAGE||ra==k.LOG_MESSAGE){var va=h.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==k.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}da(ja,na);ea(ja,oa);}}function ca(ja,ka,la){var ma=z(ja);if(ma===undefined||ka>ja._lastSeenTimestamp||ja._maxCount){ja._lastSeenTimestamp=ka;la=la||[];if(la.length<=s)ja._maxCount=false;var na={},oa=z(ja)||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(fa(ja,qa))na[pa]=qa;}var ra=q(r(la,true),na);x(ja,ra);ja._threadInformer.updatedUnseenState();}}function da(ja,ka){if(ja._maxCount)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(fa(ja,oa)){la[na]=oa;ma=true;}}if(!ma)return;y(ja,function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&fa(ja,ra))pa[qa]=la[qa];}x(ja,pa);ja._threadInformer.updatedUnseenState();});}function ea(ja,ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)y(ja,function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=h.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){x(ja,oa);ja._threadInformer.updatedUnseenState();if(la&&aa(ja)===0)ja._serverRequests.markSeen();}});}function fa(ja,ka){var la=h.convertActionIDToTimestamp(ka);return la>ja._lastSeenTimestamp;}function ga(ja,ka){return ka.map(ja._serverRequests.convertThreadIDIfAvailable.bind(ja._serverRequests));}function ha(ja,ka){var la=z(ja);if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}x(ja,la);}function ia(ja){var ka=(ja.message_counts||[]);for(var la=0;la<ka.length;la++)if(ka[la].folder==n.INBOX)return ka[la];return null;}g.subscribe(i.DUMP_EVENT,function(ja,ka){ka.messaging=ka.messaging||{};ka.messaging.unseen={};ka.messaging.unseen_max_count={};ka.messaging.unseen_time={};var la=w._getInstances();for(var ma in la){ka.messaging.unseen[ma]=q({},z(la[ma]));ka.messaging.unseen_max_count[ma]=la[ma]._maxCount;ka.messaging.unseen_time[ma]=la[ma]._lastSeenTimestamp;}});e.exports=w;});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryParticipants","MercuryDelayedRoger","MercuryThreads"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('MercuryParticipants'),k=b('MercuryDelayedRoger'),l=b('MercuryThreads').get(),m={},n={updateOnSeenChange:function(p,q){m[p.tagName]=true;h.set(p,'thread-id',q.thread_id);g.addClass(p,'seenByListener');o(p,q);}};function o(p,q){var r=q.participants.filter(function(t){return t!==j.user;}),s=q.participants.length>0&&q.participants[0]===j.user;g.conditionClass(p,'repliedLast',s);g.conditionClass(p,'seenByAll',s&&k.getSeenBy(q.thread_id).length===r.length);}k.subscribe('state-changed',function(p,q){for(var r in m){var s=i.scry(document.body,r+'.seenByListener');for(var t=0;t<s.length;t++){var u=s[t],v=h.get(u,'thread-id');if(q[v])l.getThreadMeta(v,function(w){o(u,w);});}}});e.exports=n;});
__d("MercuryThreadMetadataRenderer",["MercuryConfig","CSS","DOM","HTML","JSLogger","MercuryAttachment","MercuryAttachmentType","MercuryConstants","MercuryEmoji","MercuryMessageSourceTags","MercurySingletonMixin","MercuryThreadMetadataRawRenderer","MercuryParticipants","MercuryParticipantsConstants","React","MercurySeenByAll","MercuryServerRequests","SplitImage.react","Style","MercuryThreadlistIconTemplates","MercuryThreads","Tooltip","URI","arrayContains","createArrayFrom","copyProperties","cx","formatDate","tx"],function(a,b,c,d,e,f){var g=b('MercuryConfig'),h=b('CSS'),i=b('DOM'),j=b('HTML'),k=b('JSLogger'),l=b('MercuryAttachment'),m=b('MercuryAttachmentType'),n=b('MercuryConstants'),o=b('MercuryEmoji'),p=b('MercuryMessageSourceTags'),q=b('MercurySingletonMixin'),r=b('MercuryThreadMetadataRawRenderer'),s=b('MercuryParticipants'),t=b('MercuryParticipantsConstants'),u=b('React'),v=b('MercurySeenByAll'),w=b('MercuryServerRequests'),x=b('SplitImage.react'),y=b('Style'),z=b('MercuryThreadlistIconTemplates'),aa=b('MercuryThreads'),ba=b('Tooltip'),ca=b('URI'),da=b('arrayContains'),ea=b('createArrayFrom'),fa=b('copyProperties'),ga=b('cx'),ha=b('formatDate'),ia=b('tx'),ja=k.create('wm_timestamp');function ka(qa){this._fbid=qa;this._serverRequests=w.getForFBID(qa);this._threads=aa.getForFBID(qa);}fa(ka,q);fa(ka.prototype,{renderTimestamp:function(qa,ra,sa,ta){if(ta){if(!ra){ja.warn('no_title');ra=(new Date(ta)).toLocaleDateString();}qa.setAttribute('title',ra);qa.setAttribute('data-utime',ta/1000);if(!sa){ja.warn('no_display');sa=ha(new Date(ta),g['24h_times']?'H:i':'g:ia');}i.setContent(qa,sa);h.show(qa);}},renderMessageSourceTags:function(qa,ra,sa,ta){var ua='',va='',wa='';if(da(sa,p.MESSENGER)){ua="Sent from Messenger";va=new ca('/mobile/messenger');wa="_9g";}else if(da(sa,p.MOBILE)){ua="Sent from Mobile";va=new ca('/mobile/');wa="_9j";}else if(da(sa,p.CHAT)){ua="Sent from chat";wa="_9h";}else if(da(sa,p.EMAIL)){if(ta){ua=ia._("Sent from {email}",{email:ta});}else ua="Sent from email";wa="_9i";}if(wa){ba.set(qa,ua);h.addClass(ra,wa);if(va){qa.setAttribute('href',va);}else qa.removeAttribute('href');}else h.hide(qa);},renderMessageLocation:function(qa,ra,sa){var ta=ca('/ajax/messaging/hovercard/map.php').setQueryData(sa);qa.setAttribute('data-hovercard',ta);h.removeClass(qa,"_b9");h.show(ra);},renderSpoofWarning:function(qa,ra,sa){if(ra){h.addClass(qa,"_sa");ba.set(qa,ia._("Unable to confirm {name_or_email} as the sender.",{name_or_email:sa.name}));}},renderChatSpoofWarning:function(qa,ra,sa){if(ra)i.appendContent(qa,ia._("Unable to confirm {name_or_email} as the sender.",{name_or_email:sa.name}));},renderCoreThreadlist:function(qa,ra,sa,ta,ua){ta=ta||{};this.renderThreadImage(qa,ra.getNode('image'));var va=ra.getNode('accessibleName'),wa=[ra.getNode('name')];if(va)wa.push(va);pa(this,qa,wa,ta);if(qa.folder&&ua)oa(ra.getNode('folderBadge'),qa.folder);var xa=ra.getNode('timestamp');this.renderTimestamp(xa,qa.timestamp_absolute,qa.timestamp_relative,qa.timestamp);this.renderSnippet(qa,ra.getNode('snippet'));ma(ra,qa);sa(ra,qa);},renderAndSeparatedParticipantList:function(qa,ra,sa){sa=sa||{};sa.last_separator_uses_and=true;this._threads.getThreadMeta(qa,function(ta){pa(this,ta,ra,sa);}.bind(this));},renderSnippet:function(qa,ra){var sa=false,ta=i.create('span');h.addClass(ta,'MercuryRepliedIndicator');i.appendContent(ra,ta);v.updateOnSeenChange(ta,qa);var ua=qa.snippet;if(ua){if(qa.snippet_has_attachment)i.appendContent(ra,i.create('span',{className:'MercuryAttachmentIndicator'}));if(qa.is_forwarded_snippet)i.appendContent(ra,i.create('strong',{className:"_55q_"},"Forwarded Message:"));if(ua.substr(0,4)=='?OTR'){ua="[encrypted message]";}else ua=ua.replace(/\r\n|[\r\n]/g," ");ua=j(o.htmlEmojiAndEmote(ua));}else{if(qa.is_forwarded_snippet)i.appendContent(ra,i.create('strong',{className:"_55q_"},"Forwarded Message"));if(qa.snippet_has_attachment&&qa.snippet_attachments&&qa.snippet_attachments.length){sa=true;ua=i.create('span');na(this,qa,ua);}}var va=qa.participants.length;if(qa.is_subscribed)va--;if(!sa&&qa.snippet_sender&&s.getIDForUser(this._fbid)!=qa.snippet_sender&&va>1){s.get(qa.snippet_sender,function(wa){if(wa.short_name){i.appendContent(ra,ia._("{name}: {conversation_snippet}",{name:wa.short_name,conversation_snippet:ua}));}else i.appendContent(ra,ua);});}else i.appendContent(ra,ua);},getTitanURL:function(qa,ra,sa){if(qa.substr(0,qa.indexOf(':'))=='user'){r.getUserCanonicalTitanURL(qa,ra,sa);}else this._serverRequests.getServerThreadID(qa,function(ta){r.getTitanURLWithServerID(ta,ra,sa);});},renderTitanLink:function(qa,ra,sa,ta){if(qa.substr(0,qa.indexOf(':'))=='user'){r.renderUserCanonicalTitanLink(qa,ra,sa,ta);}else this._serverRequests.getServerThreadID(qa,function(ua){r.renderTitanLinkWithServerID(ua,ra,sa,ta);});},renderThreadImage:function(qa,ra){if(qa.image_src){var sa=x({srcs:qa.image_src,size:t.BIG_IMAGE_SIZE},null);u.renderComponent(sa,ra);return;}var ta=s.getIDForUser(this._fbid),ua=[],va=qa.participants.filter(function(wa){return wa!=ta;});if(!va.length){ua=[ta];}else if(va.length==1){ua=[va[0]];}else ua=va.slice(0,3);this.renderParticipantImages(ua,ra);},renderParticipantImages:function(qa,ra){s.getOrderedBigImageMulti(qa,function(sa){var ta=x({srcs:sa,border:true,size:t.BIG_IMAGE_SIZE},null);u.renderComponent(ta,ra);});},renderParticipantList:function(qa,ra,sa,ta){return r.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(qa),ra,sa,ta);},renderThreadNameAndParticipantList:function(qa,ra,sa,ta){var ua=r.renderRawParticipantList(this._serverRequests.getServerThreadIDNow(qa),ra,sa,ta),va=this._threads.getThreadMetaNow(qa);if(!va.name)return ua;return ia._("{conversation_name} [with {participant_list}]",{conversation_name:va.name,participant_list:ua});},renderParticipantCount:function(qa,ra){return r.renderRawParticipantCount(this._serverRequests.getServerThreadIDNow(qa),ra);}});function la(qa){if(!qa.snippet_attachments)return [];return qa.snippet_attachments.filter(function(ra){return ra.attach_type===m.PHOTO;});}function ma(qa,ra){var sa=la(ra);if(sa.length===0)return;var ta=sa[0].thumbnail_url;if(!ta)return;var ua=(sa.length==1)?'snippet-thumbnail-single':'snippet-thumbnail-multiple',va=qa.getNode(ua);if(!va)return;var wa=i.find(va,'i');y.set(wa,'background-image','url('+ta+')');h.show(va);}function na(qa,ra,sa){var ta=ra.snippet_sender&&s.getIDForUser(qa._fbid)==ra.snippet_sender,ua=function(za){if(!ra.snippet_sender||ta){za(null);return;}s.get(ra.snippet_sender,function(ab){za(ab.short_name);});},va=la(ra),wa=va.length==ra.snippet_attachments.length,xa=ra.snippet_attachments.length===1&&ra.snippet_attachments[0].metadata&&ra.snippet_attachments[0].metadata.type=='fb_voice_message',ya=ra.snippet_attachments.length===1&&ra.snippet_attachments[0].share_data_type===n.MercurySupportedShareType.FB_STICKER;ua(function(za){var ab=null;if(wa){var bb=z[':fb:mercury:attachment-icon-text'].build().getRoot();if(va.length===1){ab=ta?"You sent a photo.":ia._("{name} sent a photo.",{name:za});}else ab=ta?ia._("You sent {num_photos} photos.",{num_photos:va.length}):ia._("{name} sent {num_photos} photos.",{name:za,num_photos:va.length});h.addClass(bb,l.getAttachIconClass(va[0].icon_type));i.appendContent(bb,ab);i.appendContent(sa,bb);}else if(xa){var cb=z[':fb:mercury:attachment-icon-text'].build().getRoot();ab=ta?"You sent a voice message.":ia._("{name} sent a voice message.",{name:za});h.addClass(cb,l.getAttachIconClass(ra.snippet_attachments[0].icon_type));i.appendContent(cb,ab);i.appendContent(sa,cb);}else if(ya){ab=ta?"You sent a sticker.":ia._("{name} sent a sticker.",{name:za});i.appendContent(sa,ab);}else ra.snippet_attachments.filter(function(db){return db.attach_type==m.FILE||db.attach_type==m.PHOTO;}).forEach(function(db){var eb=z[':fb:mercury:attachment-icon-text'].build().getRoot();i.appendContent(eb,db.name);h.addClass(eb,l.getAttachIconClass(db.icon_type));i.appendContent(sa,eb);});});}function oa(qa,ra){ea(qa).forEach(function(sa){i.setContent(sa,ra);});}function pa(qa,ra,sa,ta){sa=ea(sa);if(ra.name){var ua=r.renderRawTitleWithUnreadCount(ra.name,ta.show_unread_count?ra.unread_count:0);sa.forEach(function(wa){i.setContent(wa,ua);});ta.callback&&ta.callback(ua);return;}var va=ra.participants;if(ra.participants.length>1)va=ra.participants.filter(function(wa){return wa!=s.getIDForUser(qa._fbid);});s.getMulti(va,function(wa){r.renderParticipantListWithNoThreadName(qa._serverRequests.getServerThreadIDNow(ra.thread_id),ra,va,wa,sa,ta);});}e.exports=ka;});
__d("RenderManager",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties');function h(i){this._isDirty=false;this._obj=i;}g(h.prototype,{dirty:function(){if(!this._isDirty){this._isDirty=true;this._doPaint.bind(this).defer();}},_doPaint:function(){this._isDirty=false;this._obj.paint();}});e.exports=h;});
__d("CounterDisplay",["Arbiter","CSS","DOM","RenderManager","Run","$","copyProperties","removeFromArray"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('RenderManager'),k=b('Run'),l=b('$'),m=b('copyProperties'),n=b('removeFromArray');function o(p,q,r,s,t,u){m(this,{_name:p,_valueNode:l(q),_wrapperNode:l(r)||null,_statusClass:t,_rm:new j(this),_arbiterSubscription:null,_count:0});var v=this._valueNode.firstChild;if(v){var w=parseInt(v.nodeValue,10);if(!isNaN(w))this._count=w;}this._statusNode=s?l(s):null;this._subscribeAll();o.instances.push(this);if(!u)k.onLeave(this._destroy.bind(this),true);}m(o,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(p,q){g.inform(o.EVENT_TYPE_ADJUST+'/'+p,q);},setCount:function(p,q){g.inform(o.EVENT_TYPE_UPDATE+'/'+p,q);}});m(o.prototype,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){this._arbiterSubscription.unsubscribe();delete this._arbiterSubscription;}n(o.instances,this);},adjustCount:function(p){this._count=Math.max(0,this._count+p);this._rm.dirty();return this;},setCount:function(p){this._count=Math.max(0,p);this._rm.dirty();return this;},paint:function(){i.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)h.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)h.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var p=[o.EVENT_TYPE_ADJUST+'/'+this._name,o.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=g.subscribe(p,this._onInform.bind(this),g.SUBSCRIBE_NEW);},_onInform:function(p,q){q=parseInt(q);if(isNaN(q))return;if(p.indexOf(o.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(q);}else if(p.indexOf(o.EVENT_TYPE_UPDATE)!=-1){this.setCount(q);}else return;return;}});e.exports=o;});
__d("ContextualTypeaheadView",["BucketedTypeaheadView","CSS","Class","ContextualLayer","ContextualLayerAutoFlip","ContextualLayerHideOnScroll","DOM","DOMDimensions","Style","copyProperties"],function(a,b,c,d,e,f){var g=b('BucketedTypeaheadView'),h=b('CSS'),i=b('Class'),j=b('ContextualLayer'),k=b('ContextualLayerAutoFlip'),l=b('ContextualLayerHideOnScroll'),m=b('DOM'),n=b('DOMDimensions'),o=b('Style'),p=b('copyProperties');function q(r,s){this.parent.construct(this,r,s);}i.extend(q,g);p(q.prototype,{init:function(){this.initializeLayer();this.parent.init();},initializeLayer:function(){this.context=this.getContext();this.wrapper=m.create('div');m.appendContent(this.wrapper,this.element);h.addClass(this.element,'uiContextualTypeaheadView');this.layer=new j({context:this.context,position:'below',alignment:this.alignment,causalElement:this.causalElement,permanent:true},this.wrapper);this.layer.enableBehavior(l);if(o.isFixed(this.context)||this.autoflip)this.layer.enableBehavior(k);this.subscribe('render',this.renderLayer.bind(this));},show:function(){if(this.minWidth){o.set(this.wrapper,'min-width',this.minWidth+'px');}else if(this.width){o.set(this.wrapper,'width',this.width+'px');}else o.set(this.wrapper,'width',n.getElementDimensions(this.context).width+'px');var r=this.parent.show();this.layer.show();return r;},hide:function(){this.layer.hide();return this.parent.hide();},renderLayer:function(){if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();},clearText:function(){this.layer.getCausalElement().value='';},getContext:function(){return this.element.parentNode;}});e.exports=q;});
__d("LayerHideOnSuccess",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));},disable:function(){if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}}});e.exports=h;});
__d("Overlay",["Class","CSS","DataStore","DOM","Layer","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerTabIsolation","LayerMouseHooks","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('Layer'),l=b('LayerButtons'),m=b('LayerDestroyOnHide'),n=b('LayerFadeOnHide'),o=b('LayerFadeOnShow'),p=b('LayerFormHooks'),q=b('LayerHideOnBlur'),r=b('LayerHideOnEscape'),s=b('LayerHideOnSuccess'),t=b('LayerHideOnTransition'),u=b('LayerTabIsolation'),v=b('LayerMouseHooks'),w=b('copyProperties');function x(y,z){y=w({buildWrapper:true},y||{});this._shouldBuildWrapper=y.buildWrapper;this.parent.construct(this,y,z);}g.extend(x,k);w(x.prototype,{_configure:function(y,z){this.parent._configure(y,z);var aa=this.getRoot();this._overlay=j.scry(aa,'div.uiOverlay')[0]||aa;h.hide(aa);j.appendContent(this.getInsertParent(),aa);i.set(this._overlay,'overlay',this);var ba=i.get(this._overlay,'width');ba&&this.setWidth(ba);if(this.setFixed)this.setFixed(i.get(this._overlay,'fixed')=='true');if(i.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(o);if(i.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(n);if(i.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(s);if(i.get(this._overlay,'hideonblur')=='true')this.enableBehavior(q);if(i.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(m);return this;},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([l,p,v,r,t,u]);},initWithoutBuildingWrapper:function(){this._shouldBuildWrapper=false;return this.init.apply(this,arguments);},_buildWrapper:function(y,z){z=this.parent._buildWrapper(y,z);if(!this._shouldBuildWrapper){this._contentRoot=z;return z;}this._contentRoot=j.create('div',{className:'uiOverlayContent'},z);return j.create('div',{className:'uiOverlay'},this._contentRoot);},getContentRoot:function(){return this._contentRoot;},destroy:function(){i.remove(this.getRoot(),'overlay');this.parent.destroy();}});e.exports=x;});
__d("PopoverAsyncMenu",["Event","AsyncRequest","Class","PopoverMenu","copyProperties"],function(a,b,c,d,e,f){var g=b('Event'),h=b('AsyncRequest'),i=b('Class'),j=b('PopoverMenu'),k=b('copyProperties'),l={},m=0;function n(o,p,q,r,s){this._endpoint=r;this._loadingMenu=q;this._instanceId=m++;l[this._instanceId]=this;this._mouseoverListener=g.listen(p,'mouseover',this._fetchMenu.bind(this));this.parent.construct(this,o,p,null,s);}n.setMenu=function(o,p){l[o].setMenu(p);};n.getInstance=function(o){return l[o];};i.extend(n,j);k(n.prototype,{_fetched:false,_mouseoverListener:null,_onLayerInit:function(){if(!this._menu)this.setMenu(this._loadingMenu);this._fetchMenu();this._popover.getLayer().subscribe('key',this._handleKeyEvent.bind(this));},_fetchMenu:function(){if(this._fetched)return;new h().setURI(this._endpoint).setData({pmid:this._instanceId}).send();this._fetched=true;if(this._mouseoverListener){this._mouseoverListener.remove();this._mouseoverListener=null;}}});e.exports=n;});
__d("PopoverMenuOverlappingBorder",["CSS","DOM","Style","copyProperties","cx","shield"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties'),k=b('cx'),l=b('shield');function m(n){this._popoverMenu=n;this._popover=n.getPopover();this._triggerElem=n.getTriggerElem();}j(m.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null,enable:function(){this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',l(this._onSetMenu,this));},disable:function(){this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();},_onSetMenu:function(){this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',l(this._updateBorder,this));this._menuSubscription=this._menu.subscribe(['change','resize'],l(Function.prototype.defer,l(this._updateBorder,this)));this._updateBorder();},_updateBorder:function(){var n=this._menu.getRoot(),o=this._triggerElem.offsetWidth,p=Math.max(n.offsetWidth-o,0);i.set(this._shortBorder,'width',p+'px');},_renderShortBorder:function(n){this._shortBorder=h.create('div',{className:"_54hx"});h.appendContent(n,this._shortBorder);g.addClass(n,"_54hy");},_removeShortBorder:function(){if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),"_54hy");}},_removeBorderSubscriptions:function(){if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}}});e.exports=m;});
__d("Typeahead",["ArbiterMixin","BehaviorsMixin","DOM","DataStore","Event","Parent","Run","copyProperties","emptyFunction","ge"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('DOM'),j=b('DataStore'),k=b('Event'),l=b('Parent'),m=b('Run'),n=b('copyProperties'),o=b('emptyFunction'),p=b('ge');function q(r,s,t,u){this.args={data:r,view:s,core:t};j.set(u,'Typeahead',this);this.element=u;}q.getInstance=function(r){var s=l.byClass(r,'uiTypeahead');return s?j.get(s,'Typeahead'):null;};n(q.prototype,g,h,{init:function(r){this.init=o;this.getCore();this.getView().setAccessibilityControlElement(this.getCore().getElement());this.proxyEvents();this.initBehaviors(r||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var r=this.args.data;this.data=r;this.data.init();}return this.data;},getView:function(){if(!this.view){var r=this.args.view,s=r.node||p(r.node_id);if(!s){s=i.create('div',{className:'uiTypeaheadView'});i.appendContent(this.element,s);}if(typeof r.ctor==='string'){this.view=new window[r.ctor](s,r.options||{});}else this.view=new r.ctor(s,r.options||{});this.view.init();this.view.setTypeahead(this.element);}return this.view;},getCore:function(){if(!this.core){var r=this.args.core;if(typeof r.ctor==='string'){this.core=new window[r.ctor](r.options||{});}else this.core=new r.ctor(r.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(r){var s=this.core;this.data=this.args.data=r;r.init();if(s){s.data=r;s.initData();s.reset();}r.bootstrap();return r;},proxyEvents:function(){[this.data,this.view,this.core].forEach(function(r){r.subscribe(r.events,this.inform.bind(this));},this);},initBehaviors:function(r){r.forEach(function(s){if(typeof s==='string'){if(a.TypeaheadBehaviors&&a.TypeaheadBehaviors[s]){a.TypeaheadBehaviors[s](this);}else m.onLoad(function(){if(a.TypeaheadBehaviors)(a.TypeaheadBehaviors[s]||o)(this);}.bind(this));}else this.enableBehavior(s);},this);}});q.initNow=function(r,s,t){if(t)t.init(r);r.init(s);};q.init=function(r,s,t,u){if(!i.isNodeOfType(r,['input','textarea']))r=i.scry(r,'input')[0]||i.scry(r,'textarea')[0];var v=false;try{v=document.activeElement===r;}catch(w){}if(v){q.initNow(s,t,u);}else var x=k.listen(r,'focus',function(){q.initNow(s,t,u);x.remove();});};e.exports=q;});
__d("BulkTagLoader",["AsyncRequest","copyProperties","emptyFunction"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('copyProperties'),i=b('emptyFunction'),j=false;function k(){}h(k,{loadForSet:function(l){if(!j){j=true;new g('/ajax/photos/sets/tags_fetch.php').setHandler(i).setData({set:l}).send();}},loadForAlbum:function(l){if(!j){j=true;new g('/ajax/photos/album/tags_fetch.php').setHandler(i).setData({fbid:l}).send();}},reset:function(){j=false;}});e.exports=k;});
__d("TypeaheadBestName",["TypeaheadUtil","copyProperties"],function(a,b,c,d,e,f){var g=b('TypeaheadUtil'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead.getView();this._subscription=j.subscribe('beforeRender',function(k,l){var m=l.value;for(var n=0;n<l.results.length;++n){var o=l.results[n];if(o.alternate_names==null)continue;if(g.isQueryMatch(m,o.default_name)){o.text=o.default_name;return;}for(var p=0;p<o.alternate_names.length;p++)if(g.isQueryMatch(m,o.alternate_names[p])){o.text=o.alternate_names[p];return;}o.text=o.default_name;}});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:BestNameTypeaheadBehavior",["TypeaheadBestName"],function(a,b,c,d){var e=b('TypeaheadBestName');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.buildBestAvailableNames=function(f){f.enableBehavior(e);};},3);
__d("PopoverLoadingMenu",["Class","DOM","PopoverMenuInterface","copyProperties","cx","joinClasses"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DOM'),i=b('PopoverMenuInterface'),j=b('copyProperties'),k=b('cx'),l=b('joinClasses');function m(n){this.parent.construct(this);this._config=n||{};this._theme=n.theme||{};}g.extend(m,i);j(m.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=h.create('div',{className:l("_54nq",this._config.className,this._theme.className)},h.create('div',{className:"_54ng"},h.create('div',{className:"_54nf _54af"},h.create('span',{className:"_54ag"}))));return this._root;}});e.exports=m;});
__d("ContextualLayerAsyncRelative",["Event","copyProperties","Parent"],function(a,b,c,d,e,f){var g=b('Event'),h=b('copyProperties'),i=b('Parent');function j(k){this._layer=k;}h(j.prototype,{_layerSubscription:null,_listener:null,enable:function(){this._layerSubscription=this._layer.subscribe('show',this._attachListener.bind(this));if(this._layer.isShown())this._attachListener();},disable:function(){this._layerSubscription.unsubscribe();this._layerSubscription=null;if(this._listener){this._listener.remove();this._listener=null;}},_attachListener:function(){this._listener=g.listen(this._layer.getRoot(),'click',this._onclick.bind(this));},_onclick:function(k){var l=i.byTag(k.getTarget(),'A');if(!l)return;var m=l.getAttribute('ajaxify'),n=l.href,o=m||n;if(l.rel==='async'||l.rel==='async-post'){d(['AsyncRequest'],function(p){p.bootstrap(o,this._layer.getContext(),l.rel==='async-post');}.bind(this));return false;}}});e.exports=j;});
__d("ContextualDialogFooterLink",["Event","copyProperties","CSS","DOM"],function(a,b,c,d,e,f){var g=b('Event'),h=b('copyProperties'),i=b('CSS'),j=b('DOM');function k(l){this._layer=l;}h(k.prototype,{_subscriptions:null,enable:function(){var l=this._layer.getRoot(),m=j.scry(l,'.uiContextualDialogFooterLink')[0],n='uiContextualDialogHoverFooterArrow';this._subscriptions=[g.listen(m,'mouseenter',i.addClass.curry(l,n)),g.listen(m,'mouseleave',i.removeClass.curry(l,n))];},disable:function(){this._subscriptions.forEach(function(l){l.remove();});this._subscriptions=null;}});e.exports=k;});
__d("LegacyContextualDialog",["event-extensions","Arbiter","ArbiterMixin","ARIA","Bootloader","Class","ContextualDialogFooterLink","ContextualThing","CSS","DataStore","DOM","Locale","Overlay","Parent","Style","Vector","$","copyProperties","getOverlayZIndex","shield"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ARIA'),j=b('Bootloader'),k=b('Class'),l=b('ContextualDialogFooterLink'),m=b('ContextualThing'),n=b('CSS'),o=b('DataStore'),p=b('DOM'),q=b('Locale'),r=b('Overlay'),s=b('Parent'),t=b('Style'),u=b('Vector'),v=b('$'),w=b('copyProperties'),x=b('getOverlayZIndex'),y=b('shield');function z(aa,ba){this.parent.construct(this,aa,ba);}k.extend(z,r);w(z,h,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:50,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,MIN_TOP_GAP:5,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'},getInstance:function(aa){var ba=o.get(aa,'LegacyContextualDialog');if(!ba){var ca=s.byClass(aa,'uiOverlay');if(ca)ba=o.get(ca,'overlay');}return ba;}});w(z.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_setContextSubscription:null,_resizeListener:null,_reflowSubscription:null,_configure:function(aa,ba){this.parent._configure(aa,ba);var ca=this.getRoot(),da=o.get.curry(ca);this.setAlignH(da('alignh','left'));this.setOffsetX(da('offsetx',0));this.setOffsetY(da('offsety',0));this.setPosition(da('position','above'));this._hasFooter=da('hasfooter',false);if(this._hasFooter){var ea=p.scry(ca,'.uiContextualDialogFooterLink')[0];ea&&this.enableBehavior(l);}this._setContextSubscription=this.subscribe('beforeshow',function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var ga=da('context');if(ga){this.setContext(v(ga));}else{ga=da('contextselector');if(ga)this.setContext(p.find(document,ga));}}.bind(this));this._content=p.scry(ca,'.uiContextualDialogContent')[0];if(this._content){this._content.setAttribute('role','dialog');var fa=p.scry(this._content,'.legacyContextualDialogTitle')[0];if(fa)this._content.setAttribute('aria-labelledby',p.getID(fa));}this._showSubscription=this.subscribe('show',function(){var ga=y(this.updatePosition,this);this._resizeListener=Event.listen(window,'resize',ga);this._reflowSubscription=g.subscribe('reflow',ga);this._setupScrollListener(this._scrollParent);m.register(ca,this.context);g.inform('layer_shown',{type:'ContextualDialog'});}.bind(this));this._hideSubscription=this.subscribe('hide',function(){this._teardownResizeAndReflowListeners();this._teardownScrollListener();g.inform('layer_hidden',{type:'ContextualDialog'});}.bind(this));return this;},_buildWrapper:function(aa,ba){var ca=this.parent._buildWrapper(aa,ba);if(!this._shouldBuildWrapper)return ca;n.addClass(ca,'uiContextualDialog');return p.create('div',{className:'uiContextualDialogPositioner'},ca);},setWidth:function(aa){this._width=Math.floor(aa);return this;},setFixed:function(aa){aa=!!aa;n.conditionClass(this.getRoot(),'uiContextualDialogFixed',aa);this._fixed=aa;return this;},setAlignH:function(aa){this.alignH=aa;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(aa){if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}aa=v(aa);if(this.context&&this.context!=aa)o.remove(this.context,'LegacyContextualDialog');this.context=aa;i.setPopup(this.getCausalElement(),this.getRoot());var ba=s.byClass(aa,'fbPhotoSnowlift');this.setInsertParent(ba||document.body);if(this._scrollListener&&this._scrollParent!==ba){this._teardownScrollListener();this._setupScrollListener(ba);}this._scrollParent=ba;var ca=x(aa,this._insertParent);t.set(this.getRoot(),'z-index',ca>200?ca:'');o.set(this.context,'LegacyContextualDialog',this);return this;},getCausalElement:function(){return this.parent.getCausalElement()||this.context;},listen:function(aa,ba){return Event.listen(this.getRoot(),aa,ba);},setOffsetX:function(aa){this.offsetX=parseInt(aa,10)||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(aa){this.offsetY=parseInt(aa,10)||0;this._shown&&this.updatePosition();return this;},setPosition:function(aa){this.position=aa;for(var ba in z.POSITION_TO_CLASS)n.conditionClass(this.getRoot(),z.POSITION_TO_CLASS[ba],aa==ba);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;},updatePosition:function(){if(!this.context)return false;if(this._width)t.set(this._overlay,'width',this._width+'px');var aa=this._fixed?'viewport':'document',ba=u.getElementPosition(this.context,aa),ca=this._scrollParent;if(ca)ba=ba.sub(u.getElementPosition(ca,'document')).add(ca.scrollLeft,ca.scrollTop);var da=u.getElementDimensions(this.context),ea=this.position=='above'||this.position=='below',fa=q.isRTL();if((this.position=='right'||(ea&&this.alignH=='right'))!=fa)ba=ba.add(da.x,0);if(this.position=='below')ba=ba.add(0,da.y);var ga=new u(0,0);if(ea&&this.alignH=='center'){ga=ga.add((da.x-this._width)/2,0);}else{var ha=ea?da.x:da.y,ia=2*z.ARROW_INSET;if(ha<ia){var ja=ha/2-z.ARROW_INSET;if(ea&&(this.alignH=='right'!=fa))ja=-ja;ga=ga.add(ea?ja:0,ea?0:ja);}}ga=ga.add(this.offsetX,this.offsetY);if(fa)ga=ga.mul(-1,1);ba=ba.add(ga);if(this._fixed)ba=new u(ba.x,ba.y,'document');ba.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;},scrollTo:function(){if(this.context)j.loadModules(['DOMScroll'],function(aa){aa.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}this._teardownScrollListener();this._teardownResizeAndReflowListeners();this.context&&o.remove(this.context,'LegacyContextualDialog');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right'){t.set(this._overlay,'top','');return;}var aa=this.getRoot(),ba=u.getElementPosition(aa,'viewport').y,ca=u.getElementDimensions(this._overlay).y,da=u.getViewportDimensions().y,ea=Math.min(Math.max(ba,z.MIN_TOP_GAP),z.TOP_MARGIN),fa=Math.min(Math.max(0,ba+ca+z.BOTTOM_MARGIN-da),Math.max(-ea,ba-ea),ca-2*z.ARROW_INSET);t.set(this._overlay,'top',(-1*fa)+'px');t.set(this._arrow,'top',z.ARROW_OFFSET+'px');t.set(this._arrow,'marginTop',fa+'px');},_adjustHorizontalPosition:function(){if((this.position!='above'&&this.position!='below')||this.alignH!='left'){t.set(this._overlay,'left','');t.set(this._overlay,'right','');return;}var aa=this.getRoot(),ba=u.getElementPosition(aa,'viewport').x,ca=u.getElementDimensions(this._overlay).x,da=u.getViewportDimensions().x,ea=q.isRTL(),fa;if(!ea){fa=ba+ca+z.RIGHT_MARGIN-da;}else fa=z.LEFT_MARGIN+ca-ba;fa=Math.min(Math.max(0,fa),ca-2*z.ARROW_INSET);t.set(this._overlay,ea?'right':'left',-1*fa+'px');t.set(this._arrow,ea?'right':'left',z.ARROW_OFFSET+'px');t.set(this._arrow,ea?'marginRight':'marginLeft',fa+'px');},_updateArrow:function(){var aa=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':aa=50;break;case 'right':aa=100;break;}this._renderArrow(z.POSITION_TO_ARROW[this.position],aa);},_renderArrow:function(aa,ba){for(var ca in z.ARROW_CLASS)n.conditionClass(this._overlay,z.ARROW_CLASS[ca],aa==ca);n.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',aa=='bottom'&&this._hasFooter);if(aa=='none')return;if(!this._arrow){this._arrow=p.create('i',{className:'uiContextualDialogArrow'});p.appendContent(this._overlay,this._arrow);}t.set(this._arrow,'top','');t.set(this._arrow,'left','');t.set(this._arrow,'right','');t.set(this._arrow,'margin','');var da=aa=='top'||aa=='bottom',ea=da?(q.isRTL()?'right':'left'):'top';ba=ba||0;t.set(this._arrow,ea,ba+'%');var fa=z.ARROW_LENGTH+z.ARROW_OFFSET*2,ga=-(fa*ba/100-z.ARROW_OFFSET);t.set(this._arrow,'margin-'+ea,ga+'px');},_updateAlignmentClass:function(){n.conditionClass(this.getRoot(),z.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');},_setupScrollListener:function(aa){this._scrollListener=Event.listen(aa||window,'scroll',y(this._adjustVerticalPosition,this));},_teardownScrollListener:function(){if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}},_teardownResizeAndReflowListeners:function(){if(this._resizeListener){this._resizeListener.remove();this._resizeListener=null;}if(this._reflowSubscription){this._reflowSubscription.unsubscribe();this._reflowSubscription=null;}}});e.exports=z;});
__d("ClearableTypeahead",["Event"],function(a,b,c,d,e,f){var g=b('Event'),h={resetOnCloseButtonClick:function(i,j){g.listen(j,'click',function(){var k=i.getCore();k.getElement().focus();k.reset();});}};e.exports=h;});
__d("TypeaheadShowLoadingIndicator",["CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe('loading',function(j,k){g.conditionClass(this._typeahead.getElement(),'typeaheadLoading',k.loading);g.conditionClass(this._typeahead.getView().getElement(),'typeaheadViewLoading',k.loading);}.bind(this));},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:ShowLoadingIndicatorTypeaheadBehavior",["TypeaheadShowLoadingIndicator"],function(a,b,c,d){var e=b('TypeaheadShowLoadingIndicator');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.showLoadingIndicator=function(f){f.enableBehavior(e);};},3);
__d("CompactTypeaheadRenderer",["Badge","DOM","TypeaheadFacepile"],function(a,b,c,d,e,f){var g=b('Badge'),h=b('DOM'),i=b('TypeaheadFacepile');function j(k,l){var m=[];if(k.xhp)return h.create('li',{className:'raw'},k.xhp);var n=k.photos||k.photo;if(n){if(n instanceof Array){n=i.render(n);}else n=h.create('img',{alt:'',src:n});m.push(n);}if(k.text){var o=[k.text];if(k.verified)o.push(g('xsmall'));m.push(h.create('span',{className:'text'},o));}var p=k.subtext,q=k.category;if(p||q){var r=[];p&&r.push(p);p&&q&&r.push(" \u00b7 ");q&&r.push(q);m.push(h.create('span',{className:'subtext'},r));}var s=h.create('li',{className:k.type||''},m);if(k.text)s.setAttribute('aria-label',k.text);return s;}j.className='compact';e.exports=j;});