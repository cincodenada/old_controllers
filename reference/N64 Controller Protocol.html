<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0054)http://afermiano.com/index.php/n64-controller-protocol -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-gb" lang="en-gb" slick-uniqueid="8"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <!--<base href="http://afermiano.com/index.php/n64-controller-protocol">--><base href=".">
  
  <meta name="keywords" content="antonio fermiano home page website software testing retrogaming microcontroller development">
  <meta name="author" content="Super User">
  <meta name="description" content="Antonio Fermiano&#39;s Home Page. Contains projects related to software testing, retrogaming and microcontroller development.">
  <meta name="generator" content="Joomla! - Open Source Content Management">
  <title>N64 Controller Protocol</title>
  <link href="http://afermiano.com/templates/jp_default_2.5/favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon">
  <link rel="stylesheet" href="./N64 Controller Protocol_files/modal.css" type="text/css">
  <script id="twitter-wjs" src="./N64 Controller Protocol_files/widgets.js"></script><script id="facebook-jssdk" src="./N64 Controller Protocol_files/all.js"></script><script type="text/javascript" async="" src="./N64 Controller Protocol_files/ga.js"></script><script src="./N64 Controller Protocol_files/mootools-core.js" type="text/javascript"></script>
  <script src="./N64 Controller Protocol_files/core.js" type="text/javascript"></script>
  <script src="./N64 Controller Protocol_files/caption.js" type="text/javascript"></script>
  <script src="./N64 Controller Protocol_files/modal.js" type="text/javascript"></script>
  <script type="text/javascript">
window.addEvent('load', function() {
				new JCaption('img.caption');
			});
		window.addEvent('domready', function() {

			SqueezeBox.initialize({});
			SqueezeBox.assign($$('a.modal'), {
				parse: 'rel'
			});
		});
  </script>

<link rel="stylesheet" href="./N64 Controller Protocol_files/theme1.css" type="text/css">
<!--[if IE 6]>
<link rel="stylesheet" href="/templates/jp_default_2.5/css/ie.css" type="text/css" />
<![endif]-->
<!--[if IE 7]>
<link rel="stylesheet" href="/templates/jp_default_2.5/css/ie.css" type="text/css" />
<![endif]-->
<!-- PNG FIX -->
<!--[if IE 6]>
	<style type="text/css"> img { behavior: url(/templates/jp_default_2.5/css/iepngfix.htc); } </style>
<![endif]-->	<style type="text/css">#container-inner{background-image:none;}	#mainbody{width:100%;} #content{width:80%;} #sidebar{width:20%;}</style>



<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-36268812-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

<style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}
.fb_invisible{display:none}
.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}
.fb_reset > div{overflow:hidden}
.fb_link img{border:none}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}
.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}
.fb_dialog_content{background:#fff;color:#333}
.fb_dialog_close_icon{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif);cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px;top:8px\9;right:7px\9}
.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}
.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}
.fb_dialog_close_icon:hover{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_close_icon:active{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent;_background-image:url(http://static.ak.fbcdn.net/rsrc.php/v2/yL/r/s816eWC-2sl.gif)}
.fb_dialog_loader{background-color:#f2f2f2;border:1px solid #606060;font-size:24px;padding:20px}
.fb_dialog_top_left,
.fb_dialog_top_right,
.fb_dialog_bottom_left,
.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}
/* @noflip */
.fb_dialog_top_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}
/* @noflip */
.fb_dialog_top_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}
/* @noflip */
.fb_dialog_bottom_left{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}
/* @noflip */
.fb_dialog_bottom_right{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}
.fb_dialog_vert_left,
.fb_dialog_vert_right,
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}
.fb_dialog_vert_left,
.fb_dialog_vert_right{width:10px;height:100%}
.fb_dialog_vert_left{margin-left:-10px}
.fb_dialog_vert_right{right:0;margin-right:-10px}
.fb_dialog_horiz_top,
.fb_dialog_horiz_bottom{width:100%;height:10px}
.fb_dialog_horiz_top{margin-top:-10px}
.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}
.fb_dialog_iframe{line-height:0}
.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #3b5998;color:#fff;font-size:14px;font-weight:bold;margin:0}
.fb_dialog_content .dialog_title > span{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/yd/r/Cou7n-nqK52.gif)
no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}
body.fb_hidden{-webkit-transform:none;height:100%;margin:0;left:-10000px;overflow:visible;position:absolute;top:-10000px;width:100%
}
.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/ya/r/3rhSv5V8j3o.gif)
white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}
.fb_dialog.fb_dialog_mobile.loading.centered{max-height:590px;min-height:590px;max-width:500px;min-width:500px}
#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;left:0;top:0;width:100%;min-height:100%;z-index:10000}
#fb-root #fb_dialog_ipad_overlay.hidden{display:none}
.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}
.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0 0, 0 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}
.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%
}
.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px
}
.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0 0, 0 100%, from(#4966A6),
color-stop(0.5, #355492), to(#2A4887));border:1px solid #29447e;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset,
rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}
.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}
.fb_dialog_content .dialog_content{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}
.fb_dialog_content .dialog_footer{background:#f2f2f2;border:1px solid #555;border-top-color:#ccc;height:40px}
#fb_dialog_loader_close{float:left}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}
.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}
.fb_iframe_widget{display:inline-block;position:relative}
.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}
.fb_iframe_widget iframe{position:absolute}
.fb_iframe_widget_lift{z-index:1}
.fb_hide_iframes iframe{position:relative;left:-10000px}
.fb_iframe_widget_loader{position:relative;display:inline-block}
.fb_iframe_widget_fluid{display:inline}
.fb_iframe_widget_fluid span{width:100%}
.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}
.fb_iframe_widget_loader .FB_Loader{background:url(http://static.ak.fbcdn.net/rsrc.php/v2/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}
.fb_connect_bar_container div,
.fb_connect_bar_container span,
.fb_connect_bar_container a,
.fb_connect_bar_container img,
.fb_connect_bar_container strong{background:none;border-spacing:0;border:0;direction:ltr;font-style:normal;font-variant:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal;vertical-align:baseline}
.fb_connect_bar_container{position:fixed;left:0 !important;right:0 !important;height:42px !important;padding:0 25px !important;margin:0 !important;vertical-align:middle !important;border-bottom:1px solid #333 !important;background:#3b5998 !important;z-index:99999999 !important;overflow:hidden !important}
.fb_connect_bar_container_ie6{position:absolute;top:expression(document.compatMode=="CSS1Compat"? document.documentElement.scrollTop+"px":body.scrollTop+"px")}
.fb_connect_bar{position:relative;margin:auto;height:100%;width:100%;padding:6px 0 0 0 !important;background:none;color:#fff !important;font-family:"lucida grande", tahoma, verdana, arial, sans-serif !important;font-size:13px !important;font-style:normal !important;font-variant:normal !important;font-weight:normal !important;letter-spacing:normal !important;line-height:1 !important;text-decoration:none !important;text-indent:0 !important;text-shadow:none !important;text-transform:none !important;white-space:normal !important;word-spacing:normal !important}
.fb_connect_bar a:hover{color:#fff}
.fb_connect_bar .fb_profile img{height:30px;width:30px;vertical-align:middle;margin:0 6px 5px 0}
.fb_connect_bar div a,
.fb_connect_bar span,
.fb_connect_bar span a{color:#bac6da;font-size:11px;text-decoration:none}
.fb_connect_bar .fb_buttons{float:right;margin-top:7px}
.fb_edge_widget_with_comment{position:relative;*z-index:1000}
.fb_edge_widget_with_comment span.fb_edge_comment_widget{position:absolute}
.fb_edge_widget_with_comment span.fb_send_button_form_widget{z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget .FB_Loader{left:0;top:1px;margin-top:6px;margin-left:0;background-position:50% 50%;background-color:#fff;height:150px;width:394px;border:1px #666 solid;border-bottom:2px solid #283e6c;z-index:1}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.dark .FB_Loader{background-color:#000;border-bottom:2px solid #ccc}
.fb_edge_widget_with_comment span.fb_send_button_form_widget.siderender
.FB_Loader{margin-top:0}
.fbpluginrecommendationsbarleft,
.fbpluginrecommendationsbarright{position:fixed !important;bottom:0;z-index:999}
/* @noflip */
.fbpluginrecommendationsbarleft{left:10px}
/* @noflip */
.fbpluginrecommendationsbarright{right:10px}</style></head>	<body data-twttr-rendered="true">
<!--[if IE]>
<div id="ie">
<![endif]-->
<!--[if IE 6]>
<div id="ie6">
<![endif]-->
<!--[if IE 7]>
<div id="ie7">
<![endif]-->
<!--[if lte IE 7]>
<div id="ie6-7">
<![endif]-->
<!--[if IE 8]>
<div id="ie8">
<![endif]-->
<!--[if IE 9]>
<div id="ie9">
<![endif]-->
<!--[if IE 10]>
<div id="ie10">
<![endif]-->

<div id="wrapper">
	<div id="header">
    	<a href="http://afermiano.com/" id="logo" title="Antonio Fermiano&#39;s Home Page" data-ytta-id="-"></a>
                <div class="clr"></div>
    </div>
        <div id="container">
    	<div id="container-inner">
        	<div id="mainbody">
                <div id="content">
                						<div class="inside">

                    	<div id="message">
                        	
<div id="system-message-container">
</div>
                        	<div class="clr"></div>
                        </div>

                    	                        <div class="item-page">

	<h2>
			N64 Controller Protocol		</h2>





	<dl class="article-info">
	<dt class="article-info-term">Details</dt>
	<dd class="published">
	Published on Sunday, 18 November 2012 21:26	</dd>
	</dl>



<div id="fb-root" class=" fb_reset">&nbsp;<div style="position: absolute; top: -10000px; height: 0px; width: 0px; "><div><iframe name="fb_xdm_frame_http" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_http" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tab-index="-1" style="border: none; " src="./N64 Controller Protocol_files/xd_arbiter.html"></iframe><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tab-index="-1" style="border: none; " src="./N64 Controller Protocol_files/xd_arbiter(1).html"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px; "><div></div></div></div>
<script type="text/javascript">// <![CDATA[
(function(d, s, id) {
		var js, fjs = d.getElementsByTagName(s)[0];
		if (d.getElementById(id)) return;
		js = d.createElement(s);
		js.id = id;
		js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
		fjs.parentNode.insertBefore(js, fjs);
	}(document, 'script', 'facebook-jssdk'));
// ]]></script>
<!-- Like button -->
<p><iframe src="./N64 Controller Protocol_files/like.html" scrolling="no" frameborder="0" style="border: none; overflow: hidden; width: 450px; height: 21px;" allowtransparency="true" width="450px" height="21px"></iframe></p>
<!-- Tweet button -->
<p><iframe allowtransparency="true" frameborder="0" scrolling="no" src="./N64 Controller Protocol_files/tweet_button.1368146021.html" class="twitter-share-button twitter-count-horizontal" style="width: 109px; height: 20px; " title="Twitter Tweet Button" data-twttr-rendered="true"></iframe>
<script type="text/javascript">// <![CDATA[
!
		function(d, s, id) {
			var js, fjs = d.getElementsByTagName(s)[0];
			if (!d.getElementById(id)) {
				js = d.createElement(s);
				js.id = id;
				js.src = "//platform.twitter.com/widgets.js";
				fjs.parentNode.insertBefore(js, fjs);
			}
		}(document, "script", "twitter-wjs");
// ]]></script>
</p>
<p>Here is a description of the Nintendo 64 controller protocol, with information I found during&nbsp;<a href="http://afermiano.com/index.php/psxton64-controller-adapter" data-ytta-id="-">PSX to N64 Controller Adaptor</a>&nbsp;development. It includes pictures and capture files that will be very useful if you want to interface with a Nintendo 64 console or controller.</p>
<p>I did not figure out the protocol from scratch, I used documentation from other people. Please check the references at the end of this page.</p>
<p>The information here is enough to interface successfully with a Nintendo 64 console or controller, but not with peripherals like Rumble Pak and Memory Pak. Interfacing with peripherals is more complicated since it requires implementation of new commands and on-the-fly CRC computing. If you need this kind of information, you will be able to find it in the references I mentioned.</p>
<p>&nbsp;</p>
<p><strong>Electrical specifications:</strong></p>
<p>N64 connector pins:</p>
<p><img src="./N64 Controller Protocol_files/n64pins.png" alt="N64 Connector Pins" style="display: block; margin-left: auto; margin-right: auto;" height="240" width="320"></p>
<p>VCC is 3.3V. I don't know the max current this port can provide.</p>
<p>DATA is a bidirectional line, connected using a common collector configuration. It means that instead of using 0V and 3.3V for low and high logic level, it uses a 0V and high impedance, so you will need to include a pull-up resistor to be able to read the line. If you are using a microcontroller, there is a chance you have some I/O pins with built-in pull-up already.</p>
<p>&nbsp;</p>
<p><strong>Protocol</strong></p>
<ul style="list-style-type: disc;">
<li>Line is kept in level high when idle.</li>
<li>Each bit can be detected by a falling edge, and has exactly 4us. A zero consists in line low for 3us, and high for 1us. A one consists in line low for 1us, and high for 3us.</li>
<li>Additionally to the usual bits, there are two special stop bits. "Console stop bit" is line low for 1us, and high for 2us (3us total). "Controller stop bit" is line low for 2us, and high afterwards (last bit).</li>
<li>When transmitting a byte, most significant bits go first.</li>
<li>A communication frame always starts with the console sending a 1 byte long command.</li>
<li>The basics commands needed for interfacing with the controller or console are the commands 0x00, 0x01 and 0xFF (this one is only used in old games). There is also commands 0x02 and 0x03, but they are related with controller paks reading (not described in this document).</li>
<li>A frame for the basic commands consists of: command (console), console stop bit (console), n data bytes (controller), controller stop bit (controller).</li>
<li>Command 0x00 is used to identify the controller. Response is 3 bytes long, and always: 0x050002. Last byte indicates the controller pak connected, and the 0x02 means nothing is connected. Here is a trace of the communication with a genuine N64 controller:<br><br><a class="modal" href="./N64 Controller Protocol_files/00_editado.png" data-ytta-id="-"><img src="./N64 Controller Protocol_files/00_editado.png" alt="Command 00 Response" class="resize" style="display: block; margin-left: auto; margin-right: auto;" height="111" width="500"></a></li>
<li>Command 0xFF response is exactly the same of 0x00, and is used only in some old games. Some of them don't mind if you don't respond it (e.g: Cruis'n USA), but others will ignore the controller if you don't respond it (e.g: Mario 64, Star Wars: Shadows Of Empire).</li>
<li>Command 0x01 is the polling command. N64 responds with the analog stick position and the buttons pressed. Here is the the trace, less detailed:<br><br><a class="modal" href="./N64 Controller Protocol_files/01.png" data-ytta-id="-"><img src="./N64 Controller Protocol_files/01.png" alt="Command 0x00 Trance" class="resize" style="display: block; margin-left: auto; margin-right: auto;" height="20" width="500"></a><br><br>Note that the response contains four bytes (Data 1, then Data 2, etc). Here is the meaning of each byte (MSB first):<br><strong>Data 1:&nbsp;</strong>A, B, Z, Start, D-Up, D-Down, D-Left, D-Right.<br><strong>Data 2:&nbsp;</strong>(not used), (not used), L, R, C-Up, C-Down, C-Left, C-Right.<br><strong>Data 3:&nbsp;</strong>Analog Stick X-Axis<br><strong>Data 4:&nbsp;</strong>Analog Stick Y-Axis<br><br>For buttons, 1 means pressed, 0 means not pressed.<br>For analog stick, an axis position goes as two's complement, i.e. 0x00 = center, 0x01 = 1, 0xFF = -1. For X-Axis, a negative value is used for left, and a positive value for right. I don't remember which are the directions for the Y-Axis.</li>
<li>Logic range for analog position is -128 to 127, however, true Nintendo 64 controller range is about 63% of it (mechanically limited), so the values between -81 to 81 (less for worn-out controllers). If you are interfacing with the controller, be sure to correct this range in your application. If you are interfacing with the console, be sure to not exceed these values or you will encounter glitches in some games, e.g: inability to make some combos in Super Smash Bros; some games inverting to the opposite direction once you pass a certain value.</li>
</ul>
<p><strong>&nbsp;</strong></p>
<p><strong>Timing:</strong></p>
<p>Polling interval and the commands sequence depends on the game.&nbsp;In Star Fox 64, 0x00 and 0x01 commands are sent alternately, with intervals varying between 1ms and 20ms. For Rareware games, most commands sent are 0x01 and are about 16ms apart.</p>
<p>If you are interfacing with a Nintendo 64 controller, it sounds like 20ms is a safe poll interval. Reference 1 says that Nintendo 64 controller responds with a significant jitter, but since I didn't see any in my captures, I believe it only happens if polling interval is too short.</p>
<p>Although the waveform timing is constant in the communication involving a genuine Nintendo 64 controller, the console is very tolerant to variations. It suggests console detects all bits using the falling borders. In my experiments, I tried adding ~20us before answering to a command and some pauses between response bits, and everything worked correctly. Also, if you replace the "controller stop bit" by a regular 1, everything will work correctly. These information may simplify your implementation.</p>
<p>I heard Everdrive 64 (SD card to cartridge accessory) polls very fast in selection menu in some situations, but it does not affect games behavior. I have not comproved that. </p>
<p><strong><strong>&nbsp;</strong></strong></p>
<p><strong><strong>Capture files:</strong></strong></p>
<p><strong><strong><a class="modal" href="./N64 Controller Protocol_files/nintendo64_capture.jpg" data-ytta-id="-"><img src="./N64 Controller Protocol_files/nintendo64_capture.jpg" alt="Logic Analyzer and Nintendo 64" class="resize" style="display: block; margin-left: auto; margin-right: auto;" height="375" width="500"></a></strong></strong></p>
<p>&nbsp;</p>
<p>Here are captures for some games that I made with a logic analyzer. They are 1 second long and were sampled at 24mhz.</p>
<ul style="list-style-type: disc;">
<li><a href="http://afermiano.com/downloads/banjo-tooie.7z" data-ytta-id="-">Banjo Tooie</a></li>
<li><a href="http://afermiano.com/downloads/goldeneye_007.7z" data-ytta-id="-">Goldeneye 007</a></li>
<li><a href="http://afermiano.com/downloads/zelda_majora_mask.7z" data-ytta-id="-">Legend of Zelda, The: Majora's Mask</a></li>
<li><a href="http://afermiano.com/downloads/star_fox_64.7z" data-ytta-id="-">Star Fox 64</a></li>
</ul>
<p>You will need to download <a href="http://usbee.com/ax.html" target="_blank" data-ytta-id="-">USBee AX Software</a> to open the capture files. I almost did a ulb-&gt;csv converter (their format is described in the user manual), but it didn't seen worthy. In case you are interested, please let me know.</p>
<p>&nbsp;</p>
<p><strong>Zelda Majora's Mask behavior</strong></p>
<p>I said commands 0x02 and 0x03 responses are not needed for some games, but reference 3 says the opposite. According to it, unless you respond to these commands, some games like Majora's Mask will not recognize the controller. In the capture file above you can see 0x03 command being sent often for this game.</p>
<p>My adaptor does not answer to these commands and work fine in Majora's Mask. So either reference 3 is wrong, or this behavior is specific of some Majora's Mask version.</p>
<p>&nbsp;</p>
<p><b>Techniques to read data:</b></p>
<p>If you are interfacing with the N64 controller or console, you can read the data the same way console and controller do - for each bit, wait for a falling edge, and sample the data 3us after.</p>
<p>Although this may not be a problem for a solution involving some hardware components (see reference 1), it may be a problem for a software. The reason is that the protocol is fast, and you may require a high clock device to able to detect the information this way.</p>
<p>You can take advantage of the well-formed waveform and use a little trick to detect the data. You can trigger the read process by the first bit falling edge, and sample the data at a fixed timing. So you can sample 3us after trigger, sleep 4us, sample again, etc.&nbsp;The problem of this solution is propagation of deltas if clocks are out of sync. I did not have problems for the short responses I implemented (0x00/0xFF and 0x01).</p>
<p><b><b>&nbsp;</b></b></p>
<p><b><b>References:</b></b></p>
<ol>
<li><a href="http://cnt.at-ninja.jp/n64_dpp/N64%20controller.htm" target="_blank" data-ytta-id="-">http://cnt.at-ninja.jp/n64_dpp/N64%20controller.htm</a></li>
<li><a href="http://code.google.com/p/micro-64-controller/wiki/Protocol" target="_blank" data-ytta-id="-"></a><a href="http://code.google.com/p/micro-64-controller/wiki/Protocol" target="_blank" data-ytta-id="-">http://code.google.com/p/micro-64-controller/wiki/Protocol</a></li>
<li><a href="http://svn.navi.cx/misc/trunk/wasabi/devices/cube64/firmware/n64gc_comm.inc" target="_blank" data-ytta-id="-"></a><a href="http://svn.navi.cx/misc/trunk/wasabi/devices/cube64/firmware/n64gc_comm.inc" target="_blank" data-ytta-id="-">http://svn.navi.cx/misc/trunk/wasabi/devices/cube64/firmware/n64gc_comm.inc</a></li>
<li><a href="http://www-inst.eecs.berkeley.edu/~cs150/fa04/Lab/Checkpoint1.PDF" data-ytta-id="-">http://www-inst.eecs.berkeley.edu/~cs150/fa04/Lab/Checkpoint1.PDF</a><a href="http://www-inst.eecs.berkeley.edu/~cs150/fa04/Lab/Checkpoint1.PDF" target="_blank" data-ytta-id="-"></a></li>
</ol>
<p>&nbsp;</p>
<div class="fb-comments fb_iframe_widget" data-href="http://afermiano.com/index.php/n64-controller-protocol" data-num-posts="10" data-width="750" fb-xfbml-state="rendered"><span style="height: 160px; width: 750px; "><iframe id="f10c692aa" name="f2e4e4258" scrolling="no" style="border: none; overflow: hidden; height: 160px; width: 750px; " title="Facebook Social Plugin" class="fb_ltr" src="./N64 Controller Protocol_files/comments.html"></iframe></span></div>
	
</div>

                    	                                            </div>
                </div>
                                <div id="sidebar">
                    		<div class="moduletable">
					
<ul class="menu">
<li class="item-475"><a href="http://afermiano.com/index.php/home" data-ytta-id="-">Home</a></li><li class="item-496"><a href="http://afermiano.com/index.php/contact" data-ytta-id="-">Contact</a></li></ul>
		</div>
			<div class="moduletable">
					<h3>Projects</h3>
					
<ul class="menu">
<li class="item-481"><a href="http://afermiano.com/index.php/psxton64-controller-adapter" data-ytta-id="-">PSX to N64 Controller Adaptor</a></li></ul>
		</div>
			<div class="moduletable">
					<h3>Documentation</h3>
					
<ul class="menu">
<li class="item-502 current active"><a href="./N64 Controller Protocol_files/N64 Controller Protocol.html" data-ytta-id="-">N64 Controller Protocol</a></li></ul>
		</div>
			<div class="moduletable">
					

<div class="custom">
	<p><a href="http://afermiano.com/index.php/component/ninjarsssyndicator/?feed_id=1&format=raw" data-ytta-id="-"><img src="./N64 Controller Protocol_files/rss20.gif" alt=""></a></p>
<p><a href="http://afermiano.com/index.php/component/ninjarsssyndicator/?feed_id=1&format=raw" data-ytta-id="-"><img src="./N64 Controller Protocol_files/atom03.gif" alt=""></a></p></div>
		</div>
	
                </div>
                                <div class="clr"></div>
            </div>
                        <div class="clr"></div>
        </div>
    </div>
        <div id="footer">
    	    	<div id="copy">
        	

<div class="custom">
	<p style="text-align: justify;"><span style="color: #999999; font-family: Arial, Helvetica, sans-serif; font-size: 11.111111640930176px; line-height: normal;">Copyright © 2012 Antonio Fermiano. All Rights Reserved.</span></p></div>

        </div>
                    	<div class="clr"></div>
    </div>
            <div class="inside" style="padding:10px;"></div>
</div>

<!--[if IE 10]>
</div>
<![endif]-->
<!--[if IE 9]>
</div>
<![endif]-->
<!--[if IE 8]>
</div>
<![endif]-->
<!--[if lte IE 7]>
</div>
<![endif]-->
<!--[if IE 7]>
</div>
<![endif]-->
<!--[if IE 6]>
</div>
<![endif]-->
<!--[if IE]>
</div>
<![endif]-->


<div id="sbox-overlay" aria-hidden="true" style="z-index: 65555; opacity: 0; " tabindex="-1"></div><div id="sbox-window" role="dialog" aria-hidden="true" style="z-index: 65557; " class="shadow"><div id="sbox-content" style="opacity: 0; "></div><a id="sbox-btn-close" href="http://afermiano.com/index.php/n64-controller-protocol#" role="button" aria-controls="sbox-window" data-ytta-id="-"></a></div><div id="sbi_camera_button" class="sbi_search" style="left:0px;top:0px;position:absolute;width:29px;height:27px;border:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px;z-index:2147483647;display:none;"></div></body></html>